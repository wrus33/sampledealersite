!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";const e=e=>{let t=e;return t=t.replace(/^(tps-)/,""),t=t.replace(/^(cst-parse-)/,""),t=t.replace(/^(cst-)/,""),t=t.replace(/^(cw-)/,""),t},t=e=>{if(!e)return"Undefined";const t=["Web Integration API","Third Party Services API Full","Third Party Services API Compatible","Third Party Services API Hybrid","Third Party Services Velocity","Custom Work (cms-sites)"];return t.includes(e)?e:"wise"===e.toLowerCase()?t[0]:"api"===e.toLowerCase()?t[1]:"api_compatible"===e.toLowerCase()?t[2]:"hybrid"===e.toLowerCase()||e.startsWith("tps")?t[3]:"legacy"===e.toLowerCase()?t[4]:"custom"===e.toLowerCase()||e.startsWith("cw")||e.startsWith("cst")?t[5]:"Undefined"},i=()=>{const{accountId:e="",siteId:t="",defaultDomain:i=""}=window.DDC.siteSettings,{pageInfo:{pageName:n="",pagePath:a=""},attributes:{locale:s=""}}=window.DDC.dataLayer.page;return{account:e,siteId:t,defaultDomain:i,pageName:n,pagePath:a,locale:s}},n=(n,a)=>{window.newrelic&&window.newrelic.addPageAction("WebIntegrationEvent",{integrationId:e(n.integrationId),integrationType:t(n.integrationType),integrationCategory:n.integrationCategory||"",placesInventoryContent:n.placesInventoryContent||!1,...a,...i()})};let a;const s=async()=>{if(!Object.keys(window.DDC.dataLayer).length||!Object.keys(window.DDC.siteSettings).length)throw new Error("DDC DataLayer is not defined. Aborting Web Integration API.");if(!a){const{pageInfo:e,attributes:t}=window.DDC.dataLayer.page,{design:i,franchises:n}=window.DDC.dataLayer.site,{siteSettings:s}=window.DDC,o=e.isVlp,r=e.isVdp,c=e.isHomepage;a={accountId:s.accountId||"",siteId:s.siteId||"",defaultDomain:s.defaultDomain||"",indexPage:c,searchPage:o,detailPage:r,pageName:e.pageName||"",layoutType:t.layoutType||"",locale:t.locale||"",design:i,franchises:n}}return a},o=(e,t)=>e.reduce(((e,t)=>e&&e[t]?e[t]:null),t),r=(e,t)=>(t||document).querySelector(e),c=(e,t)=>{const i=t||document;return Array.from(i.querySelectorAll(e))},d=async e=>{if("function"!=typeof e.querySelectorAll)return;const t=await s();if("desktop"===t.layoutType){if(window.DDC.modules&&window.DDC.modules.dialog&&!window.DDC.modules.dialog.active&&jQuery(document).trigger("modulesRefresh",{modules:{dialog:window.DDC.modules.dialog}}),window.DDC.modules&&window.DDC.modules.popover){c('[data-toggle="popover"]',e).forEach((e=>{!0!==e.getAttribute("data-initialized")&&window.DDC.modules.popover.load(e)}))}}else if("mobile"===t.layoutType&&"function"==typeof o(["DDC","mobile","slidein","init"],window)){const t=c('.dialog, [data-toggle="popover"]',e);t.length>0&&t.forEach((e=>{window.DDC.mobile.slidein.init(e)}))}},l=async(e,t,i)=>fetch(t,{headers:{Accept:"application/json"}}).then((a=>{if(!a.ok)throw e.integrationId&&n(e,{methodType:i,status:"Failed"}),new Error(`Error calling the endpoint at ${t}.`);return e.integrationId&&n(e,{methodType:i,status:"Success"}),0===a.size?{}:a.json()})),h=e=>window.DDC&&window.DDC.getUrlParams?(e&&n(e,{methodType:"getUrlParams",status:"Success"}),window.DDC.getUrlParams()):(e&&n(e,{methodType:"getUrlParams",status:"Failed"}),null),p=e=>{const t=o(["DDC","dataLayer","page","attributes","locale"],window)||"en_US";let i;return"object"==typeof e?i=e[t]?e[t]:e.en_US:"string"==typeof e&&(i=e),i},u=()=>{const e=o(["DDC","InvData","inventory","inventory"],window)&&o(["DDC","InvData","inventory","pageInfo","totalCount"],window)>=0&&o(["DDC","dataLayer","vehicles"],window).length>=0;return void 0!==e&&!0===e},g=()=>{const e=!window.DDC.InvData&&o(["DDC","dataLayer","vehicles"],window).length>=0&&!r(".inventory-listing-grid .hproduct");return void 0!==e&&!0===e},y=()=>!!r(".inventory-listing-grid .hproduct"),m=async()=>new Promise((async e=>{const t=await s();if(!t.searchPage&&!t.detailPage)return void e(!0);let i;i=setInterval((()=>{(g()||u()||y())&&(clearInterval(i),e(!0))}),250)})),w=["[data-location]",".ws-tps-placeholder",".ddc-content"],f=(e,t,i)=>{const a=i.querySelectorAll?i.querySelectorAll("a"):[];[i,...a].forEach((e=>{const t=e.getAttribute?e.getAttribute("href"):e.href;!t||t.startsWith("/")&&!t.startsWith("//")||e.setAttribute("rel","nofollow")})),t.appendChild(i),t.classList&&t.classList.remove("hide","hidden"),d(t),w.forEach((e=>{const n=t.closest(e);n&&("primary-banner"===n.getAttribute("data-location")&&i.querySelector("img")&&i.querySelector("img").classList.add("align-center"),n.outerHTML&&n.outerHTML.includes("vehicle-media-container")&&(n.innerHTML="",n.appendChild(t)),n.classList.remove("hide","hidden"))})),n(e,{methodType:"Append",appendElement:i.tagName})},v=(e,...t)=>{const i="object"==typeof e?e.integrationId:e;window.DDC.integrationLog(i,...t)},b=()=>{const e=h();return e&&"debug"===e._integrationMode},C=()=>{const e=h();return e&&(b()&&"trace"===e._integrationLogLevel||"trace"===e._integrationMode)};b();const D=C();class P{constructor(e){this.name=e,this.getElements=this.getElements.bind(this),this.getMeta=this.getMeta.bind(this),this.isReady=this.isReady.bind(this)}isReady(){}async getElements(){const e=`[data-location~="${this.name}"]`,t=Array.from(document.querySelectorAll(e));return 0===t.length&&D&&v("WARNING",`The '${this.name}' location was targeted on this page but does not exist.`),t}getConfig(){return{elementType:"div"}}getMeta(e){return null}}const I=e=>parseInt(e.replace(" ","").replace("Â ","").replace("$","").replace(",","").trim(),10)||0,E=["askingPrice","internetPrice","msrp","oemPriceMapHighMSRP","retailValue","salePrice"],T=async e=>(window.DDC.PrivateAPI=window.DDC.PrivateAPI||{},window.DDC.PrivateAPI.inventoryData||("responsive"===e?window.DDC.PrivateAPI.inventoryData=await(()=>{const e=window.DDC.dataLayer.vehicles||[],t=window.DDC.InvData&&window.DDC.InvData.inventory?window.DDC.InvData.inventory.inventory:[],i=["accountId","address","autodataCaId","bodyStyle","certified","chromeId","classification","dealerCodes","doors","driveLine","engine","engineSize","exteriorColor","fuelType","images","interiorColor","inventoryDate","inventoryType","make","model","modelCode","odometer","optionCodes","packageCode","stockNumber","transmission","trim","uuid","vin"],n={cityFuelEfficiency:"cityFuelEconomy",highwayFuelEfficiency:"highwayFuelEconomy"};return e.map((e=>{let a=e.inventoryType.toLowerCase();a.indexOf("pre")>-1||"d'occasion"===a||"usado"===a?a="used":"neuf"!==a&&"nuevo"!==a||(a="new");const s={inventoryType:a,highestPrice:0,startingPrice:0,year:e.modelYear};i.forEach((t=>{void 0===e[t]||s[t]||(s[t]=e[t])})),s.status=e.status?e.status.replace(" ","_").toLowerCase():"",Object.entries(n).forEach((t=>{e[t[0]]&&(s[t[1]]=e[t[0]])})),void 0!==e.link&&(s.link=`${window.location.origin}${e.link}`),s.images&&s.images.length>0&&s.images[0].uri&&(s.images=[s.images[0].uri]);const[o]=t.filter((e=>e.uuid===s.uuid&&e)),r=o.pricing.dPrice;let c=!1;return o&&r&&(Object.entries(r).forEach((e=>{if(e.length<2)return;const t=e[1],i=t.typeClass;if(i&&(E.includes(i)||t.isFinalPrice)){const e="PLEASE_CALL"===t.value?0:I(t.value);e>0&&(e>s.highestPrice&&(s.highestPrice=e),E.includes(i)&&(s[i]=e),t.isFinalPrice&&s.highestPrice>0&&s.highestPrice/3<e&&(s.finalPrice=e),!1===c&&(s.startingPrice=e,c=!0))}})),!s.finalPrice&&s.startingPrice&&(s.finalPrice=s.startingPrice)),E.forEach((t=>{!s[t]&&e[t]&&(s[t]=I(e[t]))})),s}))})():"legacy"===e?window.DDC.PrivateAPI.inventoryData=await(async()=>{const e=await s();if(!window.DDC.dataLayer)return[];const t=window.DDC.dataLayer.vehicles||[],i=e.detailPage&&t.length>0?[t[0]]:c("[data-uuid]"),n=[...E,"oemPriceMapHighMSRP","stackedConditionalFinal","conditional-final-price","final-price","stackedFinal"];let a=[];return n.forEach((e=>{a.push(`.${e} .value`),a.push(`.${e} .price`),a.push(`.${e} .price-value`)})),a.push(".final-price .price"),a=a.join(", "),i.map((i=>{const s=[];let o,d,l,h,p=0,u=0,{uuid:g}=i;if(e.detailPage)l=r(".ws-detailed-pricing, .inventory-detail-pricing"),o=`${window.location.origin}${window.location.pathname}`;else if(e.searchPage&&r(".hproduct",i)){l=r(".hproduct",i),g=i.getAttribute("data-uuid");const e=r(".url",l);e&&e.href&&(o=e.href)}if(l&&"string"==typeof l.dealerCodes&&(l.dealerCodes=JSON.parse(l.dealerCodes)),t.length>0){if([h]=t.filter((e=>e.uuid===g&&e)),!h)return v("INFO",`No data found in data layer for vehicle UUID ${g}. Skipping.`),!1}else l&&(h=l);h.address&&h.accountName&&(h.address.accountName=h.accountName),h.images&&h.images.length>0&&s.push(h.images[0].uri),e.detailPage?d=c(a):e.searchPage&&l&&(d=c(a,l));let y=!1;d.length>0&&d.forEach((e=>{(e.parentElement&&e.parentElement.classList.length>0?Array.from(e.parentElement.classList):[]).forEach((t=>{if(n.includes(t)){const t=I(e.innerText);t&&!y&&(u=t,y=!0);const i=p/3<t;(0===p||p>0&&i)&&(p=t)}}))}));const m={accountId:h.accountId||"",address:h.address||{},autodataCaId:h.autodataCaId||"",bodyStyle:h.bodyStyle||"",certified:"certified"===h.inventoryType||"true"===h.certified,chromeId:h.chromeId||"",cityFuelEconomy:parseInt(h.cityFuelEfficiency,10)||0,classification:h.classification||"",dealerCodes:"string"==typeof h.dealerCodes?JSON.parse(h.dealerCodes):h.dealerCodes||{},doors:h.doors||"",driveLine:h.driveLine||"",engine:h.engine||"",engineSize:h.engineSize||"",exteriorColor:h.exteriorColor||"",finalPrice:p,fuelType:h.fuelType||"",highwayFuelEconomy:parseInt(h.highwayFuelEfficiency,10)||0,images:s,interiorColor:h.interiorColor||"",inventoryDate:h.inventoryDate||"",inventoryType:h.newOrUsed||h.inventoryType||"",link:o,make:h.make||"",model:h.model||"",modelCode:h.modelCode||"",odometer:parseInt(h.odometer,10)||0,optionCodes:h.optionCodesOther&&h.optionCodesOther.length?h.optionCodesOther:h.optionCodes||[],packageCode:h.packageCode||"",packages:h.packages?h.packages:"",startingPrice:u,status:h.status?h.status.replace(" ","_").toLowerCase():"",stockNumber:h.stockNumber||"",transmission:h.transmission||"",trim:h.trim||"",uuid:h.uuid||"",vin:h.vin||"",year:parseInt(h.modelYear,10)||0};return E.forEach((e=>{if(h[e]){const t=parseInt(h[e],10);t>0&&(m[e]=t,(!m.highestPrice||t>m.highestPrice)&&(m.highestPrice=t))}})),m.finalPrice>m.highestPrice&&(m.highestPrice=m.finalPrice),m.startingPrice>m.highestPrice&&(m.highestPrice=m.startingPrice),0===m.finalPrice&&(m.startingPrice>0?m.finalPrice=m.startingPrice:m.highestPrice>0&&(m.finalPrice=m.highestPrice)),m}))})():"grid"===e&&(window.DDC.PrivateAPI.inventoryData=await(async()=>(await s()).searchPage&&0!==c(".inventory-listing-grid").length?c("[data-uuid]").map((e=>{const t=e.dataset,i=[],n=r(".url",e),a=n&&n.href?n.href:"";let s=0,o=0,d=0;const l=c(".image-wrap img",e);if(l.length>0){const e=l[0];e.getAttribute("data-src")?i.push(e.getAttribute("data-src").split("?")[0]):e.src&&i.push(e.src.split("?")[0]),t.images=i}if(!t)return v("INFO","Vehicle data not found. Aborting inventory events."),!1;if(e.querySelectorAll){const t=c(".detailed-pricing .value, .gv-pricing .value",e);let i=!1;t.forEach((e=>{if(null===e.offsetParent||e.parentElement.classList.contains("stackedConditionalRebate")||e.parentElement.classList.contains("stackedConditionalFinal"))return;const t=I(e.innerText);t&&(t>s&&(s=t),i||(o=t,i=!0),(e.parentElement.classList.contains("stackedFinal")||e.parentElement.classList.contains("finalPrice"))&&(d=t))}))}const h="string"==typeof t.dealercodes?t.dealercodes.replace("{","").replace("}","").split(",").map((e=>e.split("=").map((e=>e.trim())))).reduce(((e,[t,i])=>(e[t]=i,e)),{}):{},p="string"==typeof t.optioncodes?t.optioncodes.replace(/[[\]\s]/gi,"").split(","):[],u={accountId:t.accountid||"",address:t.address||{},autodataCaId:t.autodatacaid||"",bodyStyle:t.bodystyle||"",certified:"certified"===t.inventorytype||"true"===t.certified,chromeId:t.chromeid||"",cityFuelEconomy:parseInt(t.cityfueleconomy,10)||0,classification:t.classification||"",dealerCodes:h,doors:t.doors||"",driveLine:t.driveline||"",engine:t.engine||"",engineSize:t.enginesize||"",exteriorColor:t.exteriorcolor||"",finalPrice:d,fuelType:t.fueltype||"",highwayFuelEconomy:parseInt(t.highwayfueleconomy,10)||0,highestPrice:s,images:i,interiorColor:t.interiorcolor||"",inventoryDate:t.inventorydate||"",inventoryType:"certified"===t.type?"used":t.type||"",link:a,make:t.make||"",model:t.model||"",modelCode:t.modelcode||"",msrp:parseInt(t.msrp,10)||0,odometer:parseInt(t.odometer,10)||0,optionCodes:p,packageCode:t.packagecode||"",packages:t.packages?t.packages:"",startingPrice:o,status:t.status?t.status.replace(" ","_").toLowerCase():"",stockNumber:t.stocknumber||"",transmission:t.transmission||"",trim:t.trim||"",uuid:t.uuid||"",vin:t.vin||"",year:parseInt(t.year,10)||0};return E.forEach((e=>{const i=e.toLowerCase();t[i]&&parseInt(t[i],10)>0&&(u[e]=parseInt(t[i],10))})),u})):(v("INFO","Not a grid view inventory page. Skipping further inventory processing."),!1))())),window.DDC.PrivateAPI.inventoryData),A=async()=>(await m(),u()?T("responsive"):g()?T("legacy"):y()?T("grid"):[]),L=async e=>{const t=await s(),i=await A(),n=window.DDC.dataLayer.vehicles||[],a=t.detailPage&&n.length>0?n[0].uuid:e.closest("[data-uuid]").getAttribute("data-uuid"),o=i.filter((e=>e.uuid===a&&e));return o.length>0?o[0]:null},k=async(e,t)=>{const i=[];return(await A()).forEach((e=>{e[t]&&i.push(e[t])})),n(e,{methodType:"getAttributeForVehicles",status:"Success"}),i},S="vehicle-card-badge badge hidden";class j extends P{constructor(e){super(),this.name=e}isReady(){return m()}getMeta(e){return L(e)}}const x="Insert",O="Insert Call To Action",N="Modify Call To Action",M="Restrictively Modify Call To Action",F="Update",W=Object.freeze({content:new class extends P{constructor(){super("content")}getMeta(){return s()}},"digital-retailing":new class extends P{constructor(){super("digital-retailing")}isReady(){return m()}getMeta(e){return L(e)}},heading:new class extends P{constructor(){super("heading")}getMeta(){return s()}},"page-footer":new class extends P{constructor(){super("page-footer")}getMeta(){return s()}},"primary-banner":new class extends P{constructor(){super("primary-banner")}getConfig(){return{classes:"my-3"}}getMeta(){return s()}},"secondary-content":new class extends P{constructor(){super("secondary-content")}getMeta(){return s()}},"vehicle-badge":new class extends P{constructor(){super("vehicle-badge")}isReady(){return m()}getConfig(){return{classes:`${S} m-3 p-0`,elementType:"li",gridSrpClasses:`${S} align-center m-0 p-3`,responsiveSrpClasses:`${S} m-2 py-3`,vdpClasses:`${S} align-center`}}getMeta(e){return L(e)}},"vehicle-ctas":new class extends P{constructor(){super("vehicle-ctas")}isReady(){return m()}getConfig(){return{classes:"mb-3"}}getMeta(e){return L(e)}},"vehicle-media":new class extends P{constructor(){super("vehicle-media")}isReady(){return m()}getConfig(){return{classes:"badge m-0 mt-3",elementType:"li",gridSrpClasses:"badge m-0",placement:"first",responsiveSrpClasses:"m-0 mb-3 px-3",vdpClasses:"m-0"}}getMeta(e){return L(e)}},"vehicle-media-container":new class extends P{constructor(){super("vehicle-media-container")}isReady(){return m()}getMeta(e){return L(e)}},"vehicle-pricing":new class extends P{constructor(){super("vehicle-pricing")}isReady(){return m()}getConfig(){return{classes:"mb-3"}}getMeta(e){return L(e)}}}),R=["ask","drive"],V=[],U={},_={};["chat","check-availability","digital-retailing","eprice","location-finder","payment-calculator","pre-approval","request-a-quote","reserve-it-now","send-to-phone","social","test-drive","text-us","value-a-trade","window-sticker"].forEach((e=>{const t=`vehicle-${e}-button`;U[t]=new j(t)})),R.forEach((e=>{const t=`vehicle-${e}-button`;V.push(t),_[t]=new j(t)}));const q=Object.freeze({...U,..._}),J=Object.keys(W),H=Object.keys(U),z=Object.keys(_),G=o(["DDC","dataLayer","page","pageInfo","isVlp"],window)&&!!r(".ws-inv-listing"),K=(e,t)=>("object"==typeof t&&Object.keys(t).forEach((i=>{i&&e.setAttribute(i,t[i])})),e),B=(e,t,i,n=!0)=>{const a=!e.destinationLocation||!V.includes(e.destinationLocation);let s=t.parentNode?t.cloneNode(!0):t;t.parentNode&&t.parentNode.replaceChild(s,t);const o=p(i.text);if(i.href?s.href=i.href:i.src?s.href=i.src:(s.removeAttribute("href"),s.removeAttribute("data-href")),i.style&&"string"==typeof i.style&&(s.style=i.style.trim()),n&&a&&(s.classList.add("btn","btn-block"),G&&s.classList.add("btn-sm"),s.classList.remove("btn-default","btn-primary")),i.imgSrc){s.innerHTML="";let e=document.createElement("img");e.src=i.imgSrc,e.alt=i.imgAlt?p(i.imgAlt):o,i.imgClasses&&(e.className=i.imgClasses),e=K(e,i.imgAttributes),s.appendChild(e)}else o&&(s.innerHTML=o,s.setAttribute("alt",o),a&&("primary"===i.type||"text"===i.type?s.classList.add(`btn-${i.type}`):s.classList.add("btn-default")));if(i.onclick&&s.addEventListener("click",i.onclick),i.target&&s.setAttribute("target",i.target),["data-width","data-dialog-class"].forEach((e=>{s.removeAttribute(e)})),s=K(s,i.attributes),["dialog","hide","hidden"].forEach((e=>{s.classList.remove(e)})),i.classes&&""!==i.classes.trim()&&i.classes.trim().split(" ").forEach((e=>{s.classList.add(e)})),e.init&&e.init.integrationId&&s.setAttribute("data-modified-by",e.init.integrationId),s.setAttribute("data-content-source","Web Integration API"),e.targetLocation&&s.setAttribute("data-content-intent",e.targetLocation),e.destinationLocation&&s.setAttribute("data-content-destination",e.destinationLocation),i.popover){const e={toggle:"popover",animation:i.popover.animation||!0,container:i.popover.container||"body","delay-show":i.popover.delayShow||0,"delay-hide":i.popover.delayHide||0,title:p(i.popover.title)||"",content:p(i.popover.content)||"",html:i.popover.html||"",placement:i.popover.placement||"left",trigger:i.popover.trigger||"hover"};Object.keys(e).forEach((t=>{s.setAttribute(`data-${t}`,e[t])}))}return s};class Y{constructor(){this.data={},this.push=this.push.bind(this),this.forEach=this.forEach.bind(this),this.ensureListForKey=this.ensureListForKey.bind(this),this.clear=this.clear.bind(this)}push(e,...t){this.ensureListForKey(e).push(...t)}forEach(e,...t){this.ensureListForKey(e).forEach(...t)}ensureListForKey(e){return void 0===this.data[e]&&(this.data[e]=[]),this.data[e]}clear(){this.data={}}}const Q=Object.freeze({"schedule-service":new class extends class{constructor(e){this.name=e,this.getElements=this.getElements.bind(this),this.getMeta=this.getMeta.bind(this),this.isReady=this.isReady.bind(this)}isReady(){}getElements(){const e=`[data-location~="${this.name}"]`,t=Array.from(document.querySelectorAll(e));return 0===t.length&&D&&v("WARNING",`The '${this.name}' location was targeted on this page but does not exist.`),t}getConfig(){return{elementType:"div"}}getMeta(e){return null}}{constructor(){super("page-schedule-service-button")}}}),X=Object.keys(Q),Z=(e,t)=>{if("string"!=typeof e||0===e.length)throw new Error(`${t} must be a non-zero length string. Got: ${e}.`)},ee=(e,t)=>{if(!e||"object"!=typeof e)throw new Error(`${t} must be an object. Got: ${e}.`)},te=(e,t=[],i)=>{const n=Object.keys(e),a=[];if(!n.every((e=>{const i=t.indexOf(e)>=0;return i||a.push(e),i})))throw new Error(`Found the following invalid props '${a.join(", ")}'. Only the following props are allowed '${t.join(", ")}', in ${i}.`)},ie=(e,t)=>{ee(e,t),Z(e.integrationId,"integrationId"),Z(e.integrationType,"integrationType")};class ne{constructor(e,t){ie(e,"init"),this.init=e,this.callback=t}}const ae=new Y,se=new Y,oe=(e,t,i)=>{try{t((n=i,JSON.parse(JSON.stringify(n))))}catch(t){v(`Callback failed: ${e} ${JSON.stringify(i)}.`,t)}var n},re=["vehicle-media"],ce=["image"],de=["primary","secondary","last"],le={"vehicle-media":{}};de.forEach((e=>{le["vehicle-media"][e]=[]}));const he=e=>{if(!re.includes(e))throw new Error(`Unsupported gallery: '${e}'. Expected one of: ${re.join(", ")}.`)},pe=window._.debounce((()=>{$(document).trigger("wiapiVehicleMediaUpdated")}),100),ue={},ge=(e,t,i)=>{(e=>{if(ue[e])throw new Error(`The location '${e}' has already been modified by integration '${ue[e].integration}'.`)})(t),ue[t]={integration:e,...i},(e=>window._.debounce((()=>{window.dispatchEvent(new CustomEvent("wiapiPageModificationUpdate",{detail:{location:e}}))}),100))(t)()};class ye{constructor(i,n,a,s,o){const r="string"==typeof i?i:i.integrationId,c="string"==typeof i?i:i.integrationType;Z(r,"integrationId"),Z(n,"src"),Z(a,"type"),((e,t)=>{if(!(e instanceof Map))throw new Error(`${t} must be a Map. Got: ${typeof e}.`)})(s,"attributes"),this.init={integrationId:e(r),integrationType:t(c)},this.src=n,this.fileType=a,this.attr=s,this.headLocation=document.head,this.bodyLocation=document.body,this.immutableAttr=["data-web-api-id","data-web-api-type","async","type","src"],this.methodType=this.fileType?`load${this.fileType.toUpperCase()}`:"Load",this.isIntegrationLoad=o,this.load=this.load.bind(this),this.invoked=!1}load(e){if(this.invoked)return new Promise((e=>{e(`Resource ${this.src} already loaded.`)}));const t=e=>{const t=this.isIntegrationLoad?"Integration Loaded":this.methodType;n(this.init,{methodType:t,load:this.src,status:e})},i=()=>(this.invoked=!0,new Promise(((e,i)=>{const n="js"===this.fileType?"script":"link",a=document.createElement(n);switch(a.setAttribute("data-web-api-id",this.init.integrationId),a.setAttribute("data-web-api-type",this.init.integrationType),n){case"script":a.type="text/javascript",a.src=this.src,a.async=!0,this.attr.forEach(((e,t)=>{this.immutableAttr.includes(t)||a.setAttribute(t,e)})),this.bodyLocation.appendChild(a);break;case"link":a.type="text/css",a.rel="stylesheet",a.media="all",a.href=this.src,this.headLocation.appendChild(a)}a.onload=()=>{this.invoked=!0,t("Success"),e(this.src)},a.onerror=()=>{t("Failed"),i(this.src)}})).catch((e=>{v(this.init.integrationId,`ERROR: ${e.toString()} failed to load!`)})));return["all","css"].includes(e)&&"css"===this.fileType||["all","js"].includes(e)&&"js"===this.fileType?i():"unknown"===this.fileType&&new Promise(((e,t)=>{t(new Error(`Failed to load unknown resource type of file ${this.src}`))}))}}const me=[],we=h(),fe=async(e,t,i,n=new Map,a)=>{const s=i||(e=>e.includes(".css")||e.includes("/css")?"css":e.includes(".js")||e.includes("/js")?"js":"unknown")(t),o=new ye(e,t,s,n,a);return!!me.some((e=>e.src===t))||(me.push(o),await(async()=>new Promise((e=>{"loading"!==document.readyState&&e(!0),window.addEventListener("DOMContentLoaded",(()=>{e(!0)}))})))(),o.load(s))},ve=(e,t,i,n=!1)=>fe(e,t,"js",i,n),be=e=>me.forEach((t=>{t.invoked||t.load(e)})),Ce=(e=>{const t=`${e}=`,i=document.cookie.split(";");for(let e=0;e<i.length;e++){let n=i[e];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null})("WebIntegrationAPITestLoader");if(Ce&&void 0!==we._integrationMode){const e=Ce.split("|"),t=e[0],i=e[1];fe(t,i)}let De=!1;const Pe=async()=>{if(!De){const e=await s(),t="/api/ipp/config/services",i=[`integrationType=${["api","api_compatible"].join(",")}`,`deviceType=${e.layoutType}`,`pageAlias=${e.pageName}`,`siteId=${e.siteId}`];De=l({},`${t}?${i.join("&")}`,"loadConfigs")}return De},Ie=async(e,t,i)=>{const a=await Pe();n(e,{methodType:t,status:"Success"});const s=o([e.integrationId,...i],a);return null===s?{}:s},Ee=(e,t,i)=>{void 0===window.DDC.PrivateAPI&&(window.DDC.PrivateAPI={}),void 0===window.DDC.PrivateAPI.timings&&(window.DDC.PrivateAPI.timings={}),void 0===window.DDC.PrivateAPI.timings[e]&&(window.DDC.PrivateAPI.timings[e]={}),void 0===window.DDC.PrivateAPI.timings[e][t]&&(window.DDC.PrivateAPI.timings[e][t]=[]),window.DDC.PrivateAPI.timings[e][t].push(i)};class Te{constructor(e,t,i,n,a,s,o){const r=s||n;ie(e,"init"),((e,t)=>{let i=J;if(e===F&&(i=H),e===N&&(i=[...H,...J]),e===M&&(i=z),!i.includes(t))throw new Error(`Invalid location: ${t}. Valid options are: ${i.join(", ")}.`)})(i,r),this.init=e,this.methodType=i,this.targetLocation=r,this.destinationLocation=null,this.defaultLocation=n,this.integrationCall=o,this.hasInsertSite=this.hasInsertSite.bind(this),this.getInsertSite=this.getInsertSite.bind(this),this.apply=this.apply.bind(this),this.timingKey=`${this.init.integrationId}-${this.targetLocation}`}hasInsertSite(e){return e.querySelector(`[data-web-api-id="${this.init.integrationId}"]`)}getInsertSite(e,t){const i=t&&t.elementType?t.elementType:"div",n=document.createElement(i);if(n.setAttribute("data-web-api-id",this.init.integrationId),t)if(t.style&&n.setAttribute("style",t.style),t.responsiveSrpClasses&&u())n.setAttribute("class",t.responsiveSrpClasses);else if(t.gridSrpClasses&&y())n.setAttribute("class",t.gridSrpClasses);else if(t.vdpClasses&&o(["DDC","dataLayer","page","pageInfo","isVdp"],window)){let i="p-4";e.getAttribute("data-list-classes")&&(i=e.getAttribute("data-list-classes")),n.setAttribute("class",`${t.vdpClasses} ${i}`)}else t.classes&&n.setAttribute("class",t.classes);return t.placement&&"first"===t.placement&&e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n),n}async apply(){const e=Date.now();let t=null;if(this.methodType===N||this.methodType===M){const e=await(async e=>Ie(e,"getContentMappings",["contentMappings"]))(this.init),i=e.buttons||e.button;i&&Object.entries(i).forEach((e=>{const[i,n]=e;i===this.targetLocation&&n&&(t=q[n]?q[n]:new j(n),this.destinationLocation=n)})),await m(),t&&("hidden"===t.name||document.querySelector(`[data-location="${t.name}"]`))||(t=W[this.defaultLocation],this.methodType=O)}else this.methodType===O?t=W[this.defaultLocation]:this.methodType===x?t=W[this.targetLocation]:this.methodType===F&&(t=q[this.targetLocation]);if(!t)return;await t.isReady();const i=await t.getElements(),a=await t.getConfig();setTimeout((()=>{i&&Array.from(i).forEach((async i=>{try{if(this.hasInsertSite(i))return;const s=await t.getMeta(i);if(this.methodType===O||this.methodType===N||this.methodType===M){const e=this.integrationCall(s);if("object"!=typeof e)return;{let n=e;if(this.methodType===M){const{href:i,target:a,onclick:s,popover:o,attributes:r,...c}=e;n={href:i,target:a,onclick:s,popover:o,attributes:r};const d=Object.keys(c||{});if(d.length){const e=d.join(", ");v(this.init.integrationId,`tried to modify the following button attributes ${e} of ${t.name} which is not allowed.`)}}const s=this.methodType===O?document.createElement("a"):i,o=B(this,s,n);this.methodType===O&&f(this.init,this.getInsertSite(i,a),o),d(o)}}else this.methodType===x?this.integrationCall(this.getInsertSite(i,a),s):this.methodType===F&&(v("WARNING: The `API.update` method is deprecated and will soon be removed. Please use `API.insertCallToAction` instead. For details, please visit https://dealerdotcom.github.io/web-integration-api-docs/#api-insertcalltoaction-type-intent-setupfunction-meta"),this.integrationCall(i,s));i.closest("[data-location]").classList.remove("hide","hidden"),n(this.init,{methodType:this.methodType,status:"Success",locationName:this.targetLocation});const o=Date.now();Ee(this.methodType,this.timingKey,o-e)}catch(t){const i=Date.now();v(this.init.integrationId,`Failed to edit into ${this.targetLocation} and took ${i-e}ms to fail... ${t}`),n(this.init,{methodType:this.methodType,status:"Failed",locationName:this.targetLocation,message:t})}}))}),0)}}const Ae=[],Le=[],ke=(e,t,i,a,s,o,r,c=!0)=>{const d=new Te(i,e,t,a,s,o,r);c&&(t===x?Ae.push(d):[F,N,M].includes(t)&&Le.push(d)),d.apply();n(i,{methodType:t,locationName:o||a})},Se=(e,t,i,n=!0)=>ke("insert",x,e,t,null,null,i,n),$e=(e,t,i,n,a=!0)=>{let s,o=null;"button"===t&&(o="vehicle-ctas",s=`vehicle-${i}-button`);const r=R.includes(i)?M:N;return ke("insertCallToAction",r,e,o,t,s,n,a)},je=(e,t,i,n=!0)=>ke("update",F,e,t,null,null,i,n);class xe{constructor(e,t,i){ie(e,"init"),(e=>{if(Z(e,"locationName"),!X.includes(e))throw new Error(`Invalid location: ${e}. Valid options are: ${X.join(", ")}.`)})(t),((e,t)=>{ee(t,"Modifier");const{schema:i}=t;switch(e){case"schedule-service":ee(i,"Schema of the modifier object"),te(t,["schema"],`Modifier object of ${e}.`),te(i,["href","target","onclick","popover","attributes"],`the schema of the modifier object  of ${e}.`)}})(t,i),ge(e.integrationId,t,i);const{schema:n,callback:a}=i;this.init=e,this.location=t,this.locationHandler=Q[this.location],this.schema=n,this.integrationCall=a,this.apply=this.apply.bind(this)}async apply(){await this.locationHandler.isReady();const e=this.locationHandler.getElements();e&&e.forEach((e=>{switch(this.location){case"schedule-service":{const t=B(this,e,this.schema,!1);d(t);break}}}))}}class Oe{constructor(e){(e=>{if(Z(e,"event type"),!e.match(/.*-v\d+/))throw new Error(`Event types must end with a version (like -v1). Got: ${e}.`)})(e),this.eventType=e,this.fireEvent=this.fireEvent.bind(this),this.invoke=this.invoke.bind(this)}fireEvent(e){(e=>{if(!e.type)throw new Error("Events must have a type property.");const t={...e,timestamp:new Date};se.forEach(e.type,(e=>{oe(e.init.integrationId,e.callback,t)})),ae.push(e.type,t)})({type:this.eventType,...e})}invoke(){throw new Error("Event emitters should override invoke to fire events.")}}class Ne extends Oe{constructor(e){super(e),this.invokeOnce=this.invokeOnce.bind(this),this.invoked=!1}invoke(){this.invoked||(this.invokeOnce(),this.invoked=!0)}}const Me=()=>{const{dealership:e={}}=window.DDC.dataLayer||{};return{dealershipName:e.dealershipName||"",dealershipAddress1:e.address1||"",dealershipAddress2:e.address2||"",dealershipCity:e.city||"",dealershipStateProvince:e.stateProvince||"",dealershipPostalCode:e.postalCode||"",dealershipCountry:e.country||""}};const Fe=(e,t)=>r(`[data-location="${t}"]`,e),We=(e,t,i)=>{const n=document.createElement(e);return n.setAttribute("data-location",t),n.setAttribute("class","hidden"),i&&i.split(" ").forEach((e=>{n.classList.add(e)})),n},Re=(e,t)=>{e.parentNode.insertBefore(t,e.nextSibling)},Ve=(e,t)=>{e.parentNode.insertBefore(t,e)},Ue=(e,t)=>{e.appendChild(t)},_e=new Map([["ASK","vehicle-ask-button"],["DRIVE","vehicle-drive-button"]]),qe=async()=>{const e=await s();return e.searchPage&&r(".inventory-listing-grid")?c(".gv-pricing").forEach((e=>{Fe(e,"vehicle-media")||e.appendChild(We("ul","vehicle-media","list-unstyled d-flex flex-column justify-content-center w-100")),Fe(e,"vehicle-ctas")||e.appendChild(We("div","vehicle-ctas")),Fe(e,"vehicle-pricing")||e.appendChild(We("div","vehicle-pricing")),Fe(e,"vehicle-badge")||e.appendChild(We("ul","vehicle-badge","list-unstyled d-flex flex-wrap justify-content-center"))})):(e.searchPage||e.detailPage)&&(await(async e=>{if(!Fe(document,"primary-banner")){const t=We("div","primary-banner","ddc-content web-api-added-placeholder");let i;e.detailPage?(i=r('[data-widget-id="tps-mediabot1"]')?r('[data-widget-id="tps-mediabot1"]'):r('[data-widget-name="ws-quick-specs"]'),i||(i=r('[data-widget-name="inventory-detail-highlighted-features"]'))):e.searchPage&&(i=r('[data-name="srp-wrapper-page-title"]')||r('[data-widget-name="inventory-listing-default"]')),i&&Ve(i,t)}return!0})(e),await(async e=>{if(!e.detailPage&&!e.searchPage)return!0;if(e.detailPage&&r('[data-widget-id="links-lead1"]')){const e=c('[data-widget-id="links-lead1"] .btn');e.length>0&&e.forEach((e=>{const t=e.getAttribute("data-link-label");t&&_e.has(t)&&!e.getAttribute("data-location")&&e.setAttribute("data-location",_e.get(t))}))}if(e.detailPage&&r('[data-widget-name="ws-vehicle-ctas"]')){const e=c('[data-widget-name="ws-vehicle-ctas"]');e.length>0&&e.forEach((e=>{e.setAttribute("data-location","vehicle-ctas"),c('[data-location="vehicle-ctas"]',e).forEach((e=>{e.removeAttribute("data-location"),e.classList.add("mb-3")}))}))}else{let t=[];if(e.searchPage)t=c(".pricing-area .pricing");else if(e.detailPage){const e=r(".inventory-detail-pricing .pricing");e&&t.push(e)}t.forEach((e=>{const t=document.createElement("li");t.setAttribute("data-location","vehicle-ctas"),t.setAttribute("class","web-api-added-placeholder hidden mt-3"),Ue(e,t)}))}return!0})(e),await(async e=>{if(e.detailPage){const t=c('[data-location="vehicle-ctas"]');if(t.length>0){const i=t[t.length-1],n="mobile"===e.layoutType?"ddc-content responsive-content-max-hide responsive-content-mid-hide responsive-content-min-hide box mx-4 pl-4 pr-4 pt-0 pb-0 mt-0 mb-0 web-api-added-placeholder hidden":"ddc-content web-api-added-placeholder hidden",a=We(i.tagName.toLowerCase(),"vehicle-pricing",n);i.classList.add("pb-0"),Re(i,a)}}else e.searchPage&&c(".pricing-area .pricing").forEach((e=>{const t=We("li","vehicle-pricing","web-api-added-placeholder hidden mb-4");Ue(e,t)}));return!0})(e),e.searchPage&&r(".inventoryList")?(c(".hproduct .media").forEach((e=>{Fe(e,"vehicle-media")||e.appendChild(We("ul","vehicle-media","list-unstyled d-flex flex-column"))})),c(".hproduct .calloutDetails ul").forEach((e=>{Fe(e,"vehicle-badge")||e.setAttribute("data-location","vehicle-badge")}))):e.detailPage&&((async e=>{if(e.detailPage&&!Fe(document,"vehicle-media")){const e=r('[data-widget-name="inventory-detail-highlighted-features"]');if(e){const t=We("ul","vehicle-media","list-unstyled web-api-added-placeholder");Ve(e,t)}}if(!Fe(document,"vehicle-badge")){const e=r(".calloutDetails ul");e&&e.setAttribute("data-location","vehicle-badge")}})(e),await(async e=>{if(!e.detailPage)return!0;if(!Fe(document,"secondary-content")){const e=We("div","secondary-content","ddc-content web-api-added-placeholder"),t=r('[data-widget-id="detailed-specs1"]');t&&Re(t,e)}return!0})(e))),!0},Je=[new class extends Ne{constructor(){super("page-load-v1")}async invokeOnce(){const e=await s();this.fireEvent({payload:e})}},new class extends Ne{constructor(){super("dealership-info-v1")}invokeOnce(){this.fireEvent({payload:Me()})}},new class extends Oe{constructor(){super("vehicle-data-updated-v1")}async invoke(){const e=await A(),t=await s();this.fireEvent({payload:{pageData:t,vehicleData:e}})}},new class extends Oe{constructor(){super("vehicle-shown-v1"),this.emittedVehicles=new Set,this.notificationSubscription=!1,this.currentViewportWidth=window.innerWidth,this.previousViewportWidth=window.innerWidth,this.debouncing=null}async invoke(){const e=await s(),t=async()=>{(await A()).forEach((e=>{this.emittedVehicles.has(e.uuid)||(this.fireEvent({payload:e}),this.emittedVehicles.add(e.uuid))}))},i=()=>{const i=()=>{clearTimeout(this.debouncing),this.currentViewportWidth=window.innerWidth,this.debouncing=setTimeout((()=>{(this.currentViewportWidth<=768&&this.previousViewportWidth>=768||this.currentViewportWidth>=768&&this.previousViewportWidth<=768)&&(this.previousViewportWidth=window.innerWidth,window.DDC.PrivateAPI.notifyDynamicContent())}),50)};(async()=>{await m(),await t(),e.searchPage&&u()&&(this.notificationSubscription||(window.DDC.InvData&&(window.DDC.InvData.registerInventoryNotification((()=>{window.DDC.PrivateAPI.inventoryData=null,window.DDC.PrivateAPI.notifyDynamicContent()})),window.DDC.InvData.registerToggleListingView((()=>{window.DDC.PrivateAPI.notifyDynamicContent()}))),window.addEventListener("resize",i,!1),this.notificationSubscription=!0))})()};(e.searchPage||e.detailPage)&&i()}}],He=async()=>(await qe(),await(async()=>{r("li.price-btn")&&c("li.price-btn").forEach((e=>{e.classList.add("clearfix")}));return!0})(),Je.forEach((e=>{const t=Date.now();try{e.invoke();const i=Date.now();window.DDC.integrationLog(`Firing event emitter: ${e.eventType}`),Ee("event-emitter",e.eventType,i-t)}catch(i){const n=Date.now();Ee("event-emitter-failed",e.eventType,n-t),window.DDC.integrationLog(`Event emitter ${e.eventType} failed and took ${n-t}ms to fail.`,i)}})),!0),ze={},Ge=async(e,t)=>{const i="getJwtForVehicles"===t?await k(e,"vin"):["false"];return fetch(`/api/ipp/jwt/vehicles?vins=${i.join()}`).then((i=>{if(!i.ok)throw n(e,{methodType:t,status:"Failed"}),new Error("Invalid response from the JWT endpoint.");return i.text().then((i=>{const a=(e=>{const t=e.split(".");if(t.length<2)return;const i=t[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(i).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""));return JSON.parse(n)})(i);return n(e,{methodType:t,status:"Success"}),"getJwtForVehicles"===t?{vins:a.VINs,jwt:i}:{jwt:i}}))}))};class Ke{constructor(e){this.init=e}getIntegrationId(){return this.init.integrationId}getIntegrationType(){return this.init.integrationType}}class Be extends Ke{constructor(e){super(),this.init=e}}[{className:Ke,methods:{getAttributeForVehicles:k,getConfig:async(t,i)=>{const a=o(["DDC","Integration","settings"],window);if(a){const i=await(async t=>{const{settings:i}=window.DDC.Integration;return Object.keys(i).forEach((t=>{e(t)!==t&&(i[e(t)]=i[t],delete i[t])})),void 0!==i[t.integrationId]&&(n(t,{methodType:"getConfigDeprecated",status:"Success"}),i[t.integrationId])})(t);if(!1!==i)return i}try{const e=await Pe(),o=await(async(e,t,i,a)=>{const o="object"==typeof i&&(b()||C()),r=h();if(t[e.integrationId]){if(o&&"override"===r._integrationConfig)return i;const a=t[e.integrationId].fields,c=await s();if(!t[e.integrationId].wiseIntegration){const t="mobile"===c.layoutType&&!0===a.enabledSeamless,i="desktop"===c.layoutType&&!0===a.enabledDesktop;if(!t&&!i)throw n(e,{methodType:"getConfig",status:`Disabled for ${c.layoutType}`}),new Error(`Config for ${e.integrationId} found but not enabled for the current device type.`)}const d=["includedPages","excludedPages","thirdPartyServiceDebug"],l={srp:"searchPage",vdp:"detailPage",index:"indexPage"},h=Object.keys(a).filter((e=>!d.includes(e)&&!e.startsWith("enabled")&&!e.startsWith("addTo"))).reduce(((t,i)=>{const n=t;if(i.split("-").length>1){const[t,s]=i.split("-");c[l[s]]&&(C()&&v(e.integrationId,`Using override key '${i}' to set field '${t}' to '${a[i]}' for '${l[s]}'.`),n[t]=a[i])}else i in n||(n[i]=a[i]);return n}),{});return n(e,{methodType:"getConfig",status:"Success"}),h}{if(o)return i;n(e,{methodType:"getConfig",status:"Not Found"});const s=a?[...Object.keys(t),...Object.keys(window.DDC.Integration.settings)]:Object.keys(t),r=s.length?`Integration configs are available only for the following -> ${[...new Set(s)].join(", ")}`:"";throw new Error(`Config for ${e.integrationId} not found. ${r}`)}})(t,e,i,a);if(o)return o}catch(e){n(t,{methodType:"getConfig",status:"Failed",message:e}),v(t,`Error calling getConfig. ${e}`)}return null},getDealerData:e=>new Promise(((t,i)=>{const{dealership:a={}}=window.DDC.dataLayer||{};if(Object.keys(a))return n(e,{methodType:"getDealerData",status:"Success"}),void t(Me());n(e,{methodType:"getDealerData",status:"Failed"}),i(new Error("Unable to retrieve dealership data."))})),getJwtForSite:async e=>Ge(e,"getJwtForSite"),getJwtForVehicles:async e=>Ge(e,"getJwtForVehicles"),getPageData:async(e,t=!0)=>{const i="autofi"!==e.integrationId&&t,a=await s();return i&&n(e,{methodType:"getPageData",status:"object"==typeof a?"Success":"Failed"}),a},getSitemap:async e=>Ie(e,"getSitemap",["supplementaryData","siteMaps"]),getSiteProperties:async e=>Ie(e,"getSiteProperties",["supplementaryData","siteProperties"]),getUrlParams:h,getVehicleData:async e=>{const t=await s();if(!t.searchPage&&!t.detailPage)return[];const i=await A();return n(e,{methodType:"getVehicleData",status:"Success"}),i}}},{className:Be,methods:{getItemList:async(e,t)=>{const i=await s();if(!["inventory-badges","inventory-media"].includes(t))throw new Error(`The requested item list ${t} is not enabled for this API.`);if(!["item-list-badges"].includes(e.integrationId))throw new Error("The getItemList method is not allowed for use with this integration.");return i.searchPage||i.detailPage?(ze[t]||(ze[t]=l(e,`/api/badge-item-lists/${t}`,"getItemList")),ze[t]):[]}}}].forEach((e=>{const t=e;Object.entries(t.methods).forEach((([e,i])=>{t.className.prototype[e]=function(...t){const n={integrationId:this.getIntegrationId(),integrationType:this.getIntegrationType()};return"getUrlParams"===e?i.call(null,n,...t):new Promise(((e,a)=>{try{e(i.call(null,n,...t))}catch(e){a(e)}}))}}))}));const Ye={append:f,create:(e,t,i)=>(n(e,{methodType:"Create",type:t,...i}),"button"===t?B(e,document.createElement("a"),i):null),insert:Se,insertOnce:(e,t,i)=>Se(e,t,i,!1),insertCallToAction:$e,insertCallToActionOnce:(e,t,i,n)=>$e(e,t,i,n,!1),insertGalleryContent:(e,t,i)=>{he(t);const n=Array.isArray(i)?i:[i];"vehicle-media"===t&&(n.forEach((e=>{if(!ce.includes(e.type))throw new Error(`Unsupported vehicle media content type: '${e.type}'. Expected one of: ${ce.join(", ")}.`);if(!de.includes(e.position))throw new Error(`Unsupported vehicle media position: '${e.position}'. Expected one of: ${de.join(", ")}.`);if("image"===e.type){if(!e.src||""===e.src.trim())throw new Error("Image vehicle media must have a 'src' property.");le["vehicle-media"][e.position].push({type:"image",src:e.src,thumbnail:e.thumbnail&&""!==e.thumbnail.trim()?e.thumbnail:e.src,position:e.position})}})),pe())},update:je,updateOnce:(e,t,i)=>je(e,t,i,!1),modifyContent:(e,t,i)=>{new xe(e,t,i).apply(),n(e,{methodType:"modifyContent",location:t})},load:fe,loadJS:ve,loadCSS:(e,t)=>fe(e,t,"css"),log:v,subscribe:(e,t,i)=>{ie(e,"init"),Z(t,"eventType");const a=new ne(e,i);se.push(t,a),ae.forEach(t,(t=>{oe(e.integrationId,i,t)})),n(e,{subscribedEvent:t})},test:(e,t)=>{const i="string"==typeof e?e:e.integrationId;return i&&t&&((e,t,i)=>{let n;if(i){const e=new Date;e.setTime(e.getTime()+24*i*60*60*1e3),n=`; expires=${e.toGMTString()}`}else n="";document.cookie=`${e}=${t}${n}; path=/`})("WebIntegrationAPITestLoader",`${i}|${t}`),void 0!==we._integrationMode&&fe(e,t)}},Qe=class{constructor(i){let n,a;const s=document.currentScript&&"function"==typeof document.currentScript.getAttribute&&""!==document.currentScript.getAttribute("data-web-api-id")?document.currentScript:i;s&&"object"==typeof s&&("function"==typeof s.getAttribute&&""!==s.getAttribute("data-web-api-id")?(n=s.getAttribute("data-web-api-id"),a=s.getAttribute("data-web-api-type")||""):({integrationId:n,integrationType:a}=s)),!n&&i&&""!==i&&(n=i,a=i),Z(n,"integrationId"),this.init={integrationId:e(n),integrationType:t(a)},this.utils=new Ke(this.init),this.privateUtils=new Be(this.init)}};Object.entries(Ye).forEach((([e,t])=>{Qe.prototype[e]=function(...i){return D&&"log"!==e&&v(`${this.init.integrationId} called ${e}:`,...i),t.call(null,this.init,...i)}})),window.DDC=window.DDC||{},window.DDC.API=Qe,window.DDC.PrivateAPI={notifyDynamicContent:()=>{He(),Ae.forEach((e=>{e.apply()})),Le.forEach((e=>{e.apply()})),be("all")},timings:{},getGalleryContent:e=>(he(e),le[e]),getPageLevelModifications:e=>e?ue[e]:ue,track:n,inventoryData:null},window.dispatchEvent(new Event("WIAPIReady")),(async()=>{const e=await Pe(),t=await s(),i=h();Object.keys(e).forEach((async n=>{const a=e[n];if(a&&a.fields&&(a.fields.integrationUrl||a.url)){const{fields:s,url:o,wiseIntegration:r,debugMode:c}=a,{integrationUrl:d,enabledDesktop:l,enabledSeamless:h,excludedPages:p}=s;let u=d,g="api";if(r&&(u=o,g="wise"),!r){const e="mobile"===t.layoutType&&!0===h,i="desktop"===t.layoutType&&!0===l;if(!e&&!i)return void v(n,`Config for ${n} found but not enabled for the current device type.`)}if(i._onlyDisableThirdParty&&i._onlyDisableThirdParty===n)return void v(`Skipping load of ${n} due to _onlyDisableThirdParty URL parameter.`);if(i._onlyEnableThirdParty&&i._onlyEnableThirdParty!==n)return void v(`Skipping load of ${n} due to _onlyEnableThirdParty URL parameter.`);if(!u.startsWith("https://")&&!u.startsWith("/"))return void v(`ERROR with '${n}' integration setup:`,"URL defined does not start with https:// or / and HTTPS is required.");if("resetCustom"===i._mode||"true"===i._disableTPS&&"true"!==i._enableWIAPI||"true"===i._disableWIAPI)return void v(n,`Integrations are disabled. Skipping JS: ${u}`);if(!0===c&&"true"!==i.thirdPartyServiceDebug)return void v(n,`This integration is disabled because Third Party Debug is enabled. Skipping JS: ${u}`);let y=!1,m=!1,w=!1;if(p&&p.split(",").forEach((e=>{t.pageName.match(e)&&(m=!0)})),m||(Object.keys(s).forEach((e=>{(e.startsWith("addTo")||"includedPages"===e)&&(w=!0,s[e].split(",").forEach((e=>{("ALL"===e||t.pageName.match(e))&&(y=!0)})))})),y||w||(y=!0)),y){!u.startsWith("/")||u.startsWith("//")||u.startsWith("/static/")||(u=`/static${u}`);const t=(e=>e.includes("{")&&e.includes("}"))(u)?((e,t)=>{let i=e;return Object.keys(t).forEach((e=>{if("integrationUrl"!==e&&i.includes(`{${e}}`)){const n=new RegExp(`{${e}}`,"g");i=i.replace(n,t[e])}})),i})(u,e[n].fields):u;v(n,`Loading Integration JS: ${t}`),ve({integrationId:n,integrationType:g},t,new Map,!0)}else v(n,`Config for ${n} found but excluded for the current page: ${t.pageName}.`)}}))})(),"loading"!==document.readyState?He():window.addEventListener("DOMContentLoaded",(()=>{He()})),window.addEventListener("DOMContentLoaded",(()=>{be("css"),be("js")})),window.addEventListener("load",(()=>{be("all")}))}));
//# sourceMappingURL=lib.js.map

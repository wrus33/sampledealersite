"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}();!function(e,t){var a=t&&t.Flags&&t.Flags.facetBrowseAwaitDocumentReady,o=function(e){return!a&&t.i18n&&t.i18n.labels&&void 0!==t.i18n.labels[e]?t.i18n.labels[e]:t.i18n&&"function"==typeof t.i18n.getLabel?t.i18n.getLabel(e):e},s=function S(e,a,o){var s={};return e.facets&&e.facets.forEach(function(e){var a;switch(e.type){case"VALUE":e.values.forEach(function(e){e.selected&&(a=e.value)});break;case"USER_RANGE":var o=e.values[0];if(t.log("Range Facet: ",e,o),o&&(o.selectedMin||o.selectedMax)){var n=o.selectedMin?o.selectedMin:o.min,i=o.selectedMax?o.selectedMax:o.max;a=n+"-"+i}break;case"GROUP":t.log("Group Facet: ",e),_.extend(s,S(e));break;default:t.log("warn","Facet getSelections not implemented",e.type,e)}void 0!==a&&(s[e.id]=a)}),a&&null!==o.geoRadius&&(s.geoZip=o.geoZip,s.geoRadius=o.geoRadius),t.log("SELECTIONS:",s),s},n=function(e,a,o,s,n){var i=[{name:e.allLabel,selected:!1,value:""}].concat(e.values.map(function(e){return{name:e.label,value:e.value,selected:e.selected,count:e.count}})),r=e.id,l=function(e){var o=e.target,s=e.target,n=s.options,i=s.value,l=n?n[n.selectedIndex]:o;a.updateFacet(r,i),t.pushToGtmDataLayer({event:"ddc.form.facetBrowseChange",eventData:{element:l,label:r+":"+i,linkType:o.nodeName,widgetName:"inventory-search.facet-browse"}})},c=[r],u=t.client.isMobile?"block":"default",d="btn-no-decoration btn-"+u,p=!n;return s&&c.push("ddc-selectpicker"),t.client.isDesktop&&(c.push("form-control"),c.push("h-auto")),React.createElement(y,{key:r,id:r,className:c.join(" "),options:i,viewPrefs:o,onChange:l,dataStyle:d,isDisabled:p})},i=function(e,t){var a=d(e.id)?o("SPAN_PER_MO"):"",s=e.values[0];return React.createElement(w,{key:e.id,name:e.id,min:s.min,max:s.max,val:"|min-"+e.id+"|-|max-"+e.id+"|",currentMin:s.selectedMin,currentMax:s.selectedMax,suffix:a,onChange:t})},r=function(e,t,a,o){return React.createElement(f,{key:e.id,mutator:t,name:e.id,buttonText:e.label,viewPrefs:a,facet:e,totalCount:o})},l=function(e,t,a){var s=e.values.map(function(e){return{label:e.label,value:e.value,checked:e.selected===!0,disabled:0==e.count}}),n=e.values.filter(function(e){return e.selected===!0}),i={classes:a.widgetSubHeadingClasses+" "+("BLANK"!==a.widgetSubHeadingColor?a.widgetSubHeadingColor:""),label:o(a.widgetSubHeading),icon:a.widgetSubHeadingIcon,tagName:"h3"};return e.allLabel&&s.push({label:e.allLabel,value:"",checked:0==n.length}),React.createElement(g,{key:e.id,name:e.id,location:"main-pill-group",items:s,onChange:t,pillHeading:i,dataPlacement:"top",viewPrefs:a})},c=function(e,a,o,s,l,c,u){return"VALUE"==e.type?n(e,a,s,l,u):"GROUP"==e.type?r(e,a,s,c):"USER_RANGE"==e.type?i(e,o):void t.log("warn","Unknown facet type: ",e.type)},u=function(e){return t.format.currency(e,0)},d=function(e){return"paymentLoan"==e||"paymentLease"==e},p=function(){e(".inventory-search-facet-browse").each(function(a,o){var s=e(o).attr("data-widget-id"),n=new k(s),i=t.WidgetData[s].props.initialLoadQueryStrings;n.refresh(i)})},h=new com.dealer.log.Logger("inventory-search.facet-browse"),f=function(a){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={uiSelectedFacetId:null},t}return _inherits(n,a),_createClass(n,[{key:"componentDidMount",value:function(){var t=this;e(this.refs.bootstrapSelect).on("keydown",function(e){e.stopPropagation()}),e(this.refs.menu).on("click",function(e){e.stopPropagation()}),e(ReactDOM.findDOMNode(this.refs.resetButton)).on("click",function(){e(ReactDOM.findDOMNode(t.refs.toggleButton)).dropdown("toggle")}),e(this.refs.bootstrapSelect).on("shown.bs.dropdown",function(){t.state.deferredUiSelectedFacetId&&t.setState({deferredUiSelectedFacetId:null,uiSelectedFacetId:t.state.deferredUiSelectedFacetId})})}},{key:"render",value:function(){var e=this,a=["btn-group","ddc-bootstrap-select"],n=t.client.isDesktop?"form-control h-auto":"select-wrap",i=t.client.isMobile?"btn-block":"btn-default",r=this.props.facet.facets,l=function(e){return r.filter(function(t){return e==t.id})[0]},p=function(e){var t=0;return e.forEach(function(e){t+=e.count}),t},h=function(e){return"VALUE"==e.type?0==p(e.values):"USER_RANGE"==e.type?0==p(e.values[0].values):(t.log("Unknown facet type in isFacetDisabled:",e.type),!0)},f=function(){var t=Object.keys(s(e.props.facet));return t.length>0?t[0]:null},m=f(),v=function(){if(m)return m;if(e.state.uiSelectedFacetId&&l(e.state.uiSelectedFacetId)&&!h(l(e.state.uiSelectedFacetId)))return e.state.uiSelectedFacetId;var t=r.filter(function(e){return!h(e)});return t.length>0?t[0].id:null}(),y=function(){var e={};return r.forEach(function(t){e[t.id]=null}),e},w=function(t,a){var o=y();o[t]=a,e.props.mutator.updateFacets(o)},C=r.map(function(t){var a=function(e,a){w(t.id,e+"-"+a)};return React.createElement("div",{key:t.id,className:v!==t.id?"hide":""},c(t,e.props.mutator,a,e.props.viewPrefs,!1,e.props.totalCount,!0))}),R=r.map(function(e){return{label:e.label,value:e.id,checked:e.id===v,disabled:h(e)}}),D=function(t){e.setState({uiSelectedFacetId:t});var a=y();delete a[t],e.props.mutator.updateFacets(a)},_=function(e){var t=e.values[0],a=u(void 0!==t.selectedMin?t.selectedMin:t.min),s=u(void 0!==t.selectedMax?t.selectedMax:t.max),n=d(e.id)?React.createElement("span",{className:"payment-suffix"},o("PER_MO")):void 0;return React.createElement("span",null,e.label,": ",a,n," - ",s,n)},E=function(e){var t=e.values.filter(function(e){return e.selected});return t.length>0?e.label+": "+t[0].label:e.allLabel},k=function(){var a,o;if(m){var s=l(m);if(!s)return"";"VALUE"==s.type?a=E(s):"USER_RANGE"==s.type?a=_(s):t.log("Unkown facet type in getButtonText:",s.type),o="true"===e.props.viewPrefs.showCountOnSubmitButton||0===e.props.totalCount?void 0:React.createElement("small",{className:"text-muted"},t.format.number(e.props.totalCount))}else a=e.props.buttonText;return React.createElement("span",{className:"filter-option pull-left"},a," ",o," Â ")},S=function(){e.setState({uiSelectedFacetId:null}),e.props.mutator.updateFacets(y())},P={text:o(this.props.viewPrefs.buttonTextReset),style:this.props.viewPrefs.buttonStyleReset,size:this.props.viewPrefs.buttonSizeReset,layout:this.props.viewPrefs.buttonLayoutReset},N={classes:"pull-left ddc-pill-heading",label:o("SEARCH_BY_COLON"),tagName:"p"},I=["group","form-group"];return a.push(n),m&&I.push("selected"),React.createElement("div",{className:I.join(" ")},React.createElement("div",{className:a.join(" "),ref:"bootstrapSelect"},React.createElement(b,{className:"dropdown-toggle "+i,dataToggle:"dropdown",caret:"true",ref:"toggleButton",role:"combobox",ariaLabel:this.props.buttonText,title:this.props.buttonText},k()),React.createElement("div",{className:"menu dropdown-menu",ref:"menu"},React.createElement(g,{name:this.props.name,location:"dropdown-pill-group",items:R,onChange:D,pillHeading:N,dataPlacement:"bottom",viewPrefs:this.props.viewPrefs}),C,React.createElement("div",{className:"form-group"},React.createElement(b,{style:P.style,layout:P.layout,size:P.size,text:P.text,onClick:S,ref:"resetButton"})))))}}]),n}(React.Component),m=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("i",{className:"ddc-icon ddc-icon-"+this.props.className})}}]),t}(React.Component),g=function(a){function s(){return _classCallCheck(this,s),_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return _inherits(s,a),_createClass(s,[{key:"attachEvents",value:function(){var a=this;e(this.refs.wrapper).find(".pill-label").on("click",function(){var e=this.classList.contains("checked"),o=this.classList.contains("disabled"),s=this.closest(".main-pill-group")?this.closest(".main-pill-group").querySelector("h3"):this.closest(".dropdown-pill-group").querySelector("p");o||e||a.props.onChange(this.dataset.value),h.debug("Pill facet selected"),t.pushToGtmDataLayer({event:"ddc.form.facetBrowseChange",eventData:{element:this,label:""+(s?s.innerText+":":"")+this.text,linkType:this.nodeName,widgetName:"inventory-search.facet-browse"}})})}},{key:"removeEvents",value:function(){e(this.refs.wrapper).find(".pill-label").off("click")}},{key:"componentDidMount",value:function(){this.attachEvents()}},{key:"componentDidUpdate",value:function(){this.attachEvents()}},{key:"componentWillUnmount",value:function(){this.removeEvents()}},{key:"componentWillUpdate",value:function(){this.removeEvents()}},{key:"render",value:function(){var e=this.props,t=e.dataPlacement,a=e.items,s=e.location,n=e.pillHeading,i=e.viewPrefs,r=i.enablePillGroupFlex,l=i.pillGroupFlexAlignment,c=i.pillGroupFlexDirection,u=i.pillGroupFlexJustify,d=a.map(function(e){var a=["pill-label"],s=void 0;return e.disabled&&(a.push("disabled"),s=o("ITEM_IS_NOT_AVAILABLE_FOR_YOUR_CURRENT_SELECTION").replace("{template.item}",e.label)),e.checked&&!e.disabled&&a.push("checked"),React.createElement("a",{key:e.value,className:a.join(" "),"data-value":e.value,"data-original-title":s,"data-toggle":e.disabled?"tooltip":null,"data-placement":t},e.label)}),p=function(){if(void 0!==n.label){var e=n.icon?React.createElement(m,{className:n.icon}):null;return React.createElement(n.tagName,{className:n.classes},e,n.label)}},h=["form-group","ddc-pill-group",""+s];return"true"===r&&(h.push("d-flex","w-100",l,c,u),h.filter(Boolean)),a.length>1?React.createElement("div",{ref:"wrapper",className:h.join(" ")},p(),React.createElement("div",{className:"ddc-pill-nav line-height-reset"},d)):null}}]),s}(React.Component),v=function(a){function s(e){_classCallCheck(this,s);var t=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));t.updateValidPostalField=t.updateValidPostalField.bind(t);var a="true"===e.viewPrefs.useUrlParamZip&&window.DDC.getUrlParams().zip;return t.state={validPostal:!0,geoLocationValue:t.props.geoData.showPostalCityState?t.props.geoData.geoCityState:t.props.geoData.geoZip||a,autocompletePostal:a||t.props.geoData.showPostalCityState?t.props.geoData.geoZip:"",defaultZipValue:a||""},a&&t.resolvePostalCode(a),t}return _inherits(s,a),_createClass(s,[{key:"componentDidMount",value:function(){var a=e(document);this.props.geoData.geoInputEl=this.input,this.props.geoData.useAutocomplete&&t.googlePlacesAutocomplete.refresh(),a.on("autocomplete-postal",function(t){t.element.attr("id")===this.props.geoData.geoInputEl.id&&(this.handleChange(t),e.cookie("DDC.postalCityState",t.postalCityState,{path:"/"}))}.bind(this)),a.on("html5Geolocation-updated",function(){this.props.geoData.refreshGeoData();var e="true"===this.props.viewPrefs.useUrlParamZip&&window.DDC.getUrlParams().zip;this.setState({geoLocationValue:this.props.geoData.showPostalCityState?this.props.geoData.geoCityState:this.props.geoData.geoZip,autocompletePostal:e||this.props.geoData.showPostalCityState?this.props.geoData.geoZip:""})}.bind(this))}},{key:"validatePostal",value:function(e){var t=/(^\d{5}(-\d{4})?$)|(^[ABCEGHJKLMNPRSTVXYabceghjklmnprstvxy]{1}\d{1}[A-Za-z]{1} *\d{1}[A-Za-z]{1}\d{1}$)/g,a=new RegExp(t),o=a.test(e);return this.setState({validPostal:o},this.updateValidPostalField(o)),o}},{key:"updateValidPostalField",value:function(e){this.props.validPostalHandler(e)}},{key:"resolvePostalCode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e&&this.validatePostal(e)?(this.props.geoData.setGeoValue("geoZip",e),this.props.mutator.updateFacet("geoZip",e),this.props.geoData.setPostalCookie("DDC.postalCode",e.replace(" ","%20"),{path:"/"}),e):void 0}},{key:"handleChange",value:function(a){var s=a instanceof e.Event?a.element[0]:a.target,n=s.nodeName,i=a instanceof e.Event?e(s).attr("autocomplete-postal"):s.value,r=this.resolvePostalCode(i);r&&(h.debug("ZIP code updated"),t.pushToGtmDataLayer({event:"ddc.form.facetBrowseChange",eventData:{element:s,label:o("FIND_VEHICLES_FOR")+":"+r,linkType:n,widgetName:"inventory-search.facet-browse"}}))}},{key:"handleInputWidth",value:function(){var t=this.props.geoData.geoInputEl;if(void 0!==e.cookie("DDC.postalCityState"))var a=e.cookie("DDC.postalCityState"),o=a.length+2,s=o+"ch";else if(null==t)var n=this.props.geoData.geoCityState,o=n.length+2,s=o+"ch";return s}},{key:"handleClick",value:function(e,a,s){if(t.WidgetData[s].isCanada)var n=o("true"==a?"CITY_PROVINCE_OR_POSTAL_CODE":"POSTAL_CODE");else var n=o("true"==a?"AUTOCOMPLETE_CITY_STATE_OR_ZIP":"GEO_ZIP");e.target.value="",e.target.setAttribute("placeholder",n),e.target.removeAttribute("autocomplete-postal")}},{key:"render",value:function(){var e=this,a=this.props,s=a.geoData,n=a.geoData,i=n.geoInputEl,r=n.geoRadius,l=n.uom,c=a.mutator,u=a.viewPrefs,d=u.searchFormRanges,p=u.useAutocomplete,f=a.widgetId,m=d.split(","),g=t.client.isMobile?"btn-block":"btn-default",v="ddc-selectpicker",b="true"===p,w=function(a){var n=a.target,r=a.target,u=r.options,d=r.value;s.setGeoValue("geoRadius",d),c.updateFacet("geoRadius",d);var p=e.props.geoData.geoRadius,f=u?u[u.selectedIndex]:n;h.debug("Range option selected"),t.pushToGtmDataLayer({event:"ddc.form.facetBrowseChange",eventData:{element:f,label:i.name+" "+o("WITHIN")+" "+p+" "+l,linkType:n.nodeName,widgetName:"inventory-search.facet-browse"}})},C=[{name:o("SELECT_RANGE"),value:"",selected:!1}].concat(m.map(function(e){return{name:e+" "+l,value:e,selected:null!==r?e===r.toString():!1}}));return v=t.client.isDesktop?v+" form-control h-auto":v,React.createElement("div",{className:"form-group range range-group "},React.createElement("div",{className:""},React.createElement("h3",{className:"h1 ddc-sub-heading"},o(b?"YOUR_LOCATION":"FIND_VEHICLES_FOR")),React.createElement("div",{className:"form-group"},React.createElement("div",{className:"btn btn-no-decoration dropdown-toggle non-dropdown"+(this.state.validPostal?"":"invalid"),style:{width:this.handleInputWidth()}},React.createElement("input",{type:"text",name:"geoZip",id:f,className:"text geoZip"+(b?" autocomplete-input":""),placeholder:this.state.geoLocationValue,"autocomplete-postal":this.state.autocompletePostal,defaultValue:this.state.defaultZipValue,onChange:function(t){return e.handleChange(t)},onClick:function(t){return e.handleClick(t,p,f)},ref:function(t){return e.input=t},"aria-label":"Zip Code: "+this.props.geoData.geoZip}))),React.createElement("h3",{className:"ddc-sub-heading "+(t.client.isDesktop?"h1":"h3")},o("WITHIN")),React.createElement(y,{key:"geoRadius",className:"geoRadius "+v,options:C,viewPrefs:this.props.viewPrefs,onChange:w,dataStyle:g,isDisabled:!this.state.validPostal})))}}]),s}(React.Component),y=function(a){function o(){return _classCallCheck(this,o),_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return _inherits(o,a),_createClass(o,[{key:"componentDidMount",value:function(){var a,o=e(this.refs.wrapper);o.find(".ddc-selectpicker").ddcselectpicker("refresh"),t.client.isMobile||"two-column"===this.props.viewPrefs.formLayout||(a=o.find(".dropdown-toggle")[0].getBoundingClientRect().width,o.find(".dropdown-toggle").css("minWidth",a))}},{key:"componentDidUpdate",value:function(){var t=e(this.refs.wrapper);t.find(".ddc-selectpicker").ddcselectpicker("refresh"),"two-column"===this.props.viewPrefs.formLayout&&e(".two-column .ddc-bootstrap-select").each(function(t,a){var o=e(a).closest(".facet-browse-form")[0].getBoundingClientRect(),s=a.getBoundingClientRect(),n=e(a).find(".dropdown-menu");s.left>o.left+o.width/2?n.addClass("dropdown-menu-right"):n.removeClass("dropdown-menu-right")})}},{key:"render",value:function(){var e="",a=this.props.options.map(function(t){return e=t.selected?t.value:e,React.createElement("option",{key:t.value+"-"+t.count,value:t.value,"data-subtext":t.count},t.name)}),o="true"!==this.props.viewPrefs.showCountOnSubmitButton,s=t.client.isMobile?"select-wrap":"",n=void 0!==this.props.isDisabled?this.props.isDisabled:!1;return React.createElement("div",{ref:"wrapper",className:"form-group select"+(""!=e?" selected":"")},React.createElement("div",{className:s},React.createElement("select",{value:e,className:this.props.className,onChange:this.props.onChange,"data-show-subtext":o,"data-dropup-auto":"false","data-style":this.props.dataStyle,disabled:n,"data-bottom-margin":this.props.viewPrefs.dropdownBottomMargin},a)))}}]),o}(React.Component),b=function(t){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,t),_createClass(a,[{key:"componentDidMount",value:function(){var t=this;e(this.refs.button).on("click",function(e){t.props.onClick&&t.props.onClick(e)})}},{key:"render",value:function(){var e=this.props.caret?React.createElement("span",{className:"bs-caret"},React.createElement("span",{className:"caret"})):void 0;return React.createElement("button",{className:this.getClassname(),type:this.props.type,"data-toggle":this.props.dataToggle,disabled:this.props.disabled,ref:"button",role:this.props.role,"aria-label":this.props.ariaLabel},this.props.text,this.props.children,e)}},{key:"getClassname",value:function(){var e=this.props.className?this.props.className.split(" ").filter(function(e){return!!e}):[];if(e.push("btn"),e.push("btn-no-decoration"),this.props.style&&e.push("btn-"+this.props.style),this.props.size&&"default"!=this.props.size){var t;switch(this.props.size){case"xlarge":t="btn-xl";break;case"large":t="btn-lg";break;case"small":t="btn-sm";break;case"xsmall":t="btn-xs";break;default:t="btn-"+this.props.size}e.push(t)}return this.props.layout&&("pull-left"==this.props.layout||"pull-right"==this.props.layout?e.push(this.props.layout):"block"==this.props.layout&&e.push("btn-"+this.props.layout)),e.join(" ")}}]),a}(React.Component),w=function(a){function o(){return _classCallCheck(this,o),_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return _inherits(o,a),_createClass(o,[{key:"componentDidMount",value:function(){e(document).trigger("modulesRefresh",{modules:{ui:t.modules.ui}});var a=this.props.name,o=this.props.onChange;e(this.refs.wrapper).on("slidestop",function(){var t=e(this).find(".ui-slider-min-value.min-"+a).attr("data-value"),s=e(this).find(".ui-slider-max-value.max-"+a).attr("data-value");o(t,s)})}},{key:"getCurrentValues",value:function(){return{min:this.props.currentMin?this.props.currentMin:this.props.min,max:this.props.currentMax?this.props.currentMax:this.props.max}}},{key:"componentDidUpdate",value:function(){var t=this.getCurrentValues();e(this.refs.wrapper).find(".ui-slider.ui-widget").slider("values",[t.min,t.max])}},{key:"render",value:function(){var e=this.getCurrentValues();return React.createElement("div",{ref:"wrapper",className:"form-group"},React.createElement("p",{className:"ui-slider-value"}),React.createElement("input",{type:"text",name:this.props.name,className:"text range-slider hide ui-slider ddc-dynamic-field form-control",pattern:"(^$)|(^.*(\\S+).*$)","data-min":this.props.min,"data-max":this.props.max,"data-prefix":"$","data-suffix":this.props.suffix,"data-values":e.min+","+e.max,"data-format-money":"true",ref:"input"}))}}]),o}(React.Component),C=function(a){function s(e){_classCallCheck(this,s);var t=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));return t.setValidPostal=t.setValidPostal.bind(t),t.state={isValidPostal:!0,rootWidth:0},t}return _inherits(s,a),_createClass(s,[{key:"componentDidMount",value:function(){var t,a=e(ReactDOM.findDOMNode(this.refs.submitButton)),o=e(ReactDOM.findDOMNode(this.refs.root));a.hasClass("show-count")&&"two-column"!==this.props.model.viewPrefs.formLayout&&(t=a[0].getBoundingClientRect().width,a.css("minWidth",t)),o&&this.setState({rootWidth:o.outerWidth()}),e(this.refs.dataLoadingUI).on("click",function(e){e.stopPropagation()});var s=function(){return window.performance&&"function"==typeof window.performance.now?(performance.now()/1e3).toFixed(2):(new Date).toTimeString().split(" ")[0]};window.newrelic&&window.newrelic.setCustomAttribute("inventory-search-facet-browse-load-time",s());var n="inventory_facet_search_widget_loaded";window.performance.mark(n),window.performance.measure(n)}},{key:"shouldComponentUpdate",value:function(e){return!e.dataLoading}},{key:"setZipCode",value:function(){this.setState({score:this.state.score+1})}},{key:"setValidPostal",value:function(e){this.setState({isValidPostal:e})}},{key:"render",value:function(){var e=this,a=this.props.model,s=a.viewPrefs,n="true"===a.viewPrefs.showRadius,i="pill"===a.viewPrefs.compositeTypeLayout,r=a.totalCount>0,u=a.facets.map(function(t){var o=function(a,o){e.props.mutator.updateFacet(t.id,a+"-"+o)};if("compositeType"===t.id&&i){var n=function(a){e.props.mutator.updateFacet(t.id,a)};return l(t,n,s,a.defaultActiveFacet)}return c(t,e.props.mutator,o,s,!0,a.totalCount,e.state.isValidPostal)}),d=o("VIEW_X_VEHICLES").replace("{0}",a.totalCount),p={text:"true"===s.showCountOnSubmitButton?d:o(s.buttonTextSubmit),style:s.buttonStyleSubmit,size:s.buttonSizeSubmit,layout:s.buttonLayoutSubmit,classes:"submit-search ui-button-submit",disabled:!this.state.isValidPostal,onClick:function(e){var o="{"+a.queryString.replace(/\?/g,"").replace(/&/g,",").replace(/=/g,":")+"}";h.debug("Submit search button clicked"),t.pushToGtmDataLayer({event:"ddc.form.facetBrowseChange",eventData:{element:e.target,label:e.target.innerText+":"+o,linkType:e.target.type,widgetName:"inventory-search.facet-browse"}}),t.redirect(a.submitUrl+a.queryString)}},f={text:o(s.buttonTextSearchReset),style:s.buttonStyleSearchReset,size:s.buttonSizeSearchReset,layout:s.buttonLayoutSearchReset,classes:"reset-search ui-button-reset",onClick:function(){t.redirect(a.submitUrl+a.queryString)}},m=["facet-browse-form","form-"+s.formLayout,i?"":"no-pills","two-column"===s.formLayout?"text-center m-auto":""],g=300;return"true"===s.showCountOnSubmitButton&&(p.classes+=" show-count"),React.createElement("div",{ref:"root",className:"root"},React.createElement("div",{ref:"dataLoadingUI",className:"data-loading-ui"}),React.createElement("div",{className:m.join(" ")},n?React.createElement(v,{mutator:this.props.mutator,viewPrefs:s,widgetId:this.props.widgetId,geoData:this.props.geoData,validPostalHandler:this.setValidPostal}):"",r?React.createElement("div",{className:"two-column"===s.formLayout?"d-flex flex-wrap justify-content-center "+(this.state.rootWidth>=g?"two-column":"one-column"):null},u,React.createElement("div",{className:"ddc-submit form-group"},React.createElement(b,{ref:"submitButton",type:"submit",style:p.style,disabled:p.disabled,layout:p.layout,size:p.size,className:p.classes,text:p.text,onClick:p.onClick}),"true"===s.showSearchReset?React.createElement(b,{ref:"resetButton",type:"reset",style:f.style,layout:f.layout,size:f.size,className:f.classes,text:f.text,onClick:function(){e.props.mutator.resetFacet({})}}):"")):React.createElement(E,{stateClasses:"alert alert-info"})))}}]),s}(React.Component),R=function(e){return{__html:e}},D=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:this.props.dataLoading?"data-loading":""},React.createElement(C,{model:this.props.model,mutator:this.props.mutator,widgetId:this.props.widgetId,geoData:this.props.geoData,dataLoading:this.props.dataLoading}))}}]),t}(React.Component),E=function(e){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,e),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:this.props.stateClasses,dangerouslySetInnerHTML:R("<i class='ddc-icon ddc-icon-alert align-left' /></i>"+t.i18n.getMessage("SORRY_NO_ITEMS_MATCHING_YOUR_REQUEST_WERE_FOUND"))})}}]),a}(React.Component),k=function(){function a(e){_classCallCheck(this,a),this.model=null,this.widgetId=e,this.widgetDOMId="facet-browse-"+e,this.mutator={updateFacet:function(e,t){var a=s(this.model,this.hasGeo,this.geoData);this.applySelection(a,e,t),this.refresh(a)},updateFacets:function(e){var t=this,a=s(this.model,this.hasGeo,this.geoData);Object.keys(e).forEach(function(o){t.applySelection(a,o,e[o])}),this.refresh(a)},resetFacet:function(){this.hasGeo&&this.geoData.resetGeoData(),this.refresh({})}},this.mutator.updateFacet=this.mutator.updateFacet.bind(this),this.mutator.updateFacets=this.mutator.updateFacets.bind(this),this.mutator.resetFacet=this.mutator.resetFacet.bind(this),this.geoData={geoZip:t.WidgetData[this.widgetId].geoData.postalCode,geoCityState:t.WidgetData[this.widgetId].geoData.postalCityState,geoRadius:void 0!==t.WidgetData[this.widgetId].geoData.geoRadius&&t.WidgetData[this.widgetId].geoData.geoRadius>0?t.WidgetData[this.widgetId].geoData.geoRadius:null,uom:t.WidgetData[this.widgetId].geoData.uom,geoInputEl:null,showPostalCityState:t.WidgetData[this.widgetId].geoData.showPostalCityState,useAutocomplete:t.WidgetData[this.widgetId].geoData.useAutocomplete,setGeoValue:function(e,t){this.geoData[e]=t},setPostalCookie:function(e,t){"undefined"!=typeof newrelic&&newrelic.addPageAction("postalCodeChange",{result:"Success - Postal code changed: "+t}),document.cookie=e+"="+t+"; path=/"},resetGeoData:function(){this.geoData.geoZip=t.WidgetData[this.widgetId].geoData.postalCode,this.geoData.geoInputEl.value="",this.geoData.geoRadius=null},refreshGeoData:function(){this.geoData.geoZip=t.WidgetData[this.widgetId].geoData.postalCode,this.geoData.geoCityState=t.WidgetData[this.widgetId].geoData.postalCityState}},this.geoData.setGeoValue=this.geoData.setGeoValue.bind(this),this.geoData.setPostalCookie=this.geoData.setPostalCookie.bind(this),this.geoData.resetGeoData=this.geoData.resetGeoData.bind(this),this.geoData.refreshGeoData=this.geoData.refreshGeoData.bind(this),this.hasGeo=null!==this.geoData.geoZip&&"true"===t.WidgetData[this.widgetId].prefs.showRadius}return _createClass(a,[{key:"callService",value:function(e){var a=t.WidgetData[this.widgetId].props.apiURL+e;t.log("====================\n CALLING SERVICE WITH:",e);var o=new Request(a,{method:"GET",credentials:"include",mode:"no-cors"});return fetch(o)}},{key:"applySelection",value:function(e,t,a){t&&(e[t]=a)}},{key:"renderModel",value:function(e){ReactDOM.render(React.createElement(D,{model:this.model,mutator:this.mutator,widgetId:this.widgetId,geoData:this.geoData,dataLoading:e}),document.getElementById(this.widgetDOMId))}},{key:"refresh",value:function(a){var o=this,n="",i=!this.model;if(i||this.renderModel(!0),"string"==typeof a)n=a;else if("object"===("undefined"==typeof a?"undefined":_typeof(a))){var r=window.DDC.getSiteProperty("Tier2Region");r&&(a.Tier2Region=r),n=t.urlize(a,!0,!0)}this.callService(n).then(function(e){return e.json()}).then(function(a){var n=e("#facet-browse-"+o.widgetId+"-loader"),r=e("#facet-browse-"+o.widgetId),l=function(){a.queryString=t.urlize(s(a,o.hasGeo,o.geoData),!0,!0),a.viewPrefs=t.WidgetData[o.widgetId].prefs,a.props=t.WidgetData[o.widgetId].props,o.model=a,o.renderModel(!1),e("[data-toggle='tooltip']").tooltip()};i?n.fadeOut("fast",function(){r.fadeOut(0).removeClass("hide"),l(),r.fadeIn("fast")}):l()}).catch(function(){ReactDOM.render(React.createElement(E,{stateClasses:"alert alert-info",iconClasses:"ddc-icon ddc-icon-alert align-left",message:t.i18n.getMessage("SORRY_NO_ITEMS_MATCHING_YOUR_REQUEST_WERE_FOUND")}),document.getElementById(o.widgetDOMId))})}}]),a}();a?e(document).ready(function(){p()}):p()}(jQuery,window.DDC,window.newrelic);
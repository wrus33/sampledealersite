function _createForOfIteratorHelper(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return c=t.done,t},e:function(t){i=!0,a=t},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var scripts=document.getElementsByTagName("script"),txtisrc=scripts[scripts.length-1].src.split("/").slice(0,5).join("/");txtisrc="https://c.txti.im/js/ddc";var debugMode=window.location.search&&window.location.search.includes("_integrationMode=debug");console.log("TEXTiUM loaded from ".concat(txtisrc)),function(t){var e=new(0,window.DDC.API)("textium");if(window.textiumLoaded)return console.error("TEXTiUM already loaded"),void e.log("TEXTiUM already loaded");function r(t){for(var r=$(t.html),o=0,a=["id","src"];o<a.length;o++){var c=a[o];t[c]&&(e.log("Set ".concat(c," to ").concat(t[c])),r.prop(c,t[c]))}if(t.class&&r.addClass(t.class),t.attrs){var i,l=_createForOfIteratorHelper(t.attrs);try{for(l.s();!(i=l.n()).done;)for(n in attr=i.value,attr)r.attr(n,attr[n])}catch(t){l.e(t)}finally{l.f()}}return debugMode&&("SCRIPT"!==r[0].tagName?(r.append("<h5>TEXTiUM ".concat(t.name," ").concat(t.id,"</h5>")),e.log(r.html())):(e.log("Script loaded"),e.log(r.text()))),r[0]}function o(t,n){if(e.log("\tTest Bar ".concat(t.name," against ").concat(n.pageName)),t.inactive)return!1;if(t.rejected)for(detail in t.rejected){if(e.log("\t\tReject ".concat(detail," === ").concat(t.rejected[detail])),t.rejected[detail]===n[detail])return e.log("\t\t\tðŸ™… Bar ".concat(t.name," rejects ").concat(detail," is ").concat(t.rejected[detail])),!1;e.log("\t\t\tðŸ‘ Bar ".concat(t.name," rejects ").concat(detail," is ").concat(t.rejected[detail]," but page is ").concat(n[detail]))}if(t.required)for(detail in t.required)if(t.required[detail]!==n[detail])return!1;if(t.sufficient){for(detail in t.sufficient)if(t.sufficient[detail]===n[detail])return!0;return!1}return!0}function a(t,n){var r=[];e.log("Load bars for ".concat(n.siteId," ").concat(n.pageName));var a,c=_createForOfIteratorHelper(t.bars);try{for(c.s();!(a=c.n()).done;)bar=a.value,o(bar,n)&&r.push(bar)}catch(t){c.e(t)}finally{c.f()}return e.log("".concat(r.length," bars for ").concat(n.siteId," ").concat(n.pageName)),r}!function(){var t=[];$('[data-location~="primary-banner"]').length>1&&(e.log("Too many primary-bannner elements"),t.push("Too many primary-bannner elements")),document.getElementsByClassName("widgetlyOnPageSnippet widgetlyIframe").length>0&&(e.log("Ampry Elements already present"),t.push("Ampry Elements already present"));var n,r=document.getElementsByTagName("script"),o=0;for(n=0;n<r.length;n++)r[n].src.includes("pixel.ampry.com")&&(e.log("Ampry script already loaded"),e.log(r[n].src),o++);o>0&&t.push("Ampry script already loaded"),t.length?(console.error("Setup incorrect"),console.error(t.join("\n")),e.log(t.join("\n"))):e.log("No TEXTiUM setup errors found")}(),$(".widgetlyOnPageSnippet,.widgetlyIframe").remove(),window.textiumLoaded=!0,e.log("DDC API Loaded"),e.utils.getPageData().then((function(t){e.subscribe("page-load-v1",(function(t){function n(t){e.log("Load script ".concat(t)),e.loadJS(t).then((function(){e.log("".concat(t," loaded"))}))}function o(t){if(t.ignore)e.log("ignore ".concat(t.name));else{t.method=t.method?t.method:"insert";var o=t.location||"primary-banner",a=t;switch(t.method){case"append":e.log("Append element directly into ".concat(t.location));var c=r(a);$(t.location).append(c);break;case"insertCallToAction":e.log("\t\tðŸ™‹ ".concat(t.method," ").concat(t.name," at ").concat(o)),t.actionType=t.actionType||"button",t.action&&e.log("\t\t".concat(t.actionType," classes: ").concat(t.action.classes)),e.insertCallToAction(t.actionType,o,(function(e){return t.action}));break;default:e.log("\t\tðŸ™‹ ".concat(t.method," ").concat(t.name," at ").concat(o)),e[t.method](o,(function(n,c){var i=r(a);e.log("\t\t\t".concat(t.method,"ed ").concat(i.innerHTML," into ").concat(o)),e.append(n,i)}))}if(t.scripts){e.log("Load ".concat(t.scripts.length," scripts"));var i,l=_createForOfIteratorHelper(t.scripts);try{for(l.s();!(i=l.n()).done;)script=i.value,n(script)}catch(t){l.e(t)}finally{l.f()}}}}function c(r){r=window.TextiumConfig||r,e.log("Load bars for page ".concat(t.payload.pageName));var c=a(r,t.payload);e.log("".concat(c.length," bars found"));var i,l=_createForOfIteratorHelper(c);try{for(l.s();!(i=l.n()).done;){o(i.value)}}catch(t){l.e(t)}finally{l.f()}if(r.scripts){e.log("Load ".concat(r.scripts.length," scripts"));var s,d=_createForOfIteratorHelper(r.scripts);try{for(d.s();!(s=d.n()).done;)script=s.value,n(script)}catch(t){d.e(t)}finally{d.f()}}}var i=(new Date).getTime().toString(),l=[txtisrc,"config.json?ck="].join("/")+i;e.log("Fetch ".concat(l)),fetch(l).then((function(t){return defaultConfig=t.json(),defaultConfig})).then((function(n){var r=[txtisrc,t.payload.accountId,"config.json?ck="].join("/")+i;return e.log("Load custom config ".concat(r)),fetch(r).then((function(t){return t.json()})).then((function(t){return e.log("Custom config found"),t=window.TextiumCustomConfig||t,function(t,n){if(window.location.hash&&window.location.hash.includes("defaultConfig"))return e.log("User default config"),t;e.log("Merge configs");var r,o=_createForOfIteratorHelper(n.bars);try{for(o.s();!(r=o.n()).done;){var a,c=r.value,i=!1,l=_createForOfIteratorHelper(t.bars);try{for(l.s();!(a=l.n()).done;){var s=a.value;if(c.name===s.name)if(i=!0,c.ignore)e.log("Ignore ".concat(c.name)),s.ignore=!0;else{e.log("Merge ".concat(c.name));for(var d=0,f=["action"];d<f.length;d++){var u=f[d];s[u]&&(c[u]=Object.assign(s[u],c[u]))}Object.assign(s,c)}}}catch(t){l.e(t)}finally{l.f()}i||t.bars.push(c)}}catch(t){o.e(t)}finally{o.f()}return n.scripts&&(e.log("Replace scripts"),t.scripts=n.scripts),t}(n,t)})).then(c).catch((function(t){return console.error(t),e.log("No custom config found"),c(n)}))}))}))}))}();

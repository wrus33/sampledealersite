"use strict";DDC.classes.namespace("DDC.Widgets.Content.Disclaimer"),DDC.classes.namespace("DDC.disclaimers"),function(i,e){var a=void 0,t=void 0,n=void 0,c=void 0,s=void 0,d=0,l=new Map,o=void 0,r=function(){a=i("[data-widget-id="+e.WidgetData.content_disclaimer.widgetId+"]"),t=e.WidgetData.content_disclaimer.props.labels.disclaimerLabel,n=e.dataLayer.page.pageInfo.isVlp,c=e.WidgetData.content_disclaimer.showDealershipName,o=e.WidgetData.content_disclaimer.useItemOnListing,s=i('[data-widget-id*="inventory-listing"] .item')},m=function(i){for(var e in i){var a=i[e].disclaimerType,t=d;l.has(a)||("undefined"!=typeof i[e].iconStyle?t=i[e].iconStyle:(d++,t=d),l.set(i[e].disclaimerType,t)),"page"===i[e].showDisclaimer?p(i[e]):"tooltip"===i[e].showDisclaimer?u(i[e]):(p(i[e]),u(i[e]))}},p=function(e){var n=""!==t,s=n?"<span class='account-label'>"+t+"</span>":"",d=c?Array.from(e.accountName).join(", "):"",o=e.iconStyle,r=e.iconSize,m=!o;l.forEach(function(t,n){var c=a.find(".disclaimer-type.disclaimer-"+n),l=e.disclaimerType===n,p=e.disclaimer,u=i('<div class="disclaimer-type disclaimer-'+n+' mt-4"><i class="disclaimer-icon '+r+" ddc-icon ddc-icon-"+o+' mr-3"/></div>'),f=i('<div class="disclaimer-type disclaimer-'+n+' mt-4"><sup class="count">'+t+"</sup></div>");if(c.length<=0&&l&&(a.append(m?f:u),c=a.find(".disclaimer-type.disclaimer-"+n)),l){var g='<span class="kbb-dynamic-date"></span>';p.indexOf(g)>=0&&(p=D(p)),c.append("<span class='account-info'>"+d+" "+s+" </span><span class='disclaimer'>"+p+"</span>")}})},u=function(e){var a=Array.from(e.state),t=Array.from(e.accountId);if(n)s.each(function(n,c){var s=i(c),d=s.data("state"),r=s.data("accountid"),m=o?a.indexOf(d)>-1&&t.indexOf(r)>-1:!0;if(m){var p=s;h(e,p,a,t,l.get(e.disclaimerType))}});else{var c=i(".page-bd");h(e,c,a,t,l.get(e.disclaimerType))}var d=e.disclaimer,r='<span class="kbb-dynamic-date"></span>';d.indexOf(r)>=0&&(d=D(d)),f(d,a,e)},f=function(a,t,n){var c=i(".disclaimer-popover");c.each(function(c,s){var d=i(s);e.client.isMobile?g(d,a,t,n):v(d,a)})},g=function(a,t,n,c){var s=a.data("state"),d=c.disclaimerType,l=a.hasClass(d);l&&s.indexOf(n)>-1&&a.on("click",function(a){a.stopPropagation(),e.mobile.slidein.activatePanel("disclaimer-icon","right"),i("#ddc-slidein-panel-disclaimer-icon").find(".ddc-mobile-slidein-content-inner").html(t).addClass("p-4")})},v=function(e,a){i.fn.popover&&e.on("click",function(i){i.preventDefault()}).popover({html:!0,trigger:"hover",placement:function(e,a){return i(a).offset().left<450?"right":"left"},container:"body",content:a})},y=function(i){return i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()},D=function(i){var e='<span class="kbb-dynamic-date"></span>',a=null,t=null;a||t||(a=new Date,t=new Date,a.setDate(a.getDate()-(a.getDay()+6)%7),t.setDate(a.getDate()+6));var n=i.replace(e,y(a)+" - "+y(t));return n},h=function(e,a,t,n,c){var s=e.iconLocation,d=e.iconStyle,l=e.iconSize,o=e.disclaimerType,r=!d,m=i(s).closest("div").hasClass("calloutDetails"),p=m?"position:absolute;top:0;right:-5px;":"",u=(m?i(s).css("position","relative"):"",i('<i class="disclaimer-icon '+l+" ddc-icon ddc-icon-"+d+" text-muted disclaimer-popover "+o+'" style="vertical-align:super;'+p+'" data-type="'+o+'" data-account-id="'+n+'" data-state="'+t+'">')),f=i('<i class="disclaimer-icon ddc-subscript text-muted disclaimer-popover '+o+'" data-type="'+o+'" style="vertical-align:super;'+p+'" data-account-id="'+n+'" data-state="'+t+'"><sup>'+c+"</sup></i>");a.find(s).append(r?f:u)},w=function(i){e.legacyVLPDisclaimers.forEach(function(a){var t=!1;i.forEach(function(n){i[n].disclaimer===e.legacyVLPDisclaimers[a].disclaimer&&(i[n].accountId=new Set(i[n].accountId.concat(e.legacyVLPDisclaimers[a].accountId)),i[n].accountName=new Set(i[n].accountName.concat(e.legacyVLPDisclaimers[a].accountName)),i[n].state=new Set(i[n].state.concat(e.legacyVLPDisclaimers[a].state)),t=!0)}),t||i.push(e.legacyVLPDisclaimers[a])})},b=function(){i(document).on("vehicle-disclaimers-set",function(){var i=e.disclaimers;"undefined"!=typeof e.legacyVLPDisclaimers&&w(i),Object.keys(i).length&&!i.initialized&&(m(i),i.initialized=!0,"undefined"!=typeof newrelic&&newrelic.addPageAction("gvmDisclaimerWidgetUsage"))})};i(document).ready(function(){r(),b()}),e.Widgets.Content.Disclaimer.isTesting="undefined"!=typeof __karma__,e.Widgets.Content.Disclaimer.isTesting&&(e.Widgets.Content.Disclaimer.testMethods={initSelectors:r,initDisclaimers:m})}(jQuery,window.DDC,window.newrelic);
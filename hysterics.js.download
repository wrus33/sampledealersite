!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t=t||self).DDC=t.DDC||{},t.DDC.Hysterics={}))}(this,(function(t){"use strict";function e(t,e,r,n,o,i,u){try{var a=t[i](u),c=a.value}catch(t){return void r(t)}a.done?e(c):Promise.resolve(c).then(n,o)}function r(t){return function(){var r=this,n=arguments;return new Promise((function(o,i){var u=t.apply(r,n);function a(t){e(u,o,i,a,c,"next",t)}function c(t){e(u,o,i,a,c,"throw",t)}a(void 0)}))}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(r,!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function p(t,e,r){return(p=f()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&s(o,r.prototype),o}).apply(null,arguments)}function l(t){var e="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return p(t,arguments,c(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s(n,t)})(t)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?h(t):e}function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function v(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var d=function(t){return function(e,r){return t(e,r)}};d.contextKey="no-op";var b,w=Object.freeze({__proto__:null,contextKey:"no-op",getWrapper:d});"undefined"==typeof window||void 0===window.document?b=require("abort-controller"):"undefined"!=typeof AbortController&&(b=AbortController);var _=function(t){var e=t.abort;e&&e.controller&&e.controller.abort()},g=function(t){var e=t.abort;return e&&e.controller?e.controller.signal:null},x=function(t){return b?function(e,n){n.abort.controller=new b;var o=r(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t(e,n));case 1:case"end":return r.stop()}}),r)})))();return o.cancel=function(){return _(n)},o}:d(t)};x.contextKey="abort";var T=Object.freeze({__proto__:null,contextKey:"abort",abort:_,getAbortSignal:g,getWrapper:x}),R=function(t){return function(e){return t.apply(void 0,v(e))}};R.contextKey="contextTerminus";var O=Object.freeze({__proto__:null,contextKey:"contextTerminus",getWrapper:R}),E=function(t,e,r){t[e].options=u({},r,{},t[e].options)},j=window&&window.newrelic;j||(console.warn("Unable to locate the NewRelic browser agent - performance metrics will not be recorded for this application!"),j={noticeError:function(){},addPageAction:function(){}});var k=function(){var t;return(t=j).noticeError.apply(t,arguments)},P=function(){var t;return(t=j).addPageAction.apply(t,arguments)},K={noticeError:!0},A=function(t,e,r){if(t.newRelic){var n=t.newRelic.metrics;if(!n)throw new Error("The New Relic wrapper must be ordered before any wrappers that append metrics!");n[e]=r}},S=function(t,e){return E(e,"newRelic",K),function(){var e=r(regeneratorRuntime.mark((function e(r,n){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={},n.newRelic.metrics=o,e.prev=2,e.next=5,t(r,n);case 5:return e.abrupt("return",e.sent);case 8:throw e.prev=8,e.t0=e.catch(2),n.newRelic.options.noticeError&&k(e.t0),o.error=!0,e.t0.name&&(o["error.name"]=e.t0.name),e.t0.message&&(o["error.message"]=e.t0.message),e.t0;case 15:return e.prev=15,i=n.newRelic.options.prefix||n.name,P(i,o),e.finish(15);case 19:case"end":return e.stop()}}),e,null,[[2,8,15,19]])})));return function(t,r){return e.apply(this,arguments)}}()};S.contextKey="newRelic";var D=Object.freeze({__proto__:null,contextKey:"newRelic",recordMetric:A,getWrapper:S}),C=function(t){return function(){var e=r(regeneratorRuntime.mark((function e(r,n){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Date.now(),e.prev=1,e.next=4,t(r,n);case 4:return e.abrupt("return",e.sent);case 5:return e.prev=5,i=Date.now()-o,n.duration.elapsed=i,A(n,"".concat("duration",".elapsed"),i),e.finish(5);case 10:case"end":return e.stop()}}),e,null,[[1,,5,10]])})));return function(t,r){return e.apply(this,arguments)}}()};C.contextKey="duration";var z=Object.freeze({__proto__:null,contextKey:"duration",getWrapper:C}),W=function(t){function e(t,r){var o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n(this,e),o=m(this,c(e).call(this));var u=t.url,a=t.status,s=t.statusText;return o.status=a,o.statusText=s,o.url=u,o.message="".concat(a," ").concat(s," (").concat(u,") - ").concat(r),o.name="FetchHttpError".concat(a),o.upstreamError=i,Error.captureStackTrace?Error.captureStackTrace(h(o),e):o.stack=new Error(o.message).stack,o}return a(e,t),e}(l(Error)),M={responseBodyType:"json",validateResponse:function(){var t=r(regeneratorRuntime.mark((function t(e){var r,n,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ok){t.next=19;break}if(r=e.headers,t.prev=2,!(i=r.get("content-type"))||!i.includes("json")){t.next=11;break}return t.next=7,e.json();case 7:n=t.sent,o=n.description||n.message||JSON.stringify(n),t.next=14;break;case 11:return t.next=13,e.text();case 13:o=t.sent;case 14:t.next=18;break;case 16:t.prev=16,t.t0=t.catch(2);case 18:throw new W(e,o,n);case 19:case"end":return t.stop()}}),t,null,[[2,16]])})));return function(e){return t.apply(this,arguments)}}()},F=function(t){return!t.status||429===t.status||5===Math.trunc(t.status/100)},B=function(t,e){if(!fetch)throw new Error("No globally available `fetch` implementation could be found.");return E(e,"fetch",M),function(){var t=r(regeneratorRuntime.mark((function t(e,r){var n,o,i,a,c,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=y(e,1),o=n[0],i=u({},r.fetch.options,{signal:g(r)}),a=i.responseBodyType,A(r,"".concat("fetch",".url"),o),t.prev=4,t.next=7,fetch(o,i);case 7:c=t.sent,t.next=17;break;case 10:if(t.prev=10,t.t0=t.catch(4),"AbortError"!==t.t0.name){t.next=16;break}return t.abrupt("return",null);case 16:throw t.t0;case 17:if(s=c.status,A(r,"".concat("fetch",".status"),c.status),204!==s){t.next=21;break}return t.abrupt("return",null);case 21:return t.next=23,i.validateResponse(c);case 23:return t.abrupt("return",c[a]());case 24:case"end":return t.stop()}}),t,null,[[4,10]])})));return function(e,r){return t.apply(this,arguments)}}()};B.contextKey="fetch";var N=Object.freeze({__proto__:null,defaultIsRetryable:F,defaultCircuitBreakerErrorFilter:function(t){return!F(t)},contextKey:"fetch",getWrapper:B});function I(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var J=I;I.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},I.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},I.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,o=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&o.unref(),!0},I.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},I.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},I.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},I.prototype.start=I.prototype.try,I.prototype.errors=function(){return this._errors},I.prototype.attempts=function(){return this._attempts},I.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,u=(t[i]||0)+1;t[i]=u,u>=r&&(e=o,r=u)}return e};var U=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){e.operation=function(t){var r=e.timeouts(t);return new J(r,{forever:t&&t.forever,unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<e.retries;o++)n.push(this.createTimeout(o,e));return t&&t.forever&&!n.length&&n.push(this.createTimeout(o,e)),n.sort((function(t,e){return t-e})),n},e.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,n=Math.round(r*e.minTimeout*Math.pow(e.factor,t));return n=Math.min(n,e.maxTimeout)},e.wrap=function(t,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var o in n=[],t)"function"==typeof t[o]&&n.push(o);for(var i=0;i<n.length;i++){var u=n[i],a=t[u];t[u]=function(n){var o=e.operation(r),i=Array.prototype.slice.call(arguments,1),u=i.pop();i.push((function(t){o.retry(t)||(t&&(arguments[0]=o.mainError()),u.apply(this,arguments))})),o.attempt((function(){n.apply(t,i)}))}.bind(t,a),t[u].options=r}}})),H=(U.operation,U.timeouts,U.createTimeout,U.wrap,U);var q=function(t,e){return new Promise((function(r,n){var o=e||{},i=H.operation(o);function u(t){n(t||new Error("Aborted"))}function a(t,e){t.bail?u(t):i.retry(t)?o.onRetry&&o.onRetry(t,e):n(i.mainError())}i.attempt((function(e){var n;try{n=t(u,e)}catch(t){return void a(t,e)}Promise.resolve(n).then(r).catch((function(t){a(t,e)}))}))}))},G={retries:3,minTimeout:30,isRetryable:function(t){return!0}},L=function(t,e){return E(e,"retry",G),function(){var e=r(regeneratorRuntime.mark((function e(n,o){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=0,e.prev=1,e.next=4,q(function(){var e=r(regeneratorRuntime.mark((function e(r,u){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u,e.prev=1,e.next=4,t(n,o);case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),a=o.retry.options.isRetryable,e.next=12,a(e.t0);case 12:if(e.sent){e.next=15;break}return r(e.t0),e.abrupt("return",null);case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}(),o.retry.options);case 4:return e.abrupt("return",e.sent);case 5:return e.prev=5,o.retry.attempts=i,A(o,"".concat("retry",".attempts"),i),e.finish(5);case 9:case"end":return e.stop()}}),e,null,[[1,,5,9]])})));return function(t,r){return e.apply(this,arguments)}}()};L.contextKey="retry";var Q=Object.freeze({__proto__:null,contextKey:"retry",getWrapper:L}),V=function(t){function e(t){var r;return n(this,e),(r=m(this,c(e).call(this,t))).name="TimeoutError",r}return a(e,t),e}(l(Error)),X=function(t,e,r){return new Promise((function(n,o){if("number"!=typeof e||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e!==1/0){var i=setTimeout((function(){if("function"!=typeof r){var i="string"==typeof r?r:"Promise timed out after ".concat(e," milliseconds"),u=r instanceof Error?r:new V(i);"function"==typeof t.cancel&&t.cancel(),o(u)}else try{n(r())}catch(t){o(t)}}),e);!function(t,e){e=e||function(){},t.then((function(t){return new Promise((function(t){t(e())})).then((function(){return t}))}),(function(t){return new Promise((function(t){t(e())})).then((function(){throw t}))}))}(t.then(n,o),(function(){clearTimeout(i)}))}else n(t)}))},Y=X,Z=X,$=V;Y.default=Z,Y.TimeoutError=$;var tt={timeout:600},et=function(t,e){return E(e,"timeout",tt),function(){var e=r(regeneratorRuntime.mark((function e(r,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.timeout.options.timeout,e.abrupt("return",Y(t(r,n),o));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()};et.contextKey="timeout";var rt=Object.freeze({__proto__:null,contextKey:"timeout",getWrapper:et}),nt={abort:T,circuitBreaker:w,contextTerminus:O,duration:z,fetch:N,newRelic:D,retry:Q,timeout:rt},ot=[D,z,w,Q,rt,T,O],it=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return t?ot:ot.filter((function(t){return t!==O}))},ut=function(t,e,r){var n=u({},t);return r.forEach((function(r){var o=r.contextKey;n[o]=u({},t[o]),n[o].options=u({},n[o].options,{},e[o])})),n},at=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:it(),i=ut({name:t},n||{},o),u=e;return o.slice().reverse().forEach((function(t){u=t.getWrapper(u,i)})),r(regeneratorRuntime.mark((function t(){var e,r,n,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=a.length>0&&void 0!==a[0]?a[0]:[],r=a.length>1&&void 0!==a[1]?a[1]:{},Array.isArray(e)){t.next=4;break}throw new Error("Function arguments must be provided as an array");case 4:return n=ut(i,r,o),t.abrupt("return",u(e,n));case 6:case"end":return t.stop()}}),t)})))};t.getDefaultWrappers=it,t.hysteriCall=at,t.hysteriFetch=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[].concat(v(it(!1)),[nt.fetch]);if(i[i.length-1]!==nt.fetch)throw new Error("The wrappers array argument must end with the fetch wrapper!");var a=u({},n,(o(e={},nt.retry.contextKey,u({isRetryable:nt.fetch.defaultIsRetryable},n?n[nt.retry.contextKey]:{})),o(e,nt.circuitBreaker.contextKey,u({errorFilter:nt.fetch.defaultCircuitBreakerErrorFilter},n?n[nt.circuitBreaker.contextKey]:{})),e)),c=at(t,null,a,i);return function(){var t=r(regeneratorRuntime.mark((function t(e){var r,n,i,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},n=a.length>2&&void 0!==a[2]?a[2]:{},i=u({},n,o({},nt.fetch.contextKey,u({},r||{},{},n?n[nt.fetch.contextKey]:{}))),t.abrupt("return",c([e],i));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},t.wrappers=nt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=hysterics.js.map

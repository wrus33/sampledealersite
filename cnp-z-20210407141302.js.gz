/*!
 * jQuery JavaScript Library v1.8.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: Tue Nov 13 2012 08:20:33 GMT-0500 (Eastern Standard Time)
 */
(function(window,undefined){var rootjQuery,readyList,document=window.document,location=window.location,navigator=window.navigator,_jQuery=window.jQuery,_$=window.$,core_push=Array.prototype.push,core_slice=Array.prototype.slice,core_indexOf=Array.prototype.indexOf,core_toString=Object.prototype.toString,core_hasOwn=Object.prototype.hasOwnProperty,core_trim=String.prototype.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,core_rnotwhite=/\S/,core_rspace=/\s+/,rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return(letter+"").toUpperCase()},DOMContentLoaded=function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);jQuery.ready()}else{if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);jQuery.ready()}}},class2type={};jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector){return this}if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;doc=(context&&context.nodeType?context.ownerDocument||context:document);selector=jQuery.parseHTML(match[1],doc,true);if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){this.attr.call(selector,context,true)}return jQuery.merge(this,selector)}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector)}this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else{if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}}else{if(jQuery.isFunction(selector)){return rootjQuery.ready(selector)}}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return core_slice.call(this)},get:function(num){return num==null?this.toArray():(num<0?this[this.length+num]:this[num])},pushStack:function(elems,name,selector){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;if(name==="find"){ret.selector=this.selector+(this.selector?" ":"")+selector}else{if(name){ret.selector=this.selector+"."+name+"("+selector+")"}}return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.ready.promise().done(fn);return this},eq:function(i){i=+i;return i===-1?this.slice(i):this.slice(i,i+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(core_slice.apply(this,arguments),"slice",core_slice.call(arguments).join(","))},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else{if(copy!==undefined){target[name]=copy}}}}}return target};jQuery.extend({noConflict:function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}if(!document.body){return setTimeout(jQuery.ready,1)}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array"},isWindow:function(obj){return obj!=null&&obj==obj.window},isNumeric:function(obj){return !isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){return obj==null?String(obj):class2type[core_toString.call(obj)]||"object"},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var key;for(key in obj){}return key===undefined||core_hasOwn.call(obj,key)},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,scripts){var parsed;if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){scripts=context;context=0}context=context||document;if((parsed=rsingleTag.exec(data))){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts?null:[]);return jQuery.merge([],(parsed.cacheable?jQuery.clone(parsed.fragment):parsed.fragment).childNodes)},parseJSON:function(data){if(!data||typeof data!=="string"){return null}data=jQuery.trim(data);if(window.JSON&&window.JSON.parse){return window.JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+data))()}jQuery.error("Invalid JSON: "+data)},parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{if(window.DOMParser){tmp=new DOMParser();xml=tmp.parseFromString(data,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml},noop:function(){},globalEval:function(data){if(data&&core_rnotwhite.test(data)){(window.execScript||function(data){window["eval"].call(window,data)})(data)}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var name,i=0,length=obj.length,isObj=length===undefined||jQuery.isFunction(obj);if(args){if(isObj){for(name in obj){if(callback.apply(obj[name],args)===false){break}}}else{for(;i<length;){if(callback.apply(obj[i++],args)===false){break}}}}else{if(isObj){for(name in obj){if(callback.call(obj[name],name,obj[name])===false){break}}}else{for(;i<length;){if(callback.call(obj[i],i,obj[i++])===false){break}}}}return obj},trim:core_trim&&!core_trim.call("\uFEFF\xA0")?function(text){return text==null?"":core_trim.call(text)}:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var type,ret=results||[];if(arr!=null){type=jQuery.type(arr);if(arr.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(arr)){core_push.call(ret,arr)}else{jQuery.merge(ret,arr)}}return ret},inArray:function(elem,arr,i){var len;if(arr){if(core_indexOf){return core_indexOf.call(arr,elem,i)}len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i}}}return -1},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i])}}return ret},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length==="number"&&((length>0&&elems[0]&&elems[length-1])||length===0||jQuery.isArray(elems));if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}else{for(key in elems){value=callback(elems[key],key,arg);if(value!=null){ret[ret.length]=value}}}return ret.concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context,args.concat(core_slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},access:function(elems,fn,key,value,chainable,emptyGet,pass){var exec,bulk=key==null,i=0,length=elems.length;if(key&&typeof key==="object"){for(i in key){jQuery.access(elems,fn,i,key[i],1,emptyGet,value)}chainable=1}else{if(value!==undefined){exec=pass===undefined&&jQuery.isFunction(value);if(bulk){if(exec){exec=fn;fn=function(elem,key,value){return exec.call(jQuery(elem),value)}}else{fn.call(elems,value);fn=null}}if(fn){for(;i<length;i++){fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass)}}chainable=1}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:function(){return(new Date()).getTime()}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready,1)}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",jQuery.ready,false)}else{document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",jQuery.ready);var top=false;try{top=window.frameElement==null&&document.documentElement}catch(e){}if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}jQuery.ready()}})()}}}}return readyList.promise(obj)};jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});rootjQuery=jQuery(document);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.split(core_rspace),function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?(optionsCache[options]||createOptions(options)):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else{if(memory){list=[]}else{self.disable()}}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else{if(arg&&arg.length&&type!=="string"){add(arg)}}})})(arguments);if(firing){firingLength=list.length}else{if(memory){firingStart=start;fire(memory)}}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return jQuery.inArray(fn,list)>-1},empty:function(){list=[];return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return !list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return !stack},fireWith:function(context,args){args=args||[];args=[context,args.slice?args.slice():args];if(list&&(!fired||stack)){if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return !!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=fns[i];deferred[tuple[1]](jQuery.isFunction(fn)?function(){var returned=fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[action+"With"](this===deferred?newDefer:this,[returned])}}:newDefer[action])});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=list.fire;deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else{if(!(--remaining)){deferred.resolveWith(contexts,values)}}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});jQuery.support=(function(){var support,all,a,select,opt,input,fragment,eventName,i,isSupported,clickFn,div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*");a=div.getElementsByTagName("a")[0];if(!all||!a||!all.length){return{}}select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];a.style.cssText="top:1px;float:left;opacity:.5";support={leadingWhitespace:(div.firstChild.nodeType===3),tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:(a.getAttribute("href")==="/a"),opacity:/^0.5/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:(input.value==="on"),optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",boxModel:(document.compatMode==="CSS1Compat"),submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true,boxSizingReliable:true,pixelPosition:false};input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;try{delete div.test}catch(e){support.deleteExpando=false}if(!div.addEventListener&&div.attachEvent&&div.fireEvent){div.attachEvent("onclick",clickFn=function(){support.noCloneEvent=false});div.cloneNode(true).fireEvent("onclick");div.detachEvent("onclick",clickFn)}input=document.createElement("input");input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);fragment=document.createDocumentFragment();fragment.appendChild(div.lastChild);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.appendChecked=input.checked;fragment.removeChild(input);fragment.appendChild(div);if(div.attachEvent){for(i in {submit:true,change:true,focusin:true}){eventName="on"+i;isSupported=(eventName in div);if(!isSupported){div.setAttribute(eventName,"return;");isSupported=(typeof div[eventName]==="function")}support[i+"Bubbles"]=isSupported}}jQuery(function(){var container,div,tds,marginDiv,divReset="padding:0;margin:0;border:0;display:block;overflow:hidden;",body=document.getElementsByTagName("body")[0];if(!body){return}container=document.createElement("div");container.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";body.insertBefore(container,body.firstChild);div=document.createElement("div");container.appendChild(div);div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");tds[0].style.cssText="padding:0;margin:0;border:0;display:none";isSupported=(tds[0].offsetHeight===0);tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&(tds[0].offsetHeight===0);div.innerHTML="";div.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";support.boxSizing=(div.offsetWidth===4);support.doesNotIncludeMarginInBodyOffset=(body.offsetTop!==1);if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=document.createElement("div");marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";div.appendChild(marginDiv);support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)}if(typeof div.style.zoom!=="undefined"){div.innerHTML="";div.style.cssText=divReset+"width:1px;padding:1px;display:inline;zoom:1";support.inlineBlockNeedsLayout=(div.offsetWidth===3);div.style.display="block";div.style.overflow="visible";div.innerHTML="<div></div>";div.firstChild.style.width="5px";support.shrinkWrapBlocks=(div.offsetWidth!==3);container.style.zoom=1}body.removeChild(container);container=div=tds=marginDiv=null});fragment.removeChild(div);all=a=select=opt=input=fragment=div=null;return support})();var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return !!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return}var thisCache,ret,internalKey=jQuery.expando,getByName=typeof name==="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||(!pvt&&!cache[id].data))&&getByName&&data===undefined){return}if(!id){if(isNode){elem[internalKey]=id=jQuery.deletedIds.pop()||jQuery.guid++}else{id=internalKey}}if(!cache[id]){cache[id]={};if(!isNode){cache[id].toJSON=jQuery.noop}}if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name)}else{cache[id].data=jQuery.extend(cache[id].data,name)}}thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={}}thisCache=thisCache.data}if(data!==undefined){thisCache[jQuery.camelCase(name)]=data}if(getByName){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)]}}else{ret=thisCache}return ret},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem)){return}var thisCache,i,l,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return}if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name]}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name]}else{name=name.split(" ")}}}for(i=0,l=name.length;i<l;i++){delete thisCache[name[i]]}if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache)){return}}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return}}if(isNode){jQuery.cleanData([elem],true)}else{if(jQuery.support.deleteExpando||cache!=cache.window){delete cache[id]}else{cache[id]=null}}},_data:function(elem,name,data){return jQuery.data(elem,name,data,true)},acceptData:function(elem){var noData=elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()];return !noData||noData!==true&&elem.getAttribute("classid")===noData}});jQuery.fn.extend({data:function(key,value){var parts,part,attr,name,l,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){attr=elem.attributes;for(l=attr.length;i<l;i++){name=attr[i].name;if(!name.indexOf("data-")){name=jQuery.camelCase(name.substring(5));dataAttr(elem,name,data[name])}}jQuery._data(elem,"parsedAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){jQuery.data(this,key)})}parts=key.split(".",2);parts[1]=parts[1]?"."+parts[1]:"";part=parts[1]+"!";return jQuery.access(this,function(value){if(value===undefined){data=this.triggerHandler("getData"+part,[parts[0]]);if(data===undefined&&elem){data=jQuery.data(elem,key);data=dataAttr(elem,key,data)}return data===undefined&&parts[1]?this.data(parts[0]):data}parts[1]=value;this.each(function(){var self=jQuery(this);self.triggerHandler("setData"+part,parts);jQuery.data(this,key,value);self.triggerHandler("changeData"+part,parts)})},null,value,arguments.length>1,null,false)},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else{data=undefined}}return data}function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue}if(name!=="toJSON"){return false}}return true}jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery.removeData(elem,type+"queue",true);jQuery.removeData(elem,key,true)})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var nodeHook,boolHook,fixSpecified,rclass=/[\t\r\n]/g,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea|)$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name]}catch(e){}})},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(value&&typeof value==="string"){classNames=value.split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1){if(!elem.className&&classNames.length===1){elem.className=value}else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(setClass.indexOf(" "+classNames[c]+" ")<0){setClass+=classNames[c]+" "}}elem.className=jQuery.trim(setClass)}}}}return this},removeClass:function(value){var removes,className,elem,c,cl,i,l;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if((value&&typeof value==="string")||value===undefined){removes=(value||"").split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=removes.length;c<cl;c++){while(className.indexOf(" "+removes[c]+" ")>=0){className=className.replace(" "+removes[c]+" "," ")}}elem.className=value?jQuery.trim(className):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(core_rspace);while((className=classNames[i++])){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className)}}else{if(type==="undefined"||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className)}this.className=this.className||value===false?"":jQuery._data(this,"__className__")||""}}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get" in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val,self=jQuery(this);if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,self.val())}else{val=value}if(val==null){val=""}else{if(typeof val==="number"){val+=""}else{if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}}}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set" in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return !val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var values=jQuery.makeArray(value);jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0});if(!values.length){elem.selectedIndex=-1}return values}}},attrFn:{},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(pass&&jQuery.isFunction(jQuery.fn[name])){return jQuery(elem)[name](value)}if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value)}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return}else{if(hooks&&"set" in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}}else{if(hooks&&"get" in hooks&&notxml&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=elem.getAttribute(name);return ret===null?undefined:ret}}},removeAttr:function(elem,value){var propName,attrNames,name,isBool,i=0;if(value&&elem.nodeType===1){attrNames=value.split(core_rspace);for(;i<attrNames.length;i++){name=attrNames[i];if(name){propName=jQuery.propFix[name]||name;isBool=rboolean.test(name);if(!isBool){jQuery.attr(elem,name,"")}elem.removeAttribute(getSetAttribute?name:propName);if(isBool&&propName in elem){elem[propName]=false}}}}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode){jQuery.error("type property can't be changed")}else{if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},value:{get:function(elem,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.get(elem,name)}return name in elem?elem.value:null},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.set(elem,value,name)}elem.value=value}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){if(hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{return(elem[name]=value)}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{return elem[name]}}},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined}}}});boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===true||typeof property!=="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==false?name.toLowerCase():undefined},set:function(elem,value,name){var propName;if(value===false){jQuery.removeAttr(elem,name)}else{propName=jQuery.propFix[name]||name;if(propName in elem){elem[propName]=true}elem.setAttribute(name,name.toLowerCase())}return name}};if(!getSetAttribute){fixSpecified={name:true,id:true,coords:true};nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;ret=elem.getAttributeNode(name);return ret&&(fixSpecified[name]?ret.value!=="":ret.specified)?ret.value:undefined},set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){ret=document.createAttribute(name);elem.setAttributeNode(ret)}return(ret.value=value+"")}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value}}})});jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){if(value===""){value="false"}nodeHook.set(elem,value,name)}}}if(!jQuery.support.hrefNormalized){jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret}})})}if(!jQuery.support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined},set:function(elem,value){return(elem.style.cssText=value+"")}}}if(!jQuery.support.optSelected){jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}return null}})}if(!jQuery.support.enctype){jQuery.propFix.enctype="encoding"}if(!jQuery.support.checkOn){jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value}}})}jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0)}}})});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*|)(?:\.(.+)|)$/,rhoverHack=/(?:^|\s)hover(\.\S+|)\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1")};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events,t,tns,type,namespaces,handleObj,handleObjIn,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem))){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}events=elemData.events;if(!events){elemData.events=events={}}eventHandle=elemData.handle;if(!eventHandle){elemData.handle=eventHandle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=tns[1];namespaces=(tns[2]||"").split(".").sort();special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);handlers=events[type];if(!handlers){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}else{if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle)}}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},global:{},remove:function(elem,types,handler,selector,mappedTypes){var t,tns,type,origType,namespaces,origCount,j,events,special,eventType,handleObj,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return}types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=origType=tns[1];namespaces=tns[2];if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;eventType=events[type]||[];origCount=eventType.length;namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++){handleObj=eventType[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){eventType.splice(j--,1);if(handleObj.selector){eventType.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(eventType.length===0&&origCount!==eventType.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery.removeData(elem,"events",true)}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(event,data,elem,onlyHandlers){if(elem&&(elem.nodeType===3||elem.nodeType===8)){return}var cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType,type=event.type||event,namespaces=[];if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf("!")>=0){type=type.slice(0,-1);exclusive=true}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type]){return}event=typeof event==="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type);event.type=type;event.isTrigger=true;event.exclusive=exclusive;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;ontype=type.indexOf(":")<0?"on"+type:"";if(!elem){cache=jQuery.cache;for(i in cache){if(cache[i].events&&cache[i].events[type]){jQuery.event.trigger(event,data,cache[i].handle.elem,true)}}return}event.result=undefined;if(!event.target){event.target=elem}data=data!=null?jQuery.makeArray(data):[];data.unshift(event);special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===false){return}eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode;for(old=elem;cur;cur=cur.parentNode){eventPath.push([cur,bubbleType]);old=cur}if(old===(elem.ownerDocument||document)){eventPath.push([old.defaultView||old.parentWindow||window,bubbleType])}}for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++){cur=eventPath[i][0];event.type=eventPath[i][1];handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault()}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(elem.ownerDocument,data)===false)&&!(type==="click"&&jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&((type!=="focus"&&type!=="blur")||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)){old=elem[ontype];if(old){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(old){elem[ontype]=old}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event||window.event);var i,j,cur,ret,selMatch,matched,matches,handleObj,sel,related,handlers=((jQuery._data(this,"events")||{})[event.type]||[]),delegateCount=handlers.delegateCount,args=core_slice.call(arguments),run_all=!event.exclusive&&!event.namespace,special=jQuery.event.special[event.type]||{},handlerQueue=[];args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}if(delegateCount&&!(event.button&&event.type==="click")){for(cur=event.target;cur!=this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){selMatch={};matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector;if(selMatch[sel]===undefined){selMatch[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(selMatch[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,matches:matches})}}}}if(handlers.length>delegateCount){handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)})}for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i];event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||(!event.namespace&&!handleObj.namespace)||event.namespace_re&&event.namespace_re.test(handleObj.namespace)){event.data=handleObj.data;event.handleObj=handleObj;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){event.result=ret;if(ret===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement}if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)))}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;){prop=copy[--i];event[prop]=originalEvent[prop]}if(!event.target){event.target=originalEvent.srcElement||document}if(event.target.nodeType===3){event.target=event.target.parentNode}event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){if(jQuery.isWindow(this)){this.onbeforeunload=eventHandle}},teardown:function(namespaces,eventHandle){if(this.onbeforeunload===eventHandle){this.onbeforeunload=null}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.event.handle=jQuery.event.dispatch;jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]==="undefined"){elem[name]=null}elem.detachEvent(name,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};function returnFalse(){return false}function returnTrue(){return true}jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!jQuery.support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!jQuery._data(form,"_submit_attached")){jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=true});jQuery._data(form,"_submit_attached",true)}})},postDispatch:function(event){if(event._submit_bubble){delete event._submit_bubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true)}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.remove(this,"._submit")}}}if(!jQuery.support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false}jQuery.event.simulate("change",this,event,true)})}return false}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"_change_attached")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true)}});jQuery._data(elem,"_change_attached",true)}})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments)}},teardown:function(){jQuery.event.remove(this,"._change");return !rformElems.test(this.nodeName)}}}if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true)}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else{if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}}if(fn===false){fn=returnFalse}else{if(!fn){return this}}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},live:function(types,data,fn){jQuery(this.context).on(types,this.selector,data,fn);return this},die:function(types,fn){jQuery(this.context).off(types,this.selector||"**",fn);return this},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){if(this[0]){return jQuery.event.trigger(type,data,this[0],true)}},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1);event.preventDefault();return args[lastToggle].apply(this,arguments)||false};toggler.guid=guid;while(i<args.length){args[i++].guid=guid}return this.click(toggler)},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){if(fn==null){fn=data;data=null}return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)};if(rkeyEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.keyHooks}if(rmouseEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.mouseHooks}});
/*!
 * Sizzle CSS Selector Engine
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://sizzlejs.com/
 */
(function(window,undefined){var cachedruns,assertGetIdNotName,Expr,getText,isXML,contains,compile,sortOrder,hasDuplicate,outermostContext,baseHasDuplicate=true,strundefined="undefined",expando=("sizcache"+Math.random()).replace(".",""),Token=String,document=window.document,docElem=document.documentElement,dirruns=0,done=0,pop=[].pop,push=[].push,slice=[].slice,indexOf=[].indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return -1},markFunction=function(fn,value){fn[expando]=value==null||value;return fn},createCache=function(){var cache={},keys=[];return markFunction(function(key,value){if(keys.push(key)>Expr.cacheLength){delete cache[keys.shift()]}return(cache[key+" "]=value)},cache)},classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),operators="([*^$|!~]?=)",attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:"+operators+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+attributes+")|[^:]|\\\\.)*|.*))\\)|)",pos=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([\\x20\\t\\r\\n\\f>+~])"+whitespace+"*"),rpseudo=new RegExp(pseudos),rquickExpr=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,rnot=/^:not/,rsibling=/[\x20\t\r\n\f]*[+~]/,rendsWithNot=/:not\($/,rheader=/h\d/i,rinputs=/input|select|textarea|button/i,rbackslash=/\\(?!\\)/g,matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),NAME:new RegExp("^\\[name=['\"]?("+characterEncoding+")['\"]?\\]"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),POS:new RegExp(pos,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|"+pos,"i")},assert=function(fn){var div=document.createElement("div");try{return fn(div)}catch(e){return false}finally{div=null}},assertTagNameNoComments=assert(function(div){div.appendChild(document.createComment(""));return !div.getElementsByTagName("*").length}),assertHrefNotNormalized=assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild&&typeof div.firstChild.getAttribute!==strundefined&&div.firstChild.getAttribute("href")==="#"}),assertAttributes=assert(function(div){div.innerHTML="<select></select>";var type=typeof div.lastChild.getAttribute("multiple");return type!=="boolean"&&type!=="string"}),assertUsableClassName=assert(function(div){div.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!div.getElementsByClassName||!div.getElementsByClassName("e").length){return false}div.lastChild.className="e";return div.getElementsByClassName("e").length===2}),assertUsableName=assert(function(div){div.id=expando+0;div.innerHTML="<a name='"+expando+"'></a><div name='"+expando+"'></div>";docElem.insertBefore(div,docElem.firstChild);var pass=document.getElementsByName&&document.getElementsByName(expando).length===2+document.getElementsByName(expando+0).length;assertGetIdNotName=!document.getElementById(expando);docElem.removeChild(div);return pass});try{slice.call(docElem.childNodes,0)[0].nodeType}catch(e){slice=function(i){var elem,results=[];for(;(elem=this[i]);i++){results.push(elem)}return results}}function Sizzle(selector,context,results,seed){results=results||[];context=context||document;var match,elem,xml,m,nodeType=context.nodeType;if(!selector||typeof selector!=="string"){return results}if(nodeType!==1&&nodeType!==9){return[]}xml=isXML(context);if(!xml&&!seed){if((match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else{if(match[2]){push.apply(results,slice.call(context.getElementsByTagName(selector),0));return results}else{if((m=match[3])&&assertUsableClassName&&context.getElementsByClassName){push.apply(results,slice.call(context.getElementsByClassName(m),0));return results}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed,xml)}Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){return Sizzle(expr,null,null,[elem]).length>0};function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j])}}})})}getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else{if(nodeType===3||nodeType===4){return elem.nodeValue}}}else{for(;(node=elem[i]);i++){ret+=getText(node)}}return ret};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};contains=Sizzle.contains=docElem.contains?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&adown.contains&&adown.contains(bup))}:docElem.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16)}:function(a,b){while((b=b.parentNode)){if(b===a){return true}}return false};Sizzle.attr=function(elem,name){var val,xml=isXML(elem);if(!xml){name=name.toLowerCase()}if((val=Expr.attrHandle[name])){return val(elem)}if(xml||assertAttributes){return elem.getAttribute(name)}val=elem.getAttributeNode(name);return val?typeof elem[name]==="boolean"?elem[name]?name:null:val.specified?val.value:null:null};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:assertHrefNotNormalized?{}:{href:function(elem){return elem.getAttribute("href",2)},type:function(elem){return elem.getAttribute("type")}},find:{ID:assertGetIdNotName?function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}}:function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m?m.id===id||typeof m.getAttributeNode!==strundefined&&m.getAttributeNode("id").value===id?[m]:undefined:[]}},TAG:assertTagNameNoComments?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var results=context.getElementsByTagName(tag);if(tag==="*"){var elem,tmp=[],i=0;for(;(elem=results[i]);i++){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results},NAME:assertUsableName&&function(tag,context){if(typeof context.getElementsByName!==strundefined){return context.getElementsByName(name)}},CLASS:assertUsableClassName&&function(className,context,xml){if(typeof context.getElementsByClassName!==strundefined&&!xml){return context.getElementsByClassName(className)}}},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(rbackslash,"");match[3]=(match[4]||match[5]||"").replace(rbackslash,"");if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1]==="nth"){if(!match[2]){Sizzle.error(match[0])}match[3]=+(match[3]?match[4]+(match[5]||1):2*(match[2]==="even"||match[2]==="odd"));match[4]=+((match[6]+match[7])||match[2]==="odd")}else{if(match[2]){Sizzle.error(match[0])}}return match},PSEUDO:function(match){var unquoted,excess;if(matchExpr.CHILD.test(match[0])){return null}if(match[3]){match[2]=match[3]}else{if((unquoted=match[4])){if(rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){unquoted=unquoted.slice(0,excess);match[0]=match[0].slice(0,excess)}match[2]=unquoted}}return match.slice(0,3)}},filter:{ID:assertGetIdNotName?function(id){id=id.replace(rbackslash,"");return function(elem){return elem.getAttribute("id")===id}}:function(id){id=id.replace(rbackslash,"");return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===id}},TAG:function(nodeName){if(nodeName==="*"){return function(){return true}}nodeName=nodeName.replace(rbackslash,"").toLowerCase();return function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[expando][className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(elem.className||(typeof elem.getAttribute!==strundefined&&elem.getAttribute("class"))||"")})},ATTR:function(name,operator,check){return function(elem,context){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.substr(result.length-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.substr(0,check.length+1)===check+"-":false}},CHILD:function(type,argument,first,last){if(type==="nth"){return function(elem){var node,diff,parent=elem.parentNode;if(first===1&&last===0){return true}if(parent){diff=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){diff++;if(elem===node){break}}}}diff-=last;return diff===first||(diff%first===0&&diff/first>=0)}}return function(elem){var node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false}}if(type==="first"){return true}node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false}}return true}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return !results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected)},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},parent:function(elem){return !Expr.pseudos.empty(elem)},empty:function(elem){var nodeType;elem=elem.firstChild;while(elem){if(elem.nodeName>"@"||(nodeType=elem.nodeType)===3||nodeType===4){return false}elem=elem.nextSibling}return true},header:function(elem){return rheader.test(elem.nodeName)},text:function(elem){var type,attr;return elem.nodeName.toLowerCase()==="input"&&(type=elem.type)==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===type)},radio:createInputPseudo("radio"),checkbox:createInputPseudo("checkbox"),file:createInputPseudo("file"),password:createInputPseudo("password"),image:createInputPseudo("image"),submit:createButtonPseudo("submit"),reset:createButtonPseudo("reset"),button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},input:function(elem){return rinputs.test(elem.nodeName)},focus:function(elem){var doc=elem.ownerDocument;return elem===doc.activeElement&&(!doc.hasFocus||doc.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},active:function(elem){return elem===elem.ownerDocument.activeElement},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;){matchIndexes.push(i)}return matchIndexes})}};function siblingCheck(a,b,ret){if(a===b){return ret}var cur=a.nextSibling;while(cur){if(cur===b){return -1}cur=cur.nextSibling}return 1}sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0}return(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}else{if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex}}var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup){return siblingCheck(a,b)}else{if(!aup){return -1}else{if(!bup){return 1}}}while(cur){ap.unshift(cur);cur=cur.parentNode}cur=bup;while(cur){bp.unshift(cur);cur=cur.parentNode}al=ap.length;bl=bp.length;for(var i=0;i<al&&i<bl;i++){if(ap[i]!==bp[i]){return siblingCheck(ap[i],bp[i])}}return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1)};[0,0].sort(sortOrder);baseHasDuplicate=!hasDuplicate;Sizzle.uniqueSort=function(results){var elem,duplicates=[],i=1,j=0;hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(;(elem=results[i]);i++){if(elem===results[i-1]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}return results};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[expando][selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if((match=rcombinators.exec(soFar))){tokens.push(matched=new Token(match.shift()));soFar=soFar.slice(matched.length);matched.type=match[0].replace(rtrim," ")}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){tokens.push(matched=new Token(match.shift()));soFar=soFar.slice(matched.length);matched.type=type;matched.matches=match}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&combinator.dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){return matcher(elem,context,xml)}}}:function(elem,context,xml){if(!xml){var cache,dirkey=dirruns+" "+doneName+" ",cachedkey=dirkey+cachedruns;while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){if((cache=elem[expando])===cachedkey){return elem.sizset}else{if(typeof cache==="string"&&cache.indexOf(dirkey)===0){if(elem.sizset){return elem}}else{elem[expando]=cachedkey;if(matcher(elem,context,xml)){elem.sizset=true;return elem}elem.sizset=false}}}}}else{while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){if(matcher(elem,context,xml)){return elem}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem))}}postFinder(null,(matcherOut=[]),temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&tokens.slice(0,i-1).join("").replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&tokens.join(""))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",expandContext&&context.parentNode||context),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.E);if(outermost){outermostContext=context!==document&&context;cachedruns=superMatcher.el}for(;(elem=elems[i])!=null;i++){if(byElement&&elem){for(j=0;(matcher=elementMatchers[j]);j++){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique;cachedruns=++superMatcher.el}}if(bySet){if((elem=!matcher&&elem)){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){for(j=0;(matcher=setMatchers[j]);j++){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};superMatcher.el=0;return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[expando][selector+" "];if(!cached){if(!group){group=tokenize(selector)}i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function select(selector,context,results,seed,xml){var i,tokens,token,type,find,match=tokenize(selector),j=match.length;if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&context.nodeType===9&&!xml&&Expr.relative[tokens[1].type]){context=Expr.find.ID(token.matches[0].replace(rbackslash,""),context,xml)[0];if(!context){return results}selector=selector.slice(tokens.shift().length)}for(i=matchExpr.POS.test(selector)?-1:tokens.length-1;i>=0;i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break}if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(rbackslash,""),rsibling.test(tokens[0].type)&&context.parentNode||context,xml))){tokens.splice(i,1);selector=seed.length&&tokens.join("");if(!selector){push.apply(results,slice.call(seed,0));return results}break}}}}}compile(selector,match)(seed,context,xml,results,rsibling.test(selector));return results}if(document.querySelectorAll){(function(){var disconnectedMatch,oldSelect=select,rescape=/'|\\/g,rattributeQuotes=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,rbuggyQSA=[":focus"],rbuggyMatches=[":active"],matches=docElem.matchesSelector||docElem.mozMatchesSelector||docElem.webkitMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector;assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){div.innerHTML="<p test=''></p>";if(div.querySelectorAll("[test^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:\"\"|'')")}div.innerHTML="<input type='hidden'/>";if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}});rbuggyQSA=new RegExp(rbuggyQSA.join("|"));select=function(selector,context,results,seed,xml){if(!seed&&!xml&&!rbuggyQSA.test(selector)){var groups,i,old=true,nid=expando,newContext=context,newSelector=context.nodeType===9&&selector;if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if((old=context.getAttribute("id"))){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+groups[i].join("")}newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,slice.call(newContext.querySelectorAll(newSelector),0));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}return oldSelect(selector,context,results,seed,xml)};if(matches){assert(function(div){disconnectedMatch=matches.call(div,"div");try{matches.call(div,"[test!='']:sizzle");rbuggyMatches.push("!=",pseudos)}catch(e){}});rbuggyMatches=new RegExp(rbuggyMatches.join("|"));Sizzle.matchesSelector=function(elem,expr){expr=expr.replace(rattributeQuotes,"='$1']");if(!isXML(elem)&&!rbuggyMatches.test(expr)&&!rbuggyQSA.test(expr)){try{var ret=matches.call(elem,expr);if(ret||disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,null,null,[elem]).length>0}}})()}Expr.pseudos.nth=Expr.pseudos.eq;function setFilters(){}Expr.filters=setFilters.prototype=Expr.pseudos;Expr.setFilters=new setFilters();Sizzle.attr=jQuery.attr;jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains})(window);var runtil=/Until$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,isSimple=/^.[^:#\[\.,]*$/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,l,length,n,r,ret,self=this;if(typeof selector!=="string"){return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++){if(jQuery.contains(self[i],this)){return true}}})}ret=this.pushStack("","find",selector);for(i=0,l=this.length;i<l;i++){length=ret.length;jQuery.find(selector,this[i],ret);if(i>0){for(n=length;n<ret.length;n++){for(r=0;r<length;r++){if(ret[r]===ret[n]){ret.splice(n--,1);break}}}}}return ret},has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true}}})},not:function(selector){return this.pushStack(winnow(this,selector,false),"not",selector)},filter:function(selector){return this.pushStack(winnow(this,selector,true),"filter",selector)},is:function(selector){return !!selector&&(typeof selector==="string"?rneedsContext.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0)},closest:function(selectors,context){var cur,i=0,l=this.length,ret=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){cur=this[i];while(cur&&cur.ownerDocument&&cur!==context&&cur.nodeType!==11){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break}cur=cur.parentNode}}ret=ret.length>1?jQuery.unique(ret):ret;return this.pushStack(ret,"closest",selectors)},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.prevAll().length:-1}if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem))}return jQuery.inArray(elem.jquery?elem[0]:elem,this)},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});jQuery.fn.andSelf=jQuery.fn.addBack;function isDisconnected(node){return !node||!node.parentNode||node.parentNode.nodeType===11}function sibling(cur,dir){do{cur=cur[dir]}while(cur&&cur.nodeType!==1);return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(!runtil.test(name)){selector=until}if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret)}ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret;if(this.length>1&&rparentsprev.test(name)){ret=ret.reverse()}return this.pushStack(ret,name,core_slice.call(arguments).join(","))}});jQuery.extend({filter:function(expr,elems,not){if(not){expr=":not("+expr+")"}return elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems)},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur)}cur=cur[dir]}return matched},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n)}}return r}});function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep})}else{if(qualifier.nodeType){return jQuery.grep(elements,function(elem,i){return(elem===qualifier)===keep})}else{if(typeof qualifier==="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1});if(isSimple.test(qualifier)){return jQuery.filter(qualifier,filtered,!keep)}else{qualifier=jQuery.filter(qualifier,filtered)}}}}return jQuery.grep(elements,function(elem,i){return(jQuery.inArray(elem,qualifier)>=0)===keep})}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop())}}return safeFrag}var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rcheckableType=/^(?:checkbox|radio)$/,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;if(!jQuery.support.htmlSerialize){wrapMap._default=[1,"X<div>","</div>"]}jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.insertBefore(elem,this.firstChild)}})},before:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this)})}if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(set,this),"before",this.selector)}},after:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this.nextSibling)})}if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(this,set),"after",this.selector)}},remove:function(selector,keepData){var elem,i=0;for(;(elem=this[i])!=null;i++){if(!selector||jQuery.filter(selector,[elem]).length){if(!keepData&&elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));jQuery.cleanData([elem])}if(elem.parentNode){elem.parentNode.removeChild(elem)}}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"))}while(elem.firstChild){elem.removeChild(elem.firstChild)}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.htmlSerialize||!rnoshimcache.test(value))&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(value){if(!isDisconnected(this[0])){if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old))})}if(typeof value!=="string"){value=jQuery(value).detach()}return this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove();if(next){jQuery(next).before(value)}else{jQuery(parent).append(value)}})}return this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this},detach:function(selector){return this.remove(selector,true)},domManip:function(args,table,callback){args=[].concat.apply([],args);var results,first,fragment,iNoClone,i=0,value=args[0],scripts=[],l=this.length;if(!jQuery.support.checkClone&&l>1&&typeof value==="string"&&rchecked.test(value)){return this.each(function(){jQuery(this).domManip(args,table,callback)})}if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined);self.domManip(args,table,callback)})}if(this[0]){results=jQuery.buildFragment(args,this,scripts);fragment=results.fragment;first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){table=table&&jQuery.nodeName(first,"tr");for(iNoClone=results.cacheable||l-1;i<l;i++){callback.call(table&&jQuery.nodeName(this[i],"table")?findOrAppend(this[i],"tbody"):this[i],i===iNoClone?fragment:jQuery.clone(fragment,true,true))}}fragment=first=null;if(scripts.length){jQuery.each(scripts,function(i,elem){if(elem.src){if(jQuery.ajax){jQuery.ajax({url:elem.src,type:"GET",dataType:"script",async:false,global:false,"throws":true})}else{jQuery.error("no ajax")}}else{jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,""))}if(elem.parentNode){elem.parentNode.removeChild(elem)}})}}return this}});function findOrAppend(elem,tag){return elem.getElementsByTagName(tag)[0]||elem.appendChild(elem.ownerDocument.createElement(tag))}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return}var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}if(curData.data){curData.data=jQuery.extend({},curData.data)}}function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1){return}if(dest.clearAttributes){dest.clearAttributes()}if(dest.mergeAttributes){dest.mergeAttributes(src)}nodeName=dest.nodeName.toLowerCase();if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML}if(jQuery.support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML}}else{if(nodeName==="input"&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value}}else{if(nodeName==="option"){dest.selected=src.defaultSelected}else{if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}else{if(nodeName==="script"&&dest.text!==src.text){dest.text=src.text}}}}}dest.removeAttribute(jQuery.expando)}jQuery.buildFragment=function(args,context,scripts){var fragment,cacheable,cachehit,first=args[0];context=context||document;context=!context.nodeType&&context[0]||context;context=context.ownerDocument||context;if(args.length===1&&typeof first==="string"&&first.length<512&&context===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))){cacheable=true;fragment=jQuery.fragments[first];cachehit=fragment!==undefined}if(!fragment){fragment=context.createDocumentFragment();jQuery.clean(args,context,fragment,scripts);if(cacheable){jQuery.fragments[first]=cachehit&&fragment}}return{fragment:fragment,cacheable:cacheable}};jQuery.fragments={};jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),l=insert.length,parent=this.length===1&&this[0].parentNode;if((parent==null||parent&&parent.nodeType===11&&parent.childNodes.length===1)&&l===1){insert[original](this[0]);return this}else{for(;i<l;i++){elems=(i>0?this.clone(true):this).get();jQuery(insert[i])[original](elems);ret=ret.concat(elems)}return this.pushStack(ret,name,insert.selector)}}});function getAll(elem){if(typeof elem.getElementsByTagName!=="undefined"){return elem.getElementsByTagName("*")}else{if(typeof elem.querySelectorAll!=="undefined"){return elem.querySelectorAll("*")}else{return[]}}}function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked}}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone;if(jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true)}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild)}if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone);srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){if(destElements[i]){cloneFixAttributes(srcElements[i],destElements[i])}}}if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){cloneCopyEvent(srcElements[i],destElements[i])}}}srcElements=destElements=null;return clone},clean:function(elems,context,fragment,scripts){var i,j,elem,tag,wrap,depth,div,hasBody,tbody,len,handleScript,jsTags,safe=context===document&&safeFragment,ret=[];if(!context||typeof context.createDocumentFragment==="undefined"){context=document}for(i=0;(elem=elems[i])!=null;i++){if(typeof elem==="number"){elem+=""}if(!elem){continue}if(typeof elem==="string"){if(!rhtml.test(elem)){elem=context.createTextNode(elem)}else{safe=safe||createSafeFragment(context);div=context.createElement("div");safe.appendChild(div);elem=elem.replace(rxhtmlTag,"<$1></$2>");tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;depth=wrap[0];div.innerHTML=wrap[1]+elem+wrap[2];while(depth--){div=div.lastChild}if(!jQuery.support.tbody){hasBody=rtbody.test(elem);tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j])}}}if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)){div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild)}elem=div.childNodes;div.parentNode.removeChild(div)}}if(elem.nodeType){ret.push(elem)}else{jQuery.merge(ret,elem)}}if(div){elem=div=safe=null}if(!jQuery.support.appendChecked){for(i=0;(elem=ret[i])!=null;i++){if(jQuery.nodeName(elem,"input")){fixDefaultChecked(elem)}else{if(typeof elem.getElementsByTagName!=="undefined"){jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked)}}}}if(fragment){handleScript=function(elem){if(!elem.type||rscriptType.test(elem.type)){return scripts?scripts.push(elem.parentNode?elem.parentNode.removeChild(elem):elem):fragment.appendChild(elem)}};for(i=0;(elem=ret[i])!=null;i++){if(!(jQuery.nodeName(elem,"script")&&handleScript(elem))){fragment.appendChild(elem);if(typeof elem.getElementsByTagName!=="undefined"){jsTags=jQuery.grep(jQuery.merge([],elem.getElementsByTagName("script")),handleScript);ret.splice.apply(ret,[i+1,0].concat(jsTags));i+=jsTags.length}}}}return ret},cleanData:function(elems,acceptData){var data,id,elem,type,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=jQuery.support.deleteExpando,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(cache[id]){delete cache[id];if(deleteExpando){delete elem[internalKey]}else{if(elem.removeAttribute){elem.removeAttribute(internalKey)}else{elem[internalKey]=null}}jQuery.deletedIds.push(id)}}}}}});(function(){var matched,browser;jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}};matched=jQuery.uaMatch(navigator.userAgent);browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version}if(browser.chrome){browser.webkit=true}else{if(browser.webkit){browser.safari=true}}jQuery.browser=browser;jQuery.sub=function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context)}jQuery.extend(true,jQuerySub,this);jQuerySub.superclass=this;jQuerySub.fn=jQuerySub.prototype=this();jQuerySub.fn.constructor=jQuerySub;jQuerySub.sub=this.sub;jQuerySub.fn.init=function init(selector,context){if(context&&context instanceof jQuery&&!(context instanceof jQuerySub)){context=jQuerySub(context)}return jQuery.fn.init.call(this,selector,context,rootjQuerySub)};jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub}})();var curCSS,iframe,iframeDoc,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rposition=/^(top|right|bottom|left)$/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([-+])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"],eventsToggle=jQuery.fn.toggle;function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)}function showHide(elements,show){var elem,display,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=jQuery._data(elem,"olddisplay");if(show){if(!values[index]&&elem.style.display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",css_defaultDisplay(elem.nodeName))}}else{display=curCSS(elem,"display");if(!values[index]&&display!=="none"){jQuery._data(elem,"olddisplay",display)}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state,fn2){var bool=typeof state==="boolean";if(jQuery.isFunction(state)&&jQuery.isFunction(fn2)){return eventsToggle.apply(this,arguments)}return this.each(function(){if(bool?state:isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||type==="number"&&isNaN(value)){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!hooks||!("set" in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value}catch(e){}}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,numeric,extra){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get" in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(numeric||extra!==undefined){num=parseFloat(val);return numeric||jQuery.isNumeric(num)?num||0:val}return val},swap:function(elem,options,callback){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.call(elem);for(name in options){elem.style[name]=old[name]}return ret}});if(window.getComputedStyle){curCSS=function(elem,name){var ret,width,minWidth,maxWidth,computed=window.getComputedStyle(elem,null),style=elem.style;if(computed){ret=computed.getPropertyValue(name)||computed[name];if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret}}else{if(document.documentElement.currentStyle){curCSS=function(elem,name){var left,rsLeft,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;if(ret==null&&style&&style[name]){ret=style[name]}if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left;if(rsLeft){elem.runtimeStyle.left=elem.currentStyle.left}style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){elem.runtimeStyle.left=rsLeft}}return ret===""?"auto":ret}}}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true)}if(isBorderBox){if(extra==="content"){val-=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0}if(extra!=="margin"){val-=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0}}else{val+=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0;if(extra!=="padding"){val+=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0}}}return val}function getWidthOrHeight(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,valueIsBorderBox=true,isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box";if(val<=0||val==null){val=curCSS(elem,name);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0}return(val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox))+"px"}function css_defaultDisplay(nodeName){if(elemdisplay[nodeName]){return elemdisplay[nodeName]}var elem=jQuery("<"+nodeName+">").appendTo(document.body),display=elem.css("display");elem.remove();if(display==="none"||display===""){iframe=document.body.appendChild(iframe||jQuery.extend(document.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!iframeDoc||!iframe.createElement){iframeDoc=(iframe.contentWindow||iframe.contentDocument).document;iframeDoc.write("<!doctype html><html><body>");iframeDoc.close()}elem=iframeDoc.body.appendChild(iframeDoc.createElement(nodeName));display=curCSS(elem,"display");document.body.removeChild(iframe)}elemdisplay[nodeName]=display;return display}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){if(elem.offsetWidth===0&&rdisplayswap.test(curCSS(elem,"display"))){return jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)})}else{return getWidthOrHeight(elem,name,extra)}}},set:function(elem,value,extra){return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box"):0)}}});if(!jQuery.support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(0.01*parseFloat(RegExp.$1))+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter){return}}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}}}jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){return jQuery.swap(elem,{display:"inline-block"},function(){if(computed){return curCSS(elem,"marginRight")}})}}}if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){var ret=curCSS(elem,prop);return rnumnonpx.test(ret)?jQuery(elem).position()[prop]+"px":ret}}}})}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return(elem.offsetWidth===0&&elem.offsetHeight===0)||(!jQuery.support.reliableHiddenOffsets&&((elem.style&&elem.style.display)||curCSS(elem,"display"))==="none")};jQuery.expr.filters.visible=function(elem){return !jQuery.expr.filters.hidden(elem)}}jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i,parts=typeof value==="string"?value.split(" "):[value],expanded={};for(i=0;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rselectTextarea=/^(?:select|textarea)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else{if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}}var ajaxLocParts,ajaxLocation,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes=["*/"]+["*"];try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,list,placeBefore,dataTypes=dataTypeExpression.toLowerCase().split(core_rspace),i=0,length=dataTypes.length;if(jQuery.isFunction(func)){for(;i<length;i++){dataType=dataTypes[i];placeBefore=/^\+/.test(dataType);if(placeBefore){dataType=dataType.substr(1)||"*"}list=structure[dataType]=structure[dataType]||[];list[placeBefore?"unshift":"push"](func)}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0];inspected=inspected||{};inspected[dataType]=true;var selection,list=structure[dataType],i=0,length=list?list.length:0,executeOnly=(structure===prefilters);for(;i<length&&(executeOnly||!selection);i++){selection=list[i](options,originalOptions,jqXHR);if(typeof selection==="string"){if(!executeOnly||inspected[selection]){selection=undefined}else{options.dataTypes.unshift(selection);selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected)}}}if((executeOnly||!selection)&&!inspected["*"]){selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected)}return selection}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}}jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}if(!this.length){return this}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off,url.length);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else{if(params&&typeof params==="object"){type="POST"}}jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status){if(callback){self.each(callback,response||[jqXHR.responseText,status,jqXHR])}}}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText)});return this};jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f)}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type})}});jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},ajaxSetup:function(target,settings){if(settings){ajaxExtend(target,jQuery.ajaxSettings)}else{settings=target;target=jQuery.ajaxSettings}ajaxExtend(target,settings);return target},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var ifModifiedKey,responseHeadersString,responseHeaders,transport,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match===undefined?null:match},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},abort:function(statusText){statusText=statusText||strAbort;if(transport){transport.abort(statusText)}done(0,statusText);return this}};function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}if(status>=200&&status<300||status===304){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[ifModifiedKey]=modified}modified=jqXHR.getResponseHeader("Etag");if(modified){jQuery.etag[ifModifiedKey]=modified}}if(status===304){statusText="notmodified";isSuccess=true}else{isSuccess=ajaxConvert(s,response);statusText=isSuccess.state;success=isSuccess.data;error=isSuccess.error;isSuccess=!error}}else{error=statusText;if(!statusText||status){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop")}}}deferred.promise(jqXHR);jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;jqXHR.complete=completeDeferred.add;jqXHR.statusCode=function(map){if(map){var tmp;if(state<2){for(tmp in map){statusCode[tmp]=[statusCode[tmp],map[tmp]]}}else{tmp=map[jqXHR.status];jqXHR.always(tmp)}}return this};s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(core_rspace);if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}if(!s.hasContent){if(s.data){s.url+=(rquery.test(s.url)?"&":"?")+s.data;delete s.data}ifModifiedKey=s.url;if(s.cache===false){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+((ret===s.url)?(rquery.test(s.url)?"&":"?")+"_="+ts:"")}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}if(s.ifModified){ifModifiedKey=ifModifiedKey||s.url;if(jQuery.lastModified[ifModifiedKey]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey])}if(jQuery.etag[ifModifiedKey]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey])}}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in {success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}return jqXHR},active:0,lastModified:{},etag:{}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields;for(type in responseFields){if(type in responses){jqXHR[responseFields[type]]=responses[type]}}while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("content-type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0] in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response){var conv,conv2,current,tmp,dataTypes=s.dataTypes.slice(),prev=dataTypes[0],converters={},i=0;if(s.dataFilter){response=s.dataFilter(response,s.dataType)}if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}for(;(current=dataTypes[++i]);){if(current!=="*"){if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else{if(converters[conv2]!==true){current=tmp[0];dataTypes.splice(i--,0,current)}}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}prev=current}}return{state:"success",data:response}}var oldCallbacks=[],rquestion=/\?/,rjsonp=/(=)\?(?=&|$)|\?\?/,nonce=jQuery.now();jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(nonce++));this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,data=s.data,url=s.url,hasCallback=s.jsonp!==false,replaceInUrl=hasCallback&&rjsonp.test(url),replaceInData=hasCallback&&!replaceInUrl&&typeof data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(data);if(s.dataTypes[0]==="jsonp"||replaceInUrl||replaceInData){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;overwritten=window[callbackName];if(replaceInUrl){s.url=url.replace(rjsonp,"$1"+callbackName)}else{if(replaceInData){s.data=data.replace(rjsonp,"$1"+callbackName)}else{if(hasCallback){s.url+=(rquestion.test(url)?"&":"?")+s.jsonp+"="+callbackName}}}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET";s.global=false}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async="async";if(s.scriptCharset){script.charset=s.scriptCharset}script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script)}script=undefined;if(!isAbort){callback(200,"success")}}};head.insertBefore(script,head.firstChild)},abort:function(){if(script){script.onload(0,1)}}}}});var xhrCallbacks,xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks){xhrCallbacks[key](0,1)}}:false,xhrId=0;function createStandardXHR(){try{return new window.XMLHttpRequest()}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return !this.isLocal&&createStandardXHR()||createActiveXHR()}:createStandardXHR;(function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&("withCredentials" in xhr)})})(jQuery.ajaxSettings.xhr());if(jQuery.support.ajax){jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var handle,i,xhr=s.xhr();if(s.username){xhr.open(s.type,s.url,s.async,s.username,s.password)}else{xhr.open(s.type,s.url,s.async)}if(s.xhrFields){for(i in s.xhrFields){xhr[i]=s.xhrFields[i]}}if(s.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(s.mimeType)}if(!s.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}try{for(i in headers){xhr.setRequestHeader(i,headers[i])}}catch(_){}xhr.send((s.hasContent&&s.data)||null);callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;if(xhrOnUnloadAbort){delete xhrCallbacks[handle]}}if(isAbort){if(xhr.readyState!==4){xhr.abort()}}else{status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();responses={};xml=xhr.responseXML;if(xml&&xml.documentElement){responses.xml=xml}try{responses.text=xhr.responseText}catch(e){}try{statusText=xhr.statusText}catch(e){statusText=""}if(!status&&s.isLocal&&!s.crossDomain){status=responses.text?200:404}else{if(status===1223){status=204}}}}}catch(firefoxAccessException){if(!isAbort){complete(-1,firefoxAccessException)}}if(responses){complete(status,statusText,responses,responseHeaders)}};if(!s.async){callback()}else{if(xhr.readyState===4){setTimeout(callback,0)}else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort)}xhrCallbacks[handle]=callback}xhr.onreadystatechange=callback}}},abort:function(){if(callback){callback(0,1)}}}}})}var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([-+])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var end,unit,tween=this.createTween(prop,value),parts=rfxnum.exec(value),target=tween.cur(),start=+target||0,scale=1,maxIterations=20;if(parts){end=+parts[2];unit=parts[3]||(jQuery.cssNumber[prop]?"":"px");if(unit!=="px"&&start){start=jQuery.css(tween.elem,prop,true)||end||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}tween.unit=unit;tween.start=start;tween.end=parts[1]?start+(parts[1]+1)*end:end}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined},0);return(fxNow=jQuery.now())}function createTweens(animation,props){jQuery.each(props,function(prop,value){var collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(collection[index].call(animation,prop,value)){return}}})}function Animation(elem,properties,options){var result,index=0,tweenerIndex=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end,easing){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}createTweens(animation,props);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{anim:animation,queue:animation.opts.queue,elem:elem}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand" in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});function defaultPrefilter(elem,props,opts){var index,prop,value,length,dataShow,toggle,tween,hooks,oldfire,anim=this,style=elem.style,orig={},handled=[],hidden=elem.nodeType&&isHidden(elem);if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height" in props||"width" in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){if(!jQuery.support.inlineBlockNeedsLayout||css_defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block"}else{style.zoom=1}}}if(opts.overflow){style.overflow="hidden";if(!jQuery.support.shrinkWrapBlocks){anim.done(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}}for(index in props){value=props[index];if(rfxtypes.exec(value)){delete props[index];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){continue}handled.push(index)}}length=handled.length;if(length){dataShow=jQuery._data(elem,"fxshow")||jQuery._data(elem,"fxshow",{});if("hidden" in dataShow){hidden=dataShow.hidden}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;jQuery.removeData(elem,"fxshow",true);for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(index=0;index<length;index++){prop=handled[index];tween=anim.createTween(prop,hidden?dataShow[prop]:0);orig[prop]=dataShow[prop]||jQuery.style(elem,prop);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,false,"");return !result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else{if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"||(!i&&jQuery.isFunction(speed)&&jQuery.isFunction(easing))?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty){anim.stop(true)}};return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.easing={linear:function(p){return p},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)&&!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.interval=13;jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}}var rroot=/^(?:body|html)$/i;jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,body,win,clientTop,clientLeft,scrollTop,scrollLeft,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return}if((body=doc.body)===elem){return jQuery.offset.bodyOffset(elem)}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!=="undefined"){box=elem.getBoundingClientRect()}win=getWindow(doc);clientTop=docElem.clientTop||body.clientTop||0;clientLeft=docElem.clientLeft||body.clientLeft||0;scrollTop=win.pageYOffset||docElem.scrollTop;scrollLeft=win.pageXOffset||docElem.scrollLeft;return{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft}};jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(jQuery.support.doesNotIncludeMarginInBodyOffset){top+=parseFloat(jQuery.css(body,"marginTop"))||0;left+=parseFloat(jQuery.css(body,"marginLeft"))||0}return{top:top,left:left}},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");if(position==="static"){elem.style.position="relative"}var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=(options.top-curOffset.top)+curTop}if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft}if("using" in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({position:function(){if(!this[0]){return}var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0;offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0;parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0;parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0;return{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||document.body;while(offsetParent&&(!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||document.body})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?(prop in win)?win[prop]:win.document.documentElement[method]:elem[method]}if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop())}else{elem[method]=val}},method,val,arguments.length,null)}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false}jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,value,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});window.jQuery=window.$=jQuery;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return jQuery})}})(window);(function(window,document,location,setTimeout,decodeURIComponent,encodeURIComponent){var global=this;var channelId=Math.floor(Math.random()*10000);var emptyFn=Function.prototype;var reURI=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/;var reParent=/[\-\w]+\/\.\.\//;var reDoubleSlash=/([^:])\/\//g;var namespace="";var easyXDM={};var _easyXDM=window.easyXDM;var IFRAME_PREFIX="easyXDM_";var HAS_NAME_PROPERTY_BUG;var useHash=false;var flashVersion;var HAS_FLASH_THROTTLED_BUG;function isHostMethod(object,property){var t=typeof object[property];return t=="function"||(!!(t=="object"&&object[property]))||t=="unknown"}function isHostObject(object,property){return !!(typeof(object[property])=="object"&&object[property])}function isArray(o){return Object.prototype.toString.call(o)==="[object Array]"}function hasFlash(){var name="Shockwave Flash",mimeType="application/x-shockwave-flash";if(!undef(navigator.plugins)&&typeof navigator.plugins[name]=="object"){var description=navigator.plugins[name].description;if(description&&!undef(navigator.mimeTypes)&&navigator.mimeTypes[mimeType]&&navigator.mimeTypes[mimeType].enabledPlugin){flashVersion=description.match(/\d+/g)}}if(!flashVersion){var flash;try{flash=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");flashVersion=Array.prototype.slice.call(flash.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1);flash=null}catch(notSupportedException){}}if(!flashVersion){return false}var major=parseInt(flashVersion[0],10),minor=parseInt(flashVersion[1],10);HAS_FLASH_THROTTLED_BUG=major>9&&minor>0;return true}var on,un;if(isHostMethod(window,"addEventListener")){on=function(target,type,listener){target.addEventListener(type,listener,false)};un=function(target,type,listener){target.removeEventListener(type,listener,false)}}else{if(isHostMethod(window,"attachEvent")){on=function(object,sEvent,fpNotify){object.attachEvent("on"+sEvent,fpNotify)};un=function(object,sEvent,fpNotify){object.detachEvent("on"+sEvent,fpNotify)}}else{throw new Error("Browser not supported")}}var domIsReady=false,domReadyQueue=[],readyState;if("readyState" in document){readyState=document.readyState;domIsReady=readyState=="complete"||(~navigator.userAgent.indexOf("AppleWebKit/")&&(readyState=="loaded"||readyState=="interactive"))}else{domIsReady=!!document.body}function dom_onReady(){if(domIsReady){return}domIsReady=true;for(var i=0;i<domReadyQueue.length;i++){domReadyQueue[i]()}domReadyQueue.length=0}if(!domIsReady){if(isHostMethod(window,"addEventListener")){on(document,"DOMContentLoaded",dom_onReady)}else{on(document,"readystatechange",function(){if(document.readyState=="complete"){dom_onReady()}});if(document.documentElement.doScroll&&window===top){var doScrollCheck=function(){if(domIsReady){return}try{document.documentElement.doScroll("left")}catch(e){setTimeout(doScrollCheck,1);return}dom_onReady()};doScrollCheck()}}on(window,"load",dom_onReady)}function whenReady(fn,scope){if(domIsReady){fn.call(scope);return}domReadyQueue.push(function(){fn.call(scope)})}function getParentObject(){var obj=parent;if(namespace!==""){for(var i=0,ii=namespace.split(".");i<ii.length;i++){obj=obj[ii[i]]}}return obj.easyXDM}function noConflict(ns){window.easyXDM=_easyXDM;namespace=ns;if(namespace){IFRAME_PREFIX="easyXDM_"+namespace.replace(".","_")+"_"}return easyXDM}function getDomainName(url){return url.match(reURI)[3]}function getPort(url){return url.match(reURI)[4]||""}function getLocation(url){var m=url.toLowerCase().match(reURI);var proto=m[2],domain=m[3],port=m[4]||"";if((proto=="http:"&&port==":80")||(proto=="https:"&&port==":443")){port=""}return proto+"//"+domain+port}function resolveUrl(url){url=url.replace(reDoubleSlash,"$1/");if(!url.match(/^(http||https):\/\//)){var path=(url.substring(0,1)==="/")?"":location.pathname;if(path.substring(path.length-1)!=="/"){path=path.substring(0,path.lastIndexOf("/")+1)}url=location.protocol+"//"+location.host+path+url}while(reParent.test(url)){url=url.replace(reParent,"")}return url}function appendQueryParameters(url,parameters){var hash="",indexOf=url.indexOf("#");if(indexOf!==-1){hash=url.substring(indexOf);url=url.substring(0,indexOf)}var q=[];for(var key in parameters){if(parameters.hasOwnProperty(key)){q.push(key+"="+encodeURIComponent(parameters[key]))}}return url+(useHash?"#":(url.indexOf("?")==-1?"?":"&"))+q.join("&")+hash}var query=(function(input){input=input.substring(1).split("&");var data={},pair,i=input.length;while(i--){pair=input[i].split("=");data[pair[0]]=decodeURIComponent(pair[1])}return data}(/xdm_e=/.test(location.search)?location.search:location.hash));function undef(v){return typeof v==="undefined"}var getJSON=function(){var cached={};var obj={a:[1,2,3]},json='{"a":[1,2,3]}';if(typeof JSON!="undefined"&&typeof JSON.stringify==="function"&&JSON.stringify(obj).replace((/\s/g),"")===json){return JSON}if(Object.toJSON){if(Object.toJSON(obj).replace((/\s/g),"")===json){cached.stringify=Object.toJSON}}if(typeof String.prototype.evalJSON==="function"){obj=json.evalJSON();if(obj.a&&obj.a.length===3&&obj.a[2]===3){cached.parse=function(str){return str.evalJSON()}}}if(cached.stringify&&cached.parse){getJSON=function(){return cached};return cached}return null};function apply(destination,source,noOverwrite){var member;for(var prop in source){if(source.hasOwnProperty(prop)){if(prop in destination){member=source[prop];if(typeof member==="object"){apply(destination[prop],member,noOverwrite)}else{if(!noOverwrite){destination[prop]=source[prop]}}}else{destination[prop]=source[prop]}}}return destination}function testForNamePropertyBug(){var form=document.body.appendChild(document.createElement("form")),input=form.appendChild(document.createElement("input"));input.name=IFRAME_PREFIX+"TEST"+channelId;HAS_NAME_PROPERTY_BUG=input!==form.elements[input.name];document.body.removeChild(form)}function createFrame(config){if(undef(HAS_NAME_PROPERTY_BUG)){testForNamePropertyBug()}var frame;if(HAS_NAME_PROPERTY_BUG){frame=document.createElement('<iframe name="'+config.props.name+'"/>')}else{frame=document.createElement("IFRAME");frame.name=config.props.name}frame.id=frame.name=frame.title=config.props.name;delete config.props.name;if(typeof config.container=="string"){config.container=document.getElementById(config.container)}if(!config.container){apply(frame.style,{position:"absolute",top:"-2000px",left:"0px"});config.container=document.body}var src=config.props.src;config.props.src="javascript:false";apply(frame,config.props);frame.border=frame.frameBorder=0;frame.allowTransparency=true;config.container.appendChild(frame);if(config.onLoad){on(frame,"load",config.onLoad)}if(config.usePost){var form=config.container.appendChild(document.createElement("form")),input;form.target=frame.name;form.action=src;form.method="POST";if(typeof(config.usePost)==="object"){for(var i in config.usePost){if(config.usePost.hasOwnProperty(i)){if(HAS_NAME_PROPERTY_BUG){input=document.createElement('<input name="'+i+'"/>')}else{input=document.createElement("INPUT");input.name=i}input.value=config.usePost[i];form.appendChild(input)}}}form.submit();form.parentNode.removeChild(form)}else{frame.src=src}config.props.src=src;return frame}function checkAcl(acl,domain){if(typeof acl=="string"){acl=[acl]}var re,i=acl.length;while(i--){re=acl[i];re=new RegExp(re.substr(0,1)=="^"?re:("^"+re.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"));if(re.test(domain)){return true}}return false}function prepareTransportStack(config){var protocol=config.protocol,stackEls;config.isHost=config.isHost||undef(query.xdm_p);useHash=config.hash||false;if(!config.props){config.props={}}if(!config.isHost){config.channel=query.xdm_c.replace(/["'<>\\]/g,"");config.secret=query.xdm_s;config.remote=query.xdm_e.replace(/["'<>\\]/g,"");protocol=query.xdm_p;if(config.acl&&!checkAcl(config.acl,config.remote)){throw new Error("Access denied for "+config.remote)}}else{config.remote=resolveUrl(config.remote);config.channel=config.channel||"default"+channelId++;config.secret=Math.random().toString(16).substring(2);if(undef(protocol)){if(getDomainName(location.href)==getDomainName(config.remote)){protocol="4"}else{if(isHostMethod(window,"postMessage")||isHostMethod(document,"postMessage")){protocol="1"}else{if(config.swf&&isHostMethod(window,"ActiveXObject")&&hasFlash()){protocol="6"}else{if(navigator.product==="Gecko"&&"frameElement" in window&&navigator.userAgent.indexOf("WebKit")==-1){protocol="5"}else{if(config.remoteHelper){protocol="2"}else{protocol="0"}}}}}}}config.protocol=protocol;switch(protocol){case"0":apply(config,{interval:100,delay:2000,useResize:true,useParent:false,usePolling:false},true);if(config.isHost){if(!config.local){var domain=location.protocol+"//"+location.host,images=document.body.getElementsByTagName("img"),image;var i=images.length;while(i--){image=images[i];if(image.src.substring(0,domain.length)===domain){config.local=image.src;break}}if(!config.local){config.local=window}}var parameters={xdm_c:config.channel,xdm_p:0};if(config.local===window){config.usePolling=true;config.useParent=true;config.local=location.protocol+"//"+location.host+location.pathname+location.search;parameters.xdm_e=config.local;parameters.xdm_pa=1}else{parameters.xdm_e=resolveUrl(config.local)}if(config.container){config.useResize=false;parameters.xdm_po=1}config.remote=appendQueryParameters(config.remote,parameters)}else{apply(config,{useParent:!undef(query.xdm_pa),usePolling:!undef(query.xdm_po),useResize:config.useParent?false:config.useResize})}stackEls=[new easyXDM.stack.HashTransport(config),new easyXDM.stack.ReliableBehavior({}),new easyXDM.stack.QueueBehavior({encode:true,maxLength:4000-config.remote.length}),new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"1":stackEls=[new easyXDM.stack.PostMessageTransport(config)];break;case"2":if(config.isHost){config.remoteHelper=resolveUrl(config.remoteHelper)}stackEls=[new easyXDM.stack.NameTransport(config),new easyXDM.stack.QueueBehavior(),new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"3":stackEls=[new easyXDM.stack.NixTransport(config)];break;case"4":stackEls=[new easyXDM.stack.SameOriginTransport(config)];break;case"5":stackEls=[new easyXDM.stack.FrameElementTransport(config)];break;case"6":if(!flashVersion){hasFlash()}stackEls=[new easyXDM.stack.FlashTransport(config)];break}stackEls.push(new easyXDM.stack.QueueBehavior({lazy:config.lazy,remove:true}));return stackEls}function chainStack(stackElements){var stackEl,defaults={incoming:function(message,origin){this.up.incoming(message,origin)},outgoing:function(message,recipient){this.down.outgoing(message,recipient)},callback:function(success){this.up.callback(success)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var i=0,len=stackElements.length;i<len;i++){stackEl=stackElements[i];apply(stackEl,defaults,true);if(i!==0){stackEl.down=stackElements[i-1]}if(i!==len-1){stackEl.up=stackElements[i+1]}}return stackEl}function removeFromStack(element){element.up.down=element.down;element.down.up=element.up;element.up=element.down=null}apply(easyXDM,{version:"2.4.20.7",query:query,stack:{},apply:apply,getJSONObject:getJSON,whenReady:whenReady,noConflict:noConflict});easyXDM.DomHelper={on:on,un:un,requiresJSON:function(path){if(!isHostObject(window,"JSON")){document.write('<script type="text/javascript" src="'+path+'"><\/script>')}}};(function(){var _map={};easyXDM.Fn={set:function(name,fn){_map[name]=fn},get:function(name,del){if(!_map.hasOwnProperty(name)){return}var fn=_map[name];if(del){delete _map[name]}return fn}}}());easyXDM.Socket=function(config){var stack=chainStack(prepareTransportStack(config).concat([{incoming:function(message,origin){config.onMessage(message,origin)},callback:function(success){if(config.onReady){config.onReady(success)}}}])),recipient=getLocation(config.remote);this.origin=getLocation(config.remote);this.destroy=function(){stack.destroy()};this.postMessage=function(message){stack.outgoing(message,recipient)};stack.init()};easyXDM.Rpc=function(config,jsonRpcConfig){if(jsonRpcConfig.local){for(var method in jsonRpcConfig.local){if(jsonRpcConfig.local.hasOwnProperty(method)){var member=jsonRpcConfig.local[method];if(typeof member==="function"){jsonRpcConfig.local[method]={method:member}}}}}var stack=chainStack(prepareTransportStack(config).concat([new easyXDM.stack.RpcBehavior(this,jsonRpcConfig),{callback:function(success){if(config.onReady){config.onReady(success)}}}]));this.origin=getLocation(config.remote);this.destroy=function(){stack.destroy()};stack.init()};easyXDM.stack.SameOriginTransport=function(config){var pub,frame,send,targetOrigin;return(pub={outgoing:function(message,domain,fn){send(message);if(fn){fn()}},destroy:function(){if(frame){frame.parentNode.removeChild(frame);frame=null}},onDOMReady:function(){targetOrigin=getLocation(config.remote);if(config.isHost){apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:location.protocol+"//"+location.host+location.pathname,xdm_c:config.channel,xdm_p:4}),name:IFRAME_PREFIX+config.channel+"_provider"});frame=createFrame(config);easyXDM.Fn.set(config.channel,function(sendFn){send=sendFn;setTimeout(function(){pub.up.callback(true)},0);return function(msg){pub.up.incoming(msg,targetOrigin)}})}else{send=getParentObject().Fn.get(config.channel,true)(function(msg){pub.up.incoming(msg,targetOrigin)});setTimeout(function(){pub.up.callback(true)},0)}},init:function(){whenReady(pub.onDOMReady,pub)}})};easyXDM.stack.FlashTransport=function(config){var pub,frame,send,targetOrigin,swf,swfContainer;function onMessage(message,origin){setTimeout(function(){pub.up.incoming(message,targetOrigin)},0)}function addSwf(domain){var url=config.swf+"?host="+config.isHost;var id="easyXDM_swf_"+Math.floor(Math.random()*10000);easyXDM.Fn.set("flash_loaded"+domain.replace(/[\-.]/g,"_"),function(){easyXDM.stack.FlashTransport[domain].swf=swf=swfContainer.firstChild;var queue=easyXDM.stack.FlashTransport[domain].queue;for(var i=0;i<queue.length;i++){queue[i]()}queue.length=0});if(config.swfContainer){swfContainer=(typeof config.swfContainer=="string")?document.getElementById(config.swfContainer):config.swfContainer}else{swfContainer=document.createElement("div");apply(swfContainer.style,HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0});document.body.appendChild(swfContainer)}var flashVars="callback=flash_loaded"+encodeURIComponent(domain.replace(/[\-.]/g,"_"))+"&proto="+global.location.protocol+"&domain="+encodeURIComponent(getDomainName(global.location.href))+"&port="+encodeURIComponent(getPort(global.location.href))+"&ns="+encodeURIComponent(namespace);swfContainer.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+id+"' data='"+url+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+url+"'></param><param name='flashvars' value='"+flashVars+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+flashVars+"' allowScriptAccess='always' wmode='transparent' src='"+url+"' height='1' width='1'></embed></object>"}return(pub={outgoing:function(message,domain,fn){swf.postMessage(config.channel,message.toString());if(fn){fn()}},destroy:function(){try{swf.destroyChannel(config.channel)}catch(e){}swf=null;if(frame){frame.parentNode.removeChild(frame);frame=null}},onDOMReady:function(){targetOrigin=config.remote;easyXDM.Fn.set("flash_"+config.channel+"_init",function(){setTimeout(function(){pub.up.callback(true)})});easyXDM.Fn.set("flash_"+config.channel+"_onMessage",onMessage);config.swf=resolveUrl(config.swf);var swfdomain=getDomainName(config.swf);var fn=function(){easyXDM.stack.FlashTransport[swfdomain].init=true;swf=easyXDM.stack.FlashTransport[swfdomain].swf;swf.createChannel(config.channel,config.secret,getLocation(config.remote),config.isHost);if(config.isHost){if(HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle){apply(config.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"})}apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:6,xdm_s:config.secret}),name:IFRAME_PREFIX+config.channel+"_provider"});frame=createFrame(config)}};if(easyXDM.stack.FlashTransport[swfdomain]&&easyXDM.stack.FlashTransport[swfdomain].init){fn()}else{if(!easyXDM.stack.FlashTransport[swfdomain]){easyXDM.stack.FlashTransport[swfdomain]={queue:[fn]};addSwf(swfdomain)}else{easyXDM.stack.FlashTransport[swfdomain].queue.push(fn)}}},init:function(){whenReady(pub.onDOMReady,pub)}})};easyXDM.stack.PostMessageTransport=function(config){var pub,frame,callerWindow,targetOrigin;function _getOrigin(event){if(event.origin){return getLocation(event.origin)}if(event.uri){return getLocation(event.uri)}if(event.domain){return location.protocol+"//"+event.domain}throw"Unable to retrieve the origin of the event"}function _window_onMessage(event){if(typeof event.data!=="string"){return}var origin=_getOrigin(event);if(origin==targetOrigin&&event.data.substring(0,config.channel.length+1)==config.channel+" "){pub.up.incoming(event.data.substring(config.channel.length+1),origin)}}function _window_waitForReady(event){if(event.data==config.channel+"-ready"){callerWindow=("postMessage" in frame.contentWindow)?frame.contentWindow:frame.contentWindow.document;un(window,"message",_window_waitForReady);on(window,"message",_window_onMessage);setTimeout(function(){pub.up.callback(true)},0)}}return(pub={outgoing:function(message,domain,fn){callerWindow.postMessage(config.channel+" "+message,domain||targetOrigin);if(fn){fn()}},destroy:function(){un(window,"message",_window_waitForReady);un(window,"message",_window_onMessage);if(frame){callerWindow=null;frame.parentNode.removeChild(frame);frame=null}},onDOMReady:function(){targetOrigin=getLocation(config.remote);if(config.isHost){on(window,"message",_window_waitForReady);apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:1}),name:IFRAME_PREFIX+config.channel+"_provider"});frame=createFrame(config)}else{on(window,"message",_window_onMessage);callerWindow=("postMessage" in window.parent)?window.parent:window.parent.document;callerWindow.postMessage(config.channel+"-ready",targetOrigin);setTimeout(function(){pub.up.callback(true)},0)}},init:function(){whenReady(pub.onDOMReady,pub)}})};easyXDM.stack.FrameElementTransport=function(config){var pub,frame,send,targetOrigin;return(pub={outgoing:function(message,domain,fn){send.call(this,message);if(fn){fn()}},destroy:function(){if(frame){frame.parentNode.removeChild(frame);frame=null}},onDOMReady:function(){targetOrigin=getLocation(config.remote);if(config.isHost){apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:5}),name:IFRAME_PREFIX+config.channel+"_provider"});frame=createFrame(config);frame.fn=function(sendFn){delete frame.fn;send=sendFn;setTimeout(function(){pub.up.callback(true)},0);return function(msg){pub.up.incoming(msg,targetOrigin)}}}else{if(document.referrer&&getLocation(document.referrer)!=query.xdm_e){window.top.location=query.xdm_e}send=window.frameElement.fn(function(msg){pub.up.incoming(msg,targetOrigin)});pub.up.callback(true)}},init:function(){whenReady(pub.onDOMReady,pub)}})};easyXDM.stack.NameTransport=function(config){var pub;var isHost,callerWindow,remoteWindow,readyCount,callback,remoteOrigin,remoteUrl;function _sendMessage(message){var url=config.remoteHelper+(isHost?"#_3":"#_2")+config.channel;callerWindow.contentWindow.sendMessage(message,url)}function _onReady(){if(isHost){if(++readyCount===2||!isHost){pub.up.callback(true)}}else{_sendMessage("ready");pub.up.callback(true)}}function _onMessage(message){pub.up.incoming(message,remoteOrigin)}function _onLoad(){if(callback){setTimeout(function(){callback(true)},0)}}return(pub={outgoing:function(message,domain,fn){callback=fn;_sendMessage(message)},destroy:function(){callerWindow.parentNode.removeChild(callerWindow);callerWindow=null;if(isHost){remoteWindow.parentNode.removeChild(remoteWindow);remoteWindow=null}},onDOMReady:function(){isHost=config.isHost;readyCount=0;remoteOrigin=getLocation(config.remote);config.local=resolveUrl(config.local);if(isHost){easyXDM.Fn.set(config.channel,function(message){if(isHost&&message==="ready"){easyXDM.Fn.set(config.channel,_onMessage);_onReady()}});remoteUrl=appendQueryParameters(config.remote,{xdm_e:config.local,xdm_c:config.channel,xdm_p:2});apply(config.props,{src:remoteUrl+"#"+config.channel,name:IFRAME_PREFIX+config.channel+"_provider"});remoteWindow=createFrame(config)}else{config.remoteHelper=config.remote;easyXDM.Fn.set(config.channel,_onMessage)}var onLoad=function(){var w=callerWindow||this;un(w,"load",onLoad);easyXDM.Fn.set(config.channel+"_load",_onLoad);(function test(){if(typeof w.contentWindow.sendMessage=="function"){_onReady()}else{setTimeout(test,50)}}())};callerWindow=createFrame({props:{src:config.local+"#_4"+config.channel},onLoad:onLoad})},init:function(){whenReady(pub.onDOMReady,pub)}})};easyXDM.stack.HashTransport=function(config){var pub;var me=this,isHost,_timer,pollInterval,_lastMsg,_msgNr,_listenerWindow,_callerWindow;var useParent,_remoteOrigin;function _sendMessage(message){if(!_callerWindow){return}var url=config.remote+"#"+(_msgNr++)+"_"+message;((isHost||!useParent)?_callerWindow.contentWindow:_callerWindow).location=url}function _handleHash(hash){_lastMsg=hash;pub.up.incoming(_lastMsg.substring(_lastMsg.indexOf("_")+1),_remoteOrigin)}function _pollHash(){if(!_listenerWindow){return}var href=_listenerWindow.location.href,hash="",indexOf=href.indexOf("#");if(indexOf!=-1){hash=href.substring(indexOf)}if(hash&&hash!=_lastMsg){_handleHash(hash)}}function _attachListeners(){_timer=setInterval(_pollHash,pollInterval)}return(pub={outgoing:function(message,domain){_sendMessage(message)},destroy:function(){window.clearInterval(_timer);if(isHost||!useParent){_callerWindow.parentNode.removeChild(_callerWindow)}_callerWindow=null},onDOMReady:function(){isHost=config.isHost;pollInterval=config.interval;_lastMsg="#"+config.channel;_msgNr=0;useParent=config.useParent;_remoteOrigin=getLocation(config.remote);if(isHost){apply(config.props,{src:config.remote,name:IFRAME_PREFIX+config.channel+"_provider"});if(useParent){config.onLoad=function(){_listenerWindow=window;_attachListeners();pub.up.callback(true)}}else{var tries=0,max=config.delay/50;(function getRef(){if(++tries>max){throw new Error("Unable to reference listenerwindow")}try{_listenerWindow=_callerWindow.contentWindow.frames[IFRAME_PREFIX+config.channel+"_consumer"]}catch(ex){}if(_listenerWindow){_attachListeners();pub.up.callback(true)}else{setTimeout(getRef,50)}}())}_callerWindow=createFrame(config)}else{_listenerWindow=window;_attachListeners();if(useParent){_callerWindow=parent;pub.up.callback(true)}else{apply(config,{props:{src:config.remote+"#"+config.channel+new Date(),name:IFRAME_PREFIX+config.channel+"_consumer"},onLoad:function(){pub.up.callback(true)}});_callerWindow=createFrame(config)}}},init:function(){whenReady(pub.onDOMReady,pub)}})};easyXDM.stack.ReliableBehavior=function(config){var pub,callback;var idOut=0,idIn=0,currentMessage="";return(pub={incoming:function(message,origin){var indexOf=message.indexOf("_"),ack=message.substring(0,indexOf).split(",");message=message.substring(indexOf+1);if(ack[0]==idOut){currentMessage="";if(callback){callback(true)}}if(message.length>0){pub.down.outgoing(ack[1]+","+idOut+"_"+currentMessage,origin);if(idIn!=ack[1]){idIn=ack[1];pub.up.incoming(message,origin)}}},outgoing:function(message,origin,fn){currentMessage=message;callback=fn;pub.down.outgoing(idIn+","+(++idOut)+"_"+message,origin)}})};easyXDM.stack.QueueBehavior=function(config){var pub,queue=[],waiting=true,incoming="",destroying,maxLength=0,lazy=false,doFragment=false;function dispatch(){if(config.remove&&queue.length===0){removeFromStack(pub);return}if(waiting||queue.length===0||destroying){return}waiting=true;var message=queue.shift();pub.down.outgoing(message.data,message.origin,function(success){waiting=false;if(message.callback){setTimeout(function(){message.callback(success)},0)}dispatch()})}return(pub={init:function(){if(undef(config)){config={}}if(config.maxLength){maxLength=config.maxLength;doFragment=true}if(config.lazy){lazy=true}else{pub.down.init()}},callback:function(success){waiting=false;var up=pub.up;dispatch();up.callback(success)},incoming:function(message,origin){if(doFragment){var indexOf=message.indexOf("_"),seq=parseInt(message.substring(0,indexOf),10);incoming+=message.substring(indexOf+1);if(seq===0){if(config.encode){incoming=decodeURIComponent(incoming)}pub.up.incoming(incoming,origin);incoming=""}}else{pub.up.incoming(message,origin)}},outgoing:function(message,origin,fn){if(config.encode){message=encodeURIComponent(message)}var fragments=[],fragment;if(doFragment){while(message.length!==0){fragment=message.substring(0,maxLength);message=message.substring(fragment.length);fragments.push(fragment)}while((fragment=fragments.shift())){queue.push({data:fragments.length+"_"+fragment,origin:origin,callback:fragments.length===0?fn:null})}}else{queue.push({data:message,origin:origin,callback:fn})}if(lazy){pub.down.init()}else{dispatch()}},destroy:function(){destroying=true;pub.down.destroy()}})};easyXDM.stack.VerifyBehavior=function(config){var pub,mySecret,theirSecret,verified=false;function startVerification(){mySecret=Math.random().toString(16).substring(2);pub.down.outgoing(mySecret)}return(pub={incoming:function(message,origin){var indexOf=message.indexOf("_");if(indexOf===-1){if(message===mySecret){pub.up.callback(true)}else{if(!theirSecret){theirSecret=message;if(!config.initiate){startVerification()}pub.down.outgoing(message)}}}else{if(message.substring(0,indexOf)===theirSecret){pub.up.incoming(message.substring(indexOf+1),origin)}}},outgoing:function(message,origin,fn){pub.down.outgoing(mySecret+"_"+message,origin,fn)},callback:function(success){if(config.initiate){startVerification()}}})};easyXDM.stack.RpcBehavior=function(proxy,config){var pub,serializer=config.serializer||getJSON();var _callbackCounter=0,_callbacks={};function _send(data){data.jsonrpc="2.0";pub.down.outgoing(serializer.stringify(data))}function _createMethod(definition,method){var slice=Array.prototype.slice;return function(){var l=arguments.length,callback,message={method:method};if(l>0&&typeof arguments[l-1]==="function"){if(l>1&&typeof arguments[l-2]==="function"){callback={success:arguments[l-2],error:arguments[l-1]};message.params=slice.call(arguments,0,l-2)}else{callback={success:arguments[l-1]};message.params=slice.call(arguments,0,l-1)}_callbacks[""+(++_callbackCounter)]=callback;message.id=_callbackCounter}else{message.params=slice.call(arguments,0)}if(definition.namedParams&&message.params.length===1){message.params=message.params[0]}_send(message)}}function _executeMethod(method,id,fn,params){if(!fn){if(id){_send({id:id,error:{code:-32601,message:"Procedure not found."}})}return}var success,error;if(id){success=function(result){success=emptyFn;_send({id:id,result:result})};error=function(message,data){error=emptyFn;var msg={id:id,error:{code:-32099,message:message}};if(data){msg.error.data=data}_send(msg)}}else{success=error=emptyFn}if(!isArray(params)){params=[params]}try{var result=fn.method.apply(fn.scope,params.concat([success,error]));if(!undef(result)){success(result)}}catch(ex1){error(ex1.message)}}return(pub={incoming:function(message,origin){var data=serializer.parse(message);if(data.method){if(config.handle){config.handle(data,_send)}else{_executeMethod(data.method,data.id,config.local[data.method],data.params)}}else{var callback=_callbacks[data.id];if(data.error){if(callback.error){callback.error(data.error)}}else{if(callback.success){callback.success(data.result)}}delete _callbacks[data.id]}},init:function(){if(config.remote){for(var method in config.remote){if(config.remote.hasOwnProperty(method)){proxy[method]=_createMethod(config.remote[method],method)}}}pub.down.init()},destroy:function(){for(var method in config.remote){if(config.remote.hasOwnProperty(method)&&proxy.hasOwnProperty(method)){delete proxy[method]}}pub.down.destroy()}})};global.easyXDM=easyXDM})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);
/*! strophe.js v1.2.2 - built on 20-06-2015 */
;!function(a){return function(a,b){"function"==typeof define&&define.amd?define("strophe-base64",function(){return b()}):a.Base64=b()}(this,function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b={encode:function(b){var c,d,e,f,g,h,i,j="",k=0;do{c=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?(g=(3&c)<<4,h=i=64):isNaN(e)&&(i=64),j=j+a.charAt(f)+a.charAt(g)+a.charAt(h)+a.charAt(i)}while(k<b.length);return j},decode:function(b){var c,d,e,f,g,h,i,j="",k=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),h=a.indexOf(b.charAt(k++)),i=a.indexOf(b.charAt(k++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(c),64!=h&&(j+=String.fromCharCode(d)),64!=i&&(j+=String.fromCharCode(e))}while(k<b.length);return j}};return b}),function(a,b){"function"==typeof define&&define.amd?define("strophe-sha1",function(){return b()}):a.SHA1=b()}(this,function(){function a(a,d){a[d>>5]|=128<<24-d%32,a[(d+64>>9<<4)+15]=d;var g,h,i,j,k,l,m,n,o=new Array(80),p=1732584193,q=-271733879,r=-1732584194,s=271733878,t=-1009589776;for(g=0;g<a.length;g+=16){for(j=p,k=q,l=r,m=s,n=t,h=0;80>h;h++){16>h?o[h]=a[g+h]:o[h]=f(o[h-3]^o[h-8]^o[h-14]^o[h-16],1),i=e(e(f(p,5),b(h,q,r,s)),e(e(t,o[h]),c(h))),t=s,s=r,r=f(q,30),q=p,p=i}p=e(p,j),q=e(q,k),r=e(r,l),s=e(s,m),t=e(t,n)}return[p,q,r,s,t]}function b(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function c(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function d(b,c){var d=g(b);d.length>16&&(d=a(d,8*b.length));for(var e=new Array(16),f=new Array(16),h=0;16>h;h++){e[h]=909522486^d[h],f[h]=1549556828^d[h]}var i=a(e.concat(g(c)),512+8*c.length);return a(f.concat(i),672)}function e(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function f(a,b){return a<<b|a>>>32-b}function g(a){for(var b=[],c=255,d=0;d<8*a.length;d+=8){b[d>>5]|=(a.charCodeAt(d/8)&c)<<24-d%32}return b}function h(a){for(var b="",c=255,d=0;d<32*a.length;d+=8){b+=String.fromCharCode(a[d>>5]>>>24-d%32&c)}return b}function i(a){for(var b,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e="",f=0;f<4*a.length;f+=3){for(b=(a[f>>2]>>8*(3-f%4)&255)<<16|(a[f+1>>2]>>8*(3-(f+1)%4)&255)<<8|a[f+2>>2]>>8*(3-(f+2)%4)&255,c=0;4>c;c++){e+=8*f+6*c>32*a.length?"=":d.charAt(b>>6*(3-c)&63)}}return e}return{b64_hmac_sha1:function(a,b){return i(d(a,b))},b64_sha1:function(b){return i(a(g(b),8*b.length))},binb2str:h,core_hmac_sha1:d,str_hmac_sha1:function(a,b){return h(d(a,b))},str_sha1:function(b){return h(a(g(b),8*b.length))}}}),function(a,b){"function"==typeof define&&define.amd?define("strophe-md5",function(){return b()}):a.MD5=b()}(this,function(a){var b=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},c=function(a,b){return a<<b|a>>>32-b},d=function(a){for(var b=[],c=0;c<8*a.length;c+=8){b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32}return b},e=function(a){for(var b="",c=0;c<32*a.length;c+=8){b+=String.fromCharCode(a[c>>5]>>>c%32&255)}return b},f=function(a){for(var b="0123456789abcdef",c="",d=0;d<4*a.length;d++){c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15)}return c},g=function(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)},h=function(a,b,c,d,e,f,h){return g(b&c|~b&d,a,b,e,f,h)},i=function(a,b,c,d,e,f,h){return g(b&d|c&~d,a,b,e,f,h)},j=function(a,b,c,d,e,f,h){return g(b^c^d,a,b,e,f,h)},k=function(a,b,c,d,e,f,h){return g(c^(b|~d),a,b,e,f,h)},l=function(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;for(var d,e,f,g,l=1732584193,m=-271733879,n=-1732584194,o=271733878,p=0;p<a.length;p+=16){d=l,e=m,f=n,g=o,l=h(l,m,n,o,a[p+0],7,-680876936),o=h(o,l,m,n,a[p+1],12,-389564586),n=h(n,o,l,m,a[p+2],17,606105819),m=h(m,n,o,l,a[p+3],22,-1044525330),l=h(l,m,n,o,a[p+4],7,-176418897),o=h(o,l,m,n,a[p+5],12,1200080426),n=h(n,o,l,m,a[p+6],17,-1473231341),m=h(m,n,o,l,a[p+7],22,-45705983),l=h(l,m,n,o,a[p+8],7,1770035416),o=h(o,l,m,n,a[p+9],12,-1958414417),n=h(n,o,l,m,a[p+10],17,-42063),m=h(m,n,o,l,a[p+11],22,-1990404162),l=h(l,m,n,o,a[p+12],7,1804603682),o=h(o,l,m,n,a[p+13],12,-40341101),n=h(n,o,l,m,a[p+14],17,-1502002290),m=h(m,n,o,l,a[p+15],22,1236535329),l=i(l,m,n,o,a[p+1],5,-165796510),o=i(o,l,m,n,a[p+6],9,-1069501632),n=i(n,o,l,m,a[p+11],14,643717713),m=i(m,n,o,l,a[p+0],20,-373897302),l=i(l,m,n,o,a[p+5],5,-701558691),o=i(o,l,m,n,a[p+10],9,38016083),n=i(n,o,l,m,a[p+15],14,-660478335),m=i(m,n,o,l,a[p+4],20,-405537848),l=i(l,m,n,o,a[p+9],5,568446438),o=i(o,l,m,n,a[p+14],9,-1019803690),n=i(n,o,l,m,a[p+3],14,-187363961),m=i(m,n,o,l,a[p+8],20,1163531501),l=i(l,m,n,o,a[p+13],5,-1444681467),o=i(o,l,m,n,a[p+2],9,-51403784),n=i(n,o,l,m,a[p+7],14,1735328473),m=i(m,n,o,l,a[p+12],20,-1926607734),l=j(l,m,n,o,a[p+5],4,-378558),o=j(o,l,m,n,a[p+8],11,-2022574463),n=j(n,o,l,m,a[p+11],16,1839030562),m=j(m,n,o,l,a[p+14],23,-35309556),l=j(l,m,n,o,a[p+1],4,-1530992060),o=j(o,l,m,n,a[p+4],11,1272893353),n=j(n,o,l,m,a[p+7],16,-155497632),m=j(m,n,o,l,a[p+10],23,-1094730640),l=j(l,m,n,o,a[p+13],4,681279174),o=j(o,l,m,n,a[p+0],11,-358537222),n=j(n,o,l,m,a[p+3],16,-722521979),m=j(m,n,o,l,a[p+6],23,76029189),l=j(l,m,n,o,a[p+9],4,-640364487),o=j(o,l,m,n,a[p+12],11,-421815835),n=j(n,o,l,m,a[p+15],16,530742520),m=j(m,n,o,l,a[p+2],23,-995338651),l=k(l,m,n,o,a[p+0],6,-198630844),o=k(o,l,m,n,a[p+7],10,1126891415),n=k(n,o,l,m,a[p+14],15,-1416354905),m=k(m,n,o,l,a[p+5],21,-57434055),l=k(l,m,n,o,a[p+12],6,1700485571),o=k(o,l,m,n,a[p+3],10,-1894986606),n=k(n,o,l,m,a[p+10],15,-1051523),m=k(m,n,o,l,a[p+1],21,-2054922799),l=k(l,m,n,o,a[p+8],6,1873313359),o=k(o,l,m,n,a[p+15],10,-30611744),n=k(n,o,l,m,a[p+6],15,-1560198380),m=k(m,n,o,l,a[p+13],21,1309151649),l=k(l,m,n,o,a[p+4],6,-145523070),o=k(o,l,m,n,a[p+11],10,-1120210379),n=k(n,o,l,m,a[p+2],15,718787259),m=k(m,n,o,l,a[p+9],21,-343485551),l=b(l,d),m=b(m,e),n=b(n,f),o=b(o,g)}return[l,m,n,o]},m={hexdigest:function(a){return f(l(d(a),8*a.length))},hash:function(a){return e(l(d(a),8*a.length))}};return m}),Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=Array.prototype.concat,e=c.call(arguments,1);return function(){return b.apply(a?a:this,d.call(e,c.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++){if(c in this&&this[c]===a){return c}}return -1}),function(a,b){if("function"==typeof define&&define.amd){define("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-polyfill"],function(){return b.apply(this,arguments)})}else{var c=b(a.SHA1,a.Base64,a.MD5);window.Strophe=c.Strophe,window.$build=c.$build,window.$iq=c.$iq,window.$msg=c.$msg,window.$pres=c.$pres,window.SHA1=c.SHA1,window.Base64=c.Base64,window.MD5=c.MD5,window.b64_hmac_sha1=c.SHA1.b64_hmac_sha1,window.b64_sha1=c.SHA1.b64_sha1,window.str_hmac_sha1=c.SHA1.str_hmac_sha1,window.str_sha1=c.SHA1.str_sha1}}(this,function(a,b,c){function d(a,b){return new h.Builder(a,b)}function e(a){return new h.Builder("message",a)}function f(a){return new h.Builder("iq",a)}function g(a){return new h.Builder("presence",a)}var h;return h={VERSION:"1.2.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(a){for(var b=0;b<h.XHTML.tags.length;b++){if(a==h.XHTML.tags[b]){return !0}}return !1},validAttribute:function(a,b){if("undefined"!=typeof h.XHTML.attributes[a]&&h.XHTML.attributes[a].length>0){for(var c=0;c<h.XHTML.attributes[a].length;c++){if(b==h.XHTML.attributes[a][c]){return !0}}}return !1},validCSS:function(a){for(var b=0;b<h.XHTML.css.length;b++){if(a==h.XHTML.css[b]){return !0}}return !1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,addNamespace:function(a,b){h.NS[a]=b},forEachChild:function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){e=a.childNodes[d],e.nodeType!=h.ElementType.NORMAL||b&&!this.isTagEqual(e,b)||c(e)}},isTagEqual:function(a,b){return a.tagName==b},_xmlGenerator:null,_makeGenerator:function(){var a;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(a=this._getIEXmlDom(),a.appendChild(a.createElement("strophe"))):a=document.implementation.createDocument("jabber:client","strophe",null),a},xmlGenerator:function(){return h._xmlGenerator||(h._xmlGenerator=h._makeGenerator()),h._xmlGenerator},_getIEXmlDom:function(){for(var a=null,b=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],c=0;c<b.length&&null===a;c++){try{a=new ActiveXObject(b[c])}catch(d){a=null}}return a},xmlElement:function(a){if(!a){return null}var b,c,d,e=h.xmlGenerator().createElement(a);for(b=1;b<arguments.length;b++){var f=arguments[b];if(f){if("string"==typeof f||"number"==typeof f){e.appendChild(h.xmlTextNode(f))}else{if("object"==typeof f&&"function"==typeof f.sort){for(c=0;c<f.length;c++){var g=f[c];"object"==typeof g&&"function"==typeof g.sort&&void 0!==g[1]&&e.setAttribute(g[0],g[1])}}else{if("object"==typeof f){for(d in f){f.hasOwnProperty(d)&&void 0!==f[d]&&e.setAttribute(d,f[d])}}}}}}return e},xmlescape:function(a){return a=a.replace(/\&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/"/g,"&quot;")},xmlunescape:function(a){return a=a.replace(/\&amp;/g,"&"),a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">"),a=a.replace(/&apos;/g,"'"),a=a.replace(/&quot;/g,'"')},xmlTextNode:function(a){return h.xmlGenerator().createTextNode(a)},xmlHtmlNode:function(a){var b;if(window.DOMParser){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else{b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)}return b},getText:function(a){if(!a){return null}var b="";0===a.childNodes.length&&a.nodeType==h.ElementType.TEXT&&(b+=a.nodeValue);for(var c=0;c<a.childNodes.length;c++){a.childNodes[c].nodeType==h.ElementType.TEXT&&(b+=a.childNodes[c].nodeValue)}return h.xmlescape(b)},copyElement:function(a){var b,c;if(a.nodeType==h.ElementType.NORMAL){for(c=h.xmlElement(a.tagName),b=0;b<a.attributes.length;b++){c.setAttribute(a.attributes[b].nodeName,a.attributes[b].value)}for(b=0;b<a.childNodes.length;b++){c.appendChild(h.copyElement(a.childNodes[b]))}}else{a.nodeType==h.ElementType.TEXT&&(c=h.xmlGenerator().createTextNode(a.nodeValue))}return c},createHtml:function(a){var b,c,d,e,f,g,i,j,k,l,m;if(a.nodeType==h.ElementType.NORMAL){if(e=a.nodeName.toLowerCase(),h.XHTML.validTag(e)){try{for(c=h.xmlElement(e),b=0;b<h.XHTML.attributes[e].length;b++){if(f=h.XHTML.attributes[e][b],g=a.getAttribute(f),"undefined"!=typeof g&&null!==g&&""!==g&&g!==!1&&0!==g){if("style"==f&&"object"==typeof g&&"undefined"!=typeof g.cssText&&(g=g.cssText),"style"==f){for(i=[],j=g.split(";"),d=0;d<j.length;d++){k=j[d].split(":"),l=k[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),h.XHTML.validCSS(l)&&(m=k[1].replace(/^\s*/,"").replace(/\s*$/,""),i.push(l+": "+m))}i.length>0&&(g=i.join("; "),c.setAttribute(f,g))}else{c.setAttribute(f,g)}}}for(b=0;b<a.childNodes.length;b++){c.appendChild(h.createHtml(a.childNodes[b]))}}catch(n){c=h.xmlTextNode("")}}else{for(c=h.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++){c.appendChild(h.createHtml(a.childNodes[b]))}}}else{if(a.nodeType==h.ElementType.FRAGMENT){for(c=h.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++){c.appendChild(h.createHtml(a.childNodes[b]))}}else{a.nodeType==h.ElementType.TEXT&&(c=h.xmlTextNode(a.nodeValue))}}return c},escapeNode:function(a){return"string"!=typeof a?a:a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return"string"!=typeof a?a:a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return a.indexOf("@")<0?null:a.split("@")[0]},getDomainFromJid:function(a){var b=h.getBareJidFromJid(a);if(b.indexOf("@")<0){return b}var c=b.split("@");return c.splice(0,1),c.join("@")},getResourceFromJid:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),b.join("/"))},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(a,b){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a){return null}"function"==typeof a.tree&&(a=a.tree());var c,d,e=a.nodeName;for(a.getAttribute("_realname")&&(e=a.getAttribute("_realname")),b="<"+e,c=0;c<a.attributes.length;c++){"_realname"!=a.attributes[c].nodeName&&(b+=" "+a.attributes[c].nodeName+"='"+a.attributes[c].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'")}if(a.childNodes.length>0){for(b+=">",c=0;c<a.childNodes.length;c++){switch(d=a.childNodes[c],d.nodeType){case h.ElementType.NORMAL:b+=h.serialize(d);break;case h.ElementType.TEXT:b+=h.xmlescape(d.nodeValue);break;case h.ElementType.CDATA:b+="<![CDATA["+d.nodeValue+"]]>"}}b+="</"+e+">"}else{b+="/>"}return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){h._connectionPlugins[a]=b}},h.Builder=function(a,b){("presence"==a||"message"==a||"iq"==a)&&(b&&!b.xmlns?b.xmlns=h.NS.CLIENT:b||(b={xmlns:h.NS.CLIENT})),this.nodeTree=h.xmlElement(a,b),this.node=this.nodeTree},h.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return h.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(a){for(var b in a){a.hasOwnProperty(b)&&(void 0===a[b]?this.node.removeAttribute(b):this.node.setAttribute(b,a[b]))}return this},c:function(a,b,c){var d=h.xmlElement(a,b,c);return this.node.appendChild(d),"string"!=typeof c&&(this.node=d),this},cnode:function(a){var b,c=h.xmlGenerator();try{b=void 0!==c.importNode}catch(d){b=!1}var e=b?c.importNode(a,!0):h.copyElement(a);return this.node.appendChild(e),this.node=e,this},t:function(a){var b=h.xmlTextNode(a);return this.node.appendChild(b),this},h:function(a){var b=document.createElement("body");b.innerHTML=a;for(var c=h.createHtml(b);c.childNodes.length>0;){this.node.appendChild(c.childNodes[0])}return this}},h.Handler=function(a,b,c,d,e,f,g){this.handler=a,this.ns=b,this.name=c,this.type=d,this.id=e,this.options=g||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=f?h.getBareJidFromJid(f):null:this.from=f,this.user=!0},h.Handler.prototype={isMatch:function(a){var b,c=null;if(c=this.options.matchBare?h.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from"),b=!1,this.ns){var d=this;h.forEachChild(a,null,function(a){a.getAttribute("xmlns")==d.ns&&(b=!0)}),b=b||a.getAttribute("xmlns")==this.ns}else{b=!0}var e=a.getAttribute("type");return !b||this.name&&!h.isTagEqual(a,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(e):e!=this.type)||this.id&&a.getAttribute("id")!=this.id||this.from&&c!=this.from?!1:!0},run:function(a){var b=null;try{b=this.handler(a)}catch(c){throw c.sourceURL?h.fatal("error: "+this.handler+" "+c.sourceURL+":"+c.line+" - "+c.name+": "+c.message):c.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",c,c.message)),h.fatal("error: "+this.handler+" "+c.fileName+":"+c.lineNumber+" - "+c.name+": "+c.message)):h.fatal("error: "+c.message+"\n"+c.stack),c}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},h.TimedHandler=function(a,b){this.period=a,this.handler=b,this.lastCalled=(new Date).getTime(),this.user=!0},h.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},h.Connection=function(a,b){this.service=a,this.options=b||{};var c=this.options.protocol||"";0===a.indexOf("ws:")||0===a.indexOf("wss:")||0===c.indexOf("ws")?this._proto=new h.Websocket(this):this._proto=new h.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var d in h._connectionPlugins){if(h._connectionPlugins.hasOwnProperty(d)){var e=h._connectionPlugins[d],f=function(){};f.prototype=e,this[d]=new f,this[d].init(this)}}},h.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){return"string"==typeof a||"number"==typeof a?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,c,d,e,f,g){this.jid=a,this.authzid=h.getBareJidFromJid(this.jid),this.authcid=g||h.getNodeFromJid(this.jid),this.pass=b,this.servtype="xmpp",this.connect_callback=c,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=h.getDomainFromJid(this.jid),this._changeConnectStatus(h.Status.CONNECTING,null),this._proto._connect(d,e,f)},attach:function(a,b,c,d,e,f,g){if(!(this._proto instanceof h.Bosh)){throw {name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'}}this._proto._attach(a,b,c,d,e,f,g)},restore:function(a,b,c,d,e){if(!this._sessionCachingSupported()){throw {name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'}}this._proto._restore(a,b,c,d,e)},_sessionCachingSupported:function(){if(this._proto instanceof h.Bosh){if(!JSON){return !1}try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(a){return !1}return !0}return !1},xmlInput:function(a){},xmlOutput:function(a){},rawInput:function(a){},rawOutput:function(a){},send:function(a){if(null!==a){if("function"==typeof a.sort){for(var b=0;b<a.length;b++){this._queueData(a[b])}}else{this._queueData("function"==typeof a.tree?a.tree():a)}this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(a,b,c,d){var e=null,f=this;"function"==typeof a.tree&&(a=a.tree());var g=a.getAttribute("id");g||(g=this.getUniqueId("sendIQ"),a.setAttribute("id",g));var i=a.getAttribute("to"),j=this.jid,k=this.addHandler(function(a){e&&f.deleteTimedHandler(e);var d=!1,g=a.getAttribute("from");if((g===i||null===i&&(g===h.getBareJidFromJid(j)||g===h.getDomainFromJid(j)||g===j))&&(d=!0),!d){throw {name:"StropheError",message:"Got answer to IQ from wrong jid:"+g+"\nExpected jid: "+i}}var k=a.getAttribute("type");if("result"==k){b&&b(a)}else{if("error"!=k){throw {name:"StropheError",message:"Got bad IQ type of "+k}}c&&c(a)}},null,"iq",["error","result"],g);return d&&(e=this.addTimedHandler(d,function(){return f.deleteHandler(k),c&&c(null),!1})),this.send(a),g},_queueData:function(a){if(null===a||!a.tagName||!a.childNodes){throw {name:"StropheError",message:"Cannot queue non-DOMElement."}}this._data.push(a)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var c=new h.TimedHandler(a,b);return this.addTimeds.push(c),c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,d,e,f,g){var i=new h.Handler(a,b,c,d,e,f,g);return this.addHandlers.push(i),i},deleteHandler:function(a){this.removeHandlers.push(a);var b=this.addHandlers.indexOf(a);b>=0&&this.addHandlers.splice(b,1)},disconnect:function(a){if(this._changeConnectStatus(h.Status.DISCONNECTING,a),h.info("Disconnect was called because: "+a),this.connected){var b=!1;this.disconnecting=!0,this.authenticated&&(b=g({xmlns:h.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3000,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(b)}else{h.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()}},_changeConnectStatus:function(a,b){for(var c in h._connectionPlugins){if(h._connectionPlugins.hasOwnProperty(c)){var d=this[c];if(d.statusChanged){try{d.statusChanged(a,b)}catch(e){h.error(""+c+" plugin caused an exception changing status: "+e)}}}}if(this.connect_callback){try{this.connect_callback(a,b)}catch(f){h.error("User connection callback caused an exception: "+f)}}},_doDisconnect:function(a){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),h.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(h.Status.DISCONNECTED,a),this.connected=!1},_dataRecv:function(a,b){h.info("_dataRecv called");var c=this._proto._reqToData(a);if(null!==c){this.xmlInput!==h.Connection.prototype.xmlInput&&this.xmlInput(c.nodeName===this._proto.strip&&c.childNodes.length?c.childNodes[0]:c),this.rawInput!==h.Connection.prototype.rawInput&&this.rawInput(b?b:h.serialize(c));for(var d,e;this.removeHandlers.length>0;){e=this.removeHandlers.pop(),d=this.handlers.indexOf(e),d>=0&&this.handlers.splice(d,1)}for(;this.addHandlers.length>0;){this.handlers.push(this.addHandlers.pop())}if(this.disconnecting&&this._proto._emptyQueue()){return void this._doDisconnect()}var f,g,i=c.getAttribute("type");if(null!==i&&"terminate"==i){if(this.disconnecting){return}return f=c.getAttribute("condition"),g=c.getElementsByTagName("conflict"),null!==f?("remote-stream-error"==f&&g.length>0&&(f="conflict"),this._changeConnectStatus(h.Status.CONNFAIL,f)):this._changeConnectStatus(h.Status.CONNFAIL,"unknown"),void this._doDisconnect(f)}var j=this;h.forEachChild(c,null,function(a){var b,c;for(c=j.handlers,j.handlers=[],b=0;b<c.length;b++){var d=c[b];try{!d.isMatch(a)||!j.authenticated&&d.user?j.handlers.push(d):d.run(a)&&j.handlers.push(d)}catch(e){h.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}},mechanisms:{},_connect_cb:function(a,b,c){h.info("_connect_cb was called"),this.connected=!0;var d=this._proto._reqToData(a);if(d){this.xmlInput!==h.Connection.prototype.xmlInput&&this.xmlInput(d.nodeName===this._proto.strip&&d.childNodes.length?d.childNodes[0]:d),this.rawInput!==h.Connection.prototype.rawInput&&this.rawInput(c?c:h.serialize(d));var e=this._proto._connect_cb(d);if(e!==h.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var f;f=d.getElementsByTagNameNS?d.getElementsByTagNameNS(h.NS.STREAM,"features").length>0:d.getElementsByTagName("stream:features").length>0||d.getElementsByTagName("features").length>0;var g,i,j=d.getElementsByTagName("mechanism"),k=[],l=!1;if(!f){return void this._proto._no_auth_received(b)}if(j.length>0){for(g=0;g<j.length;g++){i=h.getText(j[g]),this.mechanisms[i]&&k.push(this.mechanisms[i])}}return this._authentication.legacy_auth=d.getElementsByTagName("auth").length>0,(l=this._authentication.legacy_auth||k.length>0)?void (this.do_authentication!==!1&&this.authenticate(k)):void this._proto._no_auth_received(b)}}},authenticate:function(a){var c;for(c=0;c<a.length-1;++c){for(var e=c,g=c+1;g<a.length;++g){a[g].prototype.priority>a[e].prototype.priority&&(e=g)}if(e!=c){var i=a[c];a[c]=a[e],a[e]=i}}var j=!1;for(c=0;c<a.length;++c){if(a[c].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new a[c],this._sasl_mechanism.onStart(this);var k=d("auth",{xmlns:h.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var l=this._sasl_mechanism.onChallenge(this,null);k.t(b.encode(l))}this.send(k.tree()),j=!0;break}}j||(null===h.getNodeFromJid(this.jid)?(this._changeConnectStatus(h.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(h.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(f({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(a){var c=b.decode(h.getText(a)),e=this._sasl_mechanism.onChallenge(this,c),f=d("response",{xmlns:h.NS.SASL});return""!==e&&f.t(b.encode(e)),this.send(f.tree()),!0},_auth1_cb:function(a){var b=f({type:"set",id:"_auth_2"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return h.getResourceFromJid(this.jid)||(this.jid=h.getBareJidFromJid(this.jid)+"/strophe"),b.up().c("resource",{}).t(h.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(b.tree()),!1},_sasl_success_cb:function(a){if(this._sasl_data["server-signature"]){var c,d=b.decode(h.getText(a)),e=/([a-z]+)=([^,]+)(,|$)/,f=d.match(e);if("v"==f[1]&&(c=f[2]),c!=this._sasl_data["server-signature"]){return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}}h.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var g=[],i=function(a,b){for(;a.length;){this.deleteHandler(a.pop())}return this._sasl_auth1_cb.bind(this)(b),!1};return g.push(this._addSysHandler(function(a){i.bind(this)(g,a)}.bind(this),null,"stream:features",null,null)),g.push(this._addSysHandler(function(a){i.bind(this)(g,a)}.bind(this),h.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(a){this.features=a;var b,c;for(b=0;b<a.childNodes.length;b++){c=a.childNodes[b],"bind"==c.nodeName&&(this.do_bind=!0),"session"==c.nodeName&&(this.do_session=!0)}if(!this.do_bind){return this._changeConnectStatus(h.Status.AUTHFAIL,null),!1}this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var d=h.getResourceFromJid(this.jid);return this.send(d?f({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).c("resource",{}).t(d).tree():f({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).tree()),!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type")){h.info("SASL binding failed.");var b,c=a.getElementsByTagName("conflict");return c.length>0&&(b="conflict"),this._changeConnectStatus(h.Status.AUTHFAIL,b),!1}var d,e=a.getElementsByTagName("bind");return e.length>0?(d=e[0].getElementsByTagName("jid"),void (d.length>0&&(this.jid=h.getText(d[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(f({type:"set",id:"_session_auth_2"}).c("session",{xmlns:h.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null))))):(h.info("SASL binding failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(a){if("result"==a.getAttribute("type")){this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null)}else{if("error"==a.getAttribute("type")){return h.info("Session creation failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null),!1}}return !1},_sasl_failure_cb:function(a){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(h.Status.AUTHFAIL,null),!1},_auth2_cb:function(a){return"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(h.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(h.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(a,b){var c=new h.TimedHandler(a,b);return c.user=!1,this.addTimeds.push(c),c},_addSysHandler:function(a,b,c,d,e){var f=new h.Handler(a,b,c,d,e);return f.user=!1,this.addHandlers.push(f),f},_onDisconnectTimeout:function(){return h.info("_onDisconnectTimeout was called"),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var a,b,c,d;this.addTimeds.length>0;){this.timedHandlers.push(this.addTimeds.pop())}for(;this.removeTimeds.length>0;){b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),a>=0&&this.timedHandlers.splice(a,1)}var e=(new Date).getTime();for(d=[],a=0;a<this.timedHandlers.length;a++){b=this.timedHandlers[a],(this.authenticated||!b.user)&&(c=b.lastCalled+b.period,0>=c-e?b.run()&&d.push(b):d.push(b))}this.timedHandlers=d,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},h.SASLMechanism=function(a,b,c){this.name=a,this.isClientFirst=b,this.priority=c},h.SASLMechanism.prototype={test:function(a){return !0},onStart:function(a){this._connection=a},onChallenge:function(a,b){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},h.SASLAnonymous=function(){},h.SASLAnonymous.prototype=new h.SASLMechanism("ANONYMOUS",!1,10),h.SASLAnonymous.test=function(a){return null===a.authcid},h.Connection.prototype.mechanisms[h.SASLAnonymous.prototype.name]=h.SASLAnonymous,h.SASLPlain=function(){},h.SASLPlain.prototype=new h.SASLMechanism("PLAIN",!0,20),h.SASLPlain.test=function(a){return null!==a.authcid},h.SASLPlain.prototype.onChallenge=function(a){var b=a.authzid;return b+="\x00",b+=a.authcid,b+="\x00",b+=a.pass},h.Connection.prototype.mechanisms[h.SASLPlain.prototype.name]=h.SASLPlain,h.SASLSHA1=function(){},h.SASLSHA1.prototype=new h.SASLMechanism("SCRAM-SHA-1",!0,40),h.SASLSHA1.test=function(a){return null!==a.authcid},h.SASLSHA1.prototype.onChallenge=function(d,e,f){var g=f||c.hexdigest(1234567890*Math.random()),h="n="+d.authcid;return h+=",r=",h+=g,d._sasl_data.cnonce=g,d._sasl_data["client-first-message-bare"]=h,h="n,,"+h,this.onChallenge=function(c,d){for(var e,f,g,h,i,j,k,l,m,n,o,p="c=biws,",q=c._sasl_data["client-first-message-bare"]+","+d+",",r=c._sasl_data.cnonce,s=/([a-z]+)=([^,]+)(,|$)/;d.match(s);){var t=d.match(s);switch(d=d.replace(t[0],""),t[1]){case"r":e=t[2];break;case"s":f=t[2];break;case"i":g=t[2]}}if(e.substr(0,r.length)!==r){return c._sasl_data={},c._sasl_failure_cb()}for(p+="r="+e,q+=p,f=b.decode(f),f+="\x00\x00\x00",h=j=a.core_hmac_sha1(c.pass,f),k=1;g>k;k++){for(i=a.core_hmac_sha1(c.pass,a.binb2str(j)),l=0;5>l;l++){h[l]^=i[l]}j=i}for(h=a.binb2str(h),m=a.core_hmac_sha1(h,"Client Key"),n=a.str_hmac_sha1(h,"Server Key"),o=a.core_hmac_sha1(a.str_sha1(a.binb2str(m)),q),c._sasl_data["server-signature"]=a.b64_hmac_sha1(n,q),l=0;5>l;l++){m[l]^=o[l]}return p+=",p="+b.encode(a.binb2str(m))}.bind(this),h},h.Connection.prototype.mechanisms[h.SASLSHA1.prototype.name]=h.SASLSHA1,h.SASLMD5=function(){},h.SASLMD5.prototype=new h.SASLMechanism("DIGEST-MD5",!1,30),h.SASLMD5.test=function(a){return null!==a.authcid},h.SASLMD5.prototype._quote=function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},h.SASLMD5.prototype.onChallenge=function(a,b,d){for(var e,f=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,g=d||c.hexdigest(""+1234567890*Math.random()),h="",i=null,j="",k="";b.match(f);){switch(e=b.match(f),b=b.replace(e[0],""),e[2]=e[2].replace(/^"(.+)"$/,"$1"),e[1]){case"realm":h=e[2];break;case"nonce":j=e[2];break;case"qop":k=e[2];break;case"host":i=e[2]}}var l=a.servtype+"/"+a.domain;null!==i&&(l=l+"/"+i);var m=c.hash(a.authcid+":"+h+":"+this._connection.pass)+":"+j+":"+g,n="AUTHENTICATE:"+l,o="";return o+="charset=utf-8,",o+="username="+this._quote(a.authcid)+",",o+="realm="+this._quote(h)+",",o+="nonce="+this._quote(j)+",",o+="nc=00000001,",o+="cnonce="+this._quote(g)+",",o+="digest-uri="+this._quote(l)+",",o+="response="+c.hexdigest(c.hexdigest(m)+":"+j+":00000001:"+g+":auth:"+c.hexdigest(n))+",",o+="qop=auth",this.onChallenge=function(){return""}.bind(this),o},h.Connection.prototype.mechanisms[h.SASLMD5.prototype.name]=h.SASLMD5,{Strophe:h,$build:d,$msg:e,$iq:f,$pres:g,SHA1:a,Base64:b,MD5:c}}),function(a,b){return"function"==typeof define&&define.amd?void define("strophe-bosh",["strophe-core"],function(a){return b(a.Strophe,a.$build)}):b(Strophe,$build)}(this,function(a,b){return a.Request=function(b,c,d,e){this.id=++a._requestId,this.xmlData=b,this.data=a.serialize(b),this.origFunc=c,this.func=c,this.rid=d,this.date=0/0,this.sends=e||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date){return 0}var a=new Date;return(a-this.date)/1000},this.timeDead=function(){if(!this.dead){return 0}var a=new Date;return(a-this.dead)/1000},this.xhr=this._newXHR()},a.Request.prototype={getResponse:function(){var b=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(b=this.xhr.responseXML.documentElement,"parsererror"==b.tagName){throw a.error("invalid response received"),a.error("responseText: "+this.xhr.responseText),a.error("responseXML: "+a.serialize(this.xhr.responseXML)),"parsererror"}}else{this.xhr.responseText&&(a.error("invalid response received"),a.error("responseText: "+this.xhr.responseText),a.error("responseXML: "+a.serialize(this.xhr.responseXML)))}return b},_newXHR:function(){var a=null;return window.XMLHttpRequest?(a=new XMLHttpRequest,a.overrideMimeType&&a.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=this.func.bind(null,this),a}},a.Bosh=function(a){this._conn=a,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this._requests=[]},a.Bosh.prototype={strip:null,_buildBody:function(){var c=b("body",{rid:this.rid++,xmlns:a.NS.HTTPBIND});return null!==this.sid&&c.attrs({sid:this.sid}),this._conn.options.keepalive&&this._cacheSession(),c},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,window.sessionStorage.removeItem("strophe-bosh-session")},_connect:function(b,c,d){this.wait=b||this.wait,this.hold=c||this.hold,this.errors=0;var e=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":a.NS.BOSH});d&&e.attrs({route:d});var f=this._conn._connect_cb;this._requests.push(new a.Request(e.tree(),this._onRequestStateChange.bind(this,f.bind(this._conn)),e.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(b,c,d,e,f,g,h){this._conn.jid=b,this.sid=c,this.rid=d,this._conn.connect_callback=e,this._conn.domain=a.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=f||this.wait,this.hold=g||this.hold,this.window=h||this.window,this._conn._changeConnectStatus(a.Status.ATTACHED,null)},_restore:function(b,c,d,e,f){var g=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!("undefined"!=typeof g&&null!==g&&g.rid&&g.sid&&g.jid)||"undefined"!=typeof b&&a.getBareJidFromJid(g.jid)!=a.getBareJidFromJid(b)){throw {name:"StropheSessionError",message:"_restore: no restoreable session."}}this._conn.restored=!0,this._attach(g.jid,g.sid,g.rid,c,d,e,f)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(b){var c,d,e=b.getAttribute("type");if(null!==e&&"terminate"==e){return c=b.getAttribute("condition"),a.error("BOSH-Connection failed: "+c),d=b.getElementsByTagName("conflict"),null!==c?("remote-stream-error"==c&&d.length>0&&(c="conflict"),this._conn._changeConnectStatus(a.Status.CONNFAIL,c)):this._conn._changeConnectStatus(a.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(c),a.Status.CONNFAIL}this.sid||(this.sid=b.getAttribute("sid"));var f=b.getAttribute("requests");f&&(this.window=parseInt(f,10));var g=b.getAttribute("hold");g&&(this.hold=parseInt(g,10));var h=b.getAttribute("wait");h&&(this.wait=parseInt(h,10))},_disconnect:function(a){this._sendTerminate(a)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),window.sessionStorage.removeItem("strophe-bosh-session")},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(b){this.errors++,a.warn("request errored, status: "+b+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(b){b=b?b.bind(this._conn):this._conn._connect_cb.bind(this._conn);var c=this._buildBody();this._requests.push(new a.Request(c.tree(),this._onRequestStateChange.bind(this,b.bind(this._conn)),c.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var a;this._requests.length>0;){a=this._requests.pop(),a.abort=!0,a.xhr.abort(),a.xhr.onreadystatechange=function(){}}},_onIdle:function(){var b=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===b.length&&!this._conn.disconnecting&&(a.info("no requests during idle cycle, sending blank request"),b.push(null)),!this._conn.paused){if(this._requests.length<2&&b.length>0){for(var c=this._buildBody(),d=0;d<b.length;d++){null!==b[d]&&("restart"===b[d]?c.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":a.NS.BOSH}):c.cnode(b[d]).up())}delete this._conn._data,this._conn._data=[],this._requests.push(new a.Request(c.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),c.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(a.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),e>Math.floor(a.TIMEOUT*this.wait)&&(a.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(a.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_onRequestStateChange:function(b,c){if(a.debug("request id "+c.id+"."+c.sends+" state changed to "+c.xhr.readyState),c.abort){return void (c.abort=!1)}var d;if(4==c.xhr.readyState){d=0;try{d=c.xhr.status}catch(e){}if("undefined"==typeof d&&(d=0),this.disconnecting&&d>=400){return void this._hitError(d)}var f=this._requests[0]==c,g=this._requests[1]==c;(d>0&&500>d||c.sends>5)&&(this._removeRequest(c),a.debug("request id "+c.id+" should now be removed")),200==d?((g||f&&this._requests.length>0&&this._requests[0].age()>Math.floor(a.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),a.debug("request id "+c.id+"."+c.sends+" got 200"),b(c),this.errors=0):(a.error("request id "+c.id+"."+c.sends+" error "+d+" happened"),(0===d||d>=400&&600>d||d>=12000)&&(this._conn.onBoshReadyStateChange&&(this._conn.onBoshReadyStateChange(d)),this._hitError(d),d>=400&&500>d&&(this._conn._changeConnectStatus(a.Status.DISCONNECTING,null),this._conn._doDisconnect()))),d>0&&500>d||c.sends>5||this._throttledRequestHandler()}},_processRequest:function(b){var c=this,d=this._requests[b],e=-1;try{4==d.xhr.readyState&&(e=d.xhr.status)}catch(f){a.error("caught an error in _requests["+b+"], reqStatus: "+e)}if("undefined"==typeof e&&(e=-1),d.sends>this._conn.maxRetries){return void this._conn._onDisconnectTimeout()}var g=d.age(),h=!isNaN(g)&&g>Math.floor(a.TIMEOUT*this.wait),i=null!==d.dead&&d.timeDead()>Math.floor(a.SECONDARY_TIMEOUT*this.wait),j=4==d.xhr.readyState&&(1>e||e>=500);if((h||i||j)&&(i&&a.error("Request "+this._requests[b].id+" timed out (secondary), restarting"),d.abort=!0,d.xhr.abort(),d.xhr.onreadystatechange=function(){},this._requests[b]=new a.Request(d.xmlData,d.origFunc,d.rid,d.sends),d=this._requests[b]),0===d.xhr.readyState){a.debug("request id "+d.id+"."+d.sends+" posting");try{d.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0),d.xhr.setRequestHeader("Content-Type","text/xml; charset=utf-8")}catch(k){return a.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(a.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(d.date=new Date,c._conn.options.customHeaders){var a=c._conn.options.customHeaders;for(var b in a){a.hasOwnProperty(b)&&d.xhr.setRequestHeader(b,a[b])}}d.xhr.send(d.data)};if(d.sends>1){var m=1000*Math.min(Math.floor(a.TIMEOUT*this.wait),Math.pow(d.sends,3));setTimeout(l,m)}else{l()}d.sends++,this._conn.xmlOutput!==a.Connection.prototype.xmlOutput&&this._conn.xmlOutput(d.xmlData.nodeName===this.strip&&d.xmlData.childNodes.length?d.xmlData.childNodes[0]:d.xmlData),this._conn.rawOutput!==a.Connection.prototype.rawOutput&&this._conn.rawOutput(d.data)}else{a.debug("_processRequest: "+(0===b?"first":"second")+" request has readyState of "+d.xhr.readyState)}},_removeRequest:function(b){a.debug("removing request");var c;for(c=this._requests.length-1;c>=0;c--){b==this._requests[c]&&this._requests.splice(c,1)}b.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];null===b.dead&&(b.dead=new Date),this._processRequest(a)},_reqToData:function(a){try{return a.getResponse()}catch(b){if("parsererror"!=b){throw b}this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(b){a.info("_sendTerminate was called");var c=this._buildBody().attrs({type:"terminate"});b&&c.cnode(b.tree());var d=new a.Request(c.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),c.tree().getAttribute("rid"));this._requests.push(d),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(this._conn._onIdle.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){a.debug(this._requests?"_throttledRequestHandler called with "+this._requests.length+" requests":"_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},a}),function(a,b){return"function"==typeof define&&define.amd?void define("strophe-websocket",["strophe-core"],function(a){return b(a.Strophe,a.$build)}):b(Strophe,$build)}(this,function(a,b){return a.Websocket=function(a){this._conn=a,this.strip="wrapper";var b=a.service;if(0!==b.indexOf("ws:")&&0!==b.indexOf("wss:")){var c="";c+="ws"===a.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",c+="://"+window.location.host,c+=0!==b.indexOf("/")?window.location.pathname+b:b,a.service=c}},a.Websocket.prototype={_buildStream:function(){return b("open",{xmlns:a.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(b,c){var d;if(d=b.getElementsByTagNameNS?b.getElementsByTagNameNS(a.NS.STREAM,"error"):b.getElementsByTagName("stream:error"),0===d.length){return !1}for(var e=d[0],f="",g="",h="urn:ietf:params:xml:ns:xmpp-streams",i=0;i<e.childNodes.length;i++){var j=e.childNodes[i];if(j.getAttribute("xmlns")!==h){break}"text"===j.nodeName?g=j.textContent:f=j.nodeName}var k="WebSocket stream error: ";return k+=f?f:"unknown",g&&(k+=" - "+f),a.error(k),this._conn._changeConnectStatus(c,f),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(b){var c=this._check_streamerror(b,a.Status.CONNFAIL);return c?a.Status.CONNFAIL:void 0},_handleStreamStart:function(b){var c=!1,d=b.getAttribute("xmlns");"string"!=typeof d?c="Missing xmlns in <open />":d!==a.NS.FRAMING&&(c="Wrong xmlns in <open />: "+d);var e=b.getAttribute("version");return"string"!=typeof e?c="Missing version in <open />":"1.0"!==e&&(c="Wrong version in <open />: "+e),c?(this._conn._changeConnectStatus(a.Status.CONNFAIL,c),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(b){if(0===b.data.indexOf("<open ")||0===b.data.indexOf("<?xml")){var c=b.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===c){return}var d=(new DOMParser).parseFromString(c,"text/xml").documentElement;this._conn.xmlInput(d),this._conn.rawInput(b.data),this._handleStreamStart(d)&&this._connect_cb(d)}else{if(0===b.data.indexOf("<close ")){this._conn.rawInput(b.data),this._conn.xmlInput(b);var e=b.getAttribute("see-other-uri");e?(this._conn._changeConnectStatus(a.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=e,this._connect()):(this._conn._changeConnectStatus(a.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var f=this._streamWrap(b.data),g=(new DOMParser).parseFromString(f,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(g,null,b.data)}}},_disconnect:function(c){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){c&&this._conn.send(c);var d=b("close",{xmlns:a.NS.FRAMING});this._conn.xmlOutput(d);var e=a.serialize(d);this._conn.rawOutput(e);try{this.socket.send(e)}catch(f){a.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){a.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(a){return"<wrapper>"+a+"</wrapper>"},_closeSocket:function(){if(this.socket){try{this.socket.close()}catch(a){}}this.socket=null},_emptyQueue:function(){return !0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(a.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):a.info("Websocket closed")},_no_auth_received:function(b){a.error("Server did not send any auth methods"),this._conn._changeConnectStatus(a.Status.CONNFAIL,"Server did not send any auth methods"),b&&(b=b.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(b){a.error("Websocket error "+b),this._conn._changeConnectStatus(a.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected."),this._disconnect()},_onIdle:function(){var b=this._conn._data;if(b.length>0&&!this._conn.paused){for(var c=0;c<b.length;c++){if(null!==b[c]){var d,e;d="restart"===b[c]?this._buildStream().tree():b[c],e=a.serialize(d),this._conn.xmlOutput(d),this._conn.rawOutput(e),this.socket.send(e)}}this._conn._data=[]}},_onMessage:function(b){var c,d,e='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(b.data===e){return this._conn.rawInput(e),this._conn.xmlInput(b),void (this._conn.disconnecting||this._conn._doDisconnect())}if(0===b.data.search("<open ")){if(c=(new DOMParser).parseFromString(b.data,"text/xml").documentElement,!this._handleStreamStart(c)){return}}else{d=this._streamWrap(b.data),c=(new DOMParser).parseFromString(d,"text/xml").documentElement}return this._check_streamerror(c,a.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===c.firstChild.nodeName&&"unavailable"===c.firstChild.getAttribute("type")?(this._conn.xmlInput(c),void this._conn.rawInput(a.serialize(c))):void this._conn._dataRecv(c,b.data)},_onOpen:function(){a.info("Websocket open");var b=this._buildStream();this._conn.xmlOutput(b.tree());var c=a.serialize(b);this._conn.rawOutput(c),this.socket.send(c)},_reqToData:function(a){return a},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},a}),a?a(Strophe,$build,$msg,$iq,$pres):void 0}(function(a,b,c,d,e){window.Strophe=a,window.$build=b,window.$msg=c,window.$iq=d,window.$pres=e});Strophe.Builder.prototype.form=function(ns,options){var aX=this.node.appendChild(Strophe.xmlElement("x",{xmlns:"jabber:x:data",type:"submit"}));aX.appendChild(Strophe.xmlElement("field",{"var":"FORM_TYPE",type:"hidden"})).appendChild(Strophe.xmlElement("value")).appendChild(Strophe.xmlTextNode(ns));for(var i in options){aX.appendChild(Strophe.xmlElement("field",{"var":i})).appendChild(Strophe.xmlElement("value")).appendChild(Strophe.xmlTextNode(options[i]))}return this};Strophe.Builder.prototype.list=function(tag,array){for(var i=0;i<array.length;++i){this.c(tag,array[i].attrs);this.node.appendChild(array[i].data.cloneNode?array[i].data.cloneNode(true):Strophe.xmlTextNode(array[i].data));this.up()}return this};Strophe.Builder.prototype.children=function(object){var key,value;for(key in object){if(!object.hasOwnProperty(key)){continue}value=object[key];if(Array.isArray(value)){this.list(key,value)}else{if(typeof value==="string"){this.c(key,{},value)}else{if(typeof value==="number"){this.c(key,{},""+value)}else{if(typeof value==="object"){this.c(key).children(value).up()}else{this.c(key).up()}}}}}return this};Strophe.addConnectionPlugin("pubsub",{_connection:null,_autoService:true,service:null,jid:null,handler:{},init:function(conn){this._connection=conn;Strophe.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub");Strophe.addNamespace("PUBSUB_SUBSCRIBE_OPTIONS",Strophe.NS.PUBSUB+"#subscribe_options");Strophe.addNamespace("PUBSUB_ERRORS",Strophe.NS.PUBSUB+"#errors");Strophe.addNamespace("PUBSUB_EVENT",Strophe.NS.PUBSUB+"#event");Strophe.addNamespace("PUBSUB_OWNER",Strophe.NS.PUBSUB+"#owner");Strophe.addNamespace("PUBSUB_AUTO_CREATE",Strophe.NS.PUBSUB+"#auto-create");Strophe.addNamespace("PUBSUB_PUBLISH_OPTIONS",Strophe.NS.PUBSUB+"#publish-options");Strophe.addNamespace("PUBSUB_NODE_CONFIG",Strophe.NS.PUBSUB+"#node_config");Strophe.addNamespace("PUBSUB_CREATE_AND_CONFIGURE",Strophe.NS.PUBSUB+"#create-and-configure");Strophe.addNamespace("PUBSUB_SUBSCRIBE_AUTHORIZATION",Strophe.NS.PUBSUB+"#subscribe_authorization");Strophe.addNamespace("PUBSUB_GET_PENDING",Strophe.NS.PUBSUB+"#get-pending");Strophe.addNamespace("PUBSUB_MANAGE_SUBSCRIPTIONS",Strophe.NS.PUBSUB+"#manage-subscriptions");Strophe.addNamespace("PUBSUB_META_DATA",Strophe.NS.PUBSUB+"#meta-data");Strophe.addNamespace("ATOM","http://www.w3.org/2005/Atom");if(conn.disco){conn.disco.addFeature(Strophe.NS.PUBSUB)}},statusChanged:function(status,condition){var that=this._connection;if(this._autoService&&(status===Strophe.Status.CONNECTED||status===Strophe.Status.ATTACHED)){this.service="pubsub."+Strophe.getDomainFromJid(that.jid);this.jid=that.jid}},connect:function(jid,service){var that=this._connection;if(service===undefined){service=jid;jid=undefined}this.jid=jid||that.jid;this.service=service||null;this._autoService=false},storeHandler:function(node,handler){if(!this.handler[node]){this.handler[node]=[]}this.handler[node].push(handler)},removeHandler:function(node){var toberemoved=this.handler[node];this.handler[node]=[];if(toberemoved&&toberemoved.length>0){for(var i=0,l=toberemoved.length;i<l;i++){this._connection.deleteHandler(toberemoved[i])}}},createNode:function(node,options,call_back){var that=this._connection;var iqid=that.getUniqueId("pubsubcreatenode");var iq=$iq({from:this.jid,to:this.service,type:"set",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("create",{node:node});if(options){iq.up().c("configure").form(Strophe.NS.PUBSUB_NODE_CONFIG,options)}that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},deleteNode:function(node,call_back){var that=this._connection;var iqid=that.getUniqueId("pubsubdeletenode");var iq=$iq({from:this.jid,to:this.service,type:"set",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB_OWNER}).c("delete",{node:node});that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},discoverNodes:function(success,error,timeout){var iq=$iq({from:this.jid,to:this.service,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS});return this._connection.sendIQ(iq.tree(),success,error,timeout)},getConfig:function(node,call_back){var that=this._connection;var iqid=that.getUniqueId("pubsubconfigurenode");var iq=$iq({from:this.jid,to:this.service,type:"get",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB_OWNER}).c("configure",{node:node});that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},getDefaultNodeConfig:function(call_back){var that=this._connection;var iqid=that.getUniqueId("pubsubdefaultnodeconfig");var iq=$iq({from:this.jid,to:this.service,type:"get",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB_OWNER}).c("default");that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},subscribe:function(node,options,event_cb,success,error,barejid){var that=this._connection;var iqid=that.getUniqueId("subscribenode");var jid=this.jid;if(barejid){jid=Strophe.getBareJidFromJid(jid)}var iq=$iq({from:this.jid,to:this.service,type:"set",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("subscribe",{node:node,jid:jid});if(options){iq.up().c("options").form(Strophe.NS.PUBSUB_SUBSCRIBE_OPTIONS,options)}var hand=that.addHandler(event_cb,null,"message",null,null,null);this.storeHandler(node,hand);that.sendIQ(iq.tree(),success,error);return iqid},unsubscribe:function(node,jid,subid,success,error){var that=this._connection;var iqid=that.getUniqueId("pubsubunsubscribenode");var iq=$iq({from:this.jid,to:this.service,type:"set",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("unsubscribe",{node:node,jid:jid});if(subid){iq.attrs({subid:subid})}that.sendIQ(iq.tree(),success,error);this.removeHandler(node);return iqid},publish:function(node,items,call_back){var that=this._connection;var iqid=that.getUniqueId("pubsubpublishnode");var iq=$iq({from:this.jid,to:this.service,type:"set",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("publish",{node:node,jid:this.jid}).list("item",items);that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},items:function(node,success,error,timeout){var iq=$iq({from:this.jid,to:this.service,type:"get"}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("items",{node:node});return this._connection.sendIQ(iq.tree(),success,error,timeout)},getSubscriptions:function(call_back,timeout){var that=this._connection;var iqid=that.getUniqueId("pubsubsubscriptions");var iq=$iq({from:this.jid,to:this.service,type:"get",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("subscriptions");that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},getNodeSubscriptions:function(node,call_back){var that=this._connection;var iqid=that.getUniqueId("pubsubsubscriptions");var iq=$iq({from:this.jid,to:this.service,type:"get",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB_OWNER}).c("subscriptions",{node:node});that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},getSubOptions:function(node,subid,call_back){var that=this._connection;var iqid=that.getUniqueId("pubsubsuboptions");var iq=$iq({from:this.jid,to:this.service,type:"get",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("options",{node:node,jid:this.jid});if(subid){iq.attrs({subid:subid})}that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},getAffiliations:function(node,call_back){var that=this._connection;var iqid=that.getUniqueId("pubsubaffiliations");if(typeof node==="function"){call_back=node;node=undefined}var attrs={},xmlns={xmlns:Strophe.NS.PUBSUB};if(node){attrs.node=node;xmlns={xmlns:Strophe.NS.PUBSUB_OWNER}}var iq=$iq({from:this.jid,to:this.service,type:"get",id:iqid}).c("pubsub",xmlns).c("affiliations",attrs);that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},setAffiliation:function(node,jid,affiliation,call_back){var that=this._connection;var iqid=thiat.getUniqueId("pubsubaffiliations");var iq=$iq({from:this.jid,to:this.service,type:"set",id:iqid}).c("pubsub",{xmlns:Strophe.NS.PUBSUB_OWNER}).c("affiliations",{node:node}).c("affiliation",{jid:jid,affiliation:affiliation});that.addHandler(call_back,null,"iq",null,iqid,null);that.send(iq.tree());return iqid},publishAtom:function(node,atoms,call_back){if(!Array.isArray(atoms)){atoms=[atoms]}var i,atom,entries=[];for(i=0;i<atoms.length;i++){atom=atoms[i];atom.updated=atom.updated||(new Date()).toISOString();if(atom.published&&atom.published.toISOString){atom.published=atom.published.toISOString()}entries.push({data:$build("entry",{xmlns:Strophe.NS.ATOM}).children(atom).tree(),attrs:(atom.id?{id:atom.id}:{})})}return this.publish(node,entries,call_back)}});var cnLogSavedConfig=null;function CNLogSvc(){this.isInitialized=false;this.context={};this.context.source="CNLogSvc";this.context.version="v1";this.context.initTS=this.getTimeStamp();this.context.userAgent=navigator.userAgent;this._counter={};this._counter.traceLogIndex=0;this._counter.eventLogIndex=0;this.options={onConnectedGetSubscribers:true,onConnectedPing:false,saveCustomerXMPPConnStatus:false,saveAgentXMPPConnStatus:false};this.extSvcConfigured=false;this.sessionStorageAvailable=false;this._config={level:0};this.setContextId(null);this.onLogMessage=null;this._onLogRemoteMessage=null;this._configExtSvc()}CNLogSvc.prototype={_configExtSvc:function(){var metas=document.getElementsByTagName("meta");try{for(var i=0;i<metas.length;i++){switch(metas[i].getAttribute("name")){case"cn-env":if(this.context.environment==null){this.context.environment=metas[i].getAttribute("content")}break}}if(typeof(Rollbar)!=="undefined"){this.rollbar=Rollbar;Rollbar.configure({payload:{session:{initTS:this.context.initTS}},verbose:false});this.extSvcConfigured=true}}catch(e){this.log(1,"cnLogSvc._configExtSvc",e)}},init:function(settings){var self=this;self.log(5,"cnLogSvc.init","Initializing log service.");self.log(10,"cnLogSvc.init","Settings: "+JSON.stringify(settings));if(typeof(CN)!=="undefined"&&!self.context.visitId){self.context.visitId=CN.getFromLocal("vstid")}if(!self.context.chatSessionUQID&&settings.chatSessionUqId){self.context.chatSessionUQID=settings.chatSessionUqId}if(settings.context){Object.keys(settings.context).forEach(function(key){self.context[key]=settings.context[key]})}if(settings.options){Object.keys(settings.options).forEach(function(key){self.options[key]=settings.options[key]})}if(settings.config){if(settings.config.override){if(this.sessionStorageAvailable){sessionStorage.setItem("cnLogSvc","")}}else{var cnLogSavedConfig=self.sessionStorageAvailable?sessionStorage.getItem("cnLogSvc"):null;if(cnLogSavedConfig!=null&&cnLogSavedConfig!=""){cnLogSavedConfig=JSON.parse(cnLogSavedConfig);if(cnLogSavedConfig.level){settings.config.level=cnLogSavedConfig.level}}}self.config=settings.config;self._config=settings.config}self._configExtSvc();if(!self.isInitialized){self.logTrace("logSvc","init");self.isInitialized=true;if(typeof(LogRocket)!=="undefined"){LogRocket.getSessionURL(function(sessionURL){self.logTrace("LogRocket","init")})}}if(self.config.logTrace&&self.config.logTrace.interval>0&&!self.logTraceIntervalHandle){self.logTraceIntervalCounter=0;self.logTraceIntervalHandle=setInterval(self.onLogTraceInterval.bind(self),self.config.logTrace.interval*1000)}},setContextId:function(contextId){this.context.id=contextId;try{sessionStorage.setItem("cnLogSvc.ping",1);this.sessionStorageAvailable=true;cnLogSavedConfig=sessionStorage.getItem("cnLogSvc")}catch(e){}if(cnLogSavedConfig!=""&&cnLogSavedConfig!=null){try{var jsonConfig=JSON.parse(cnLogSavedConfig);if(!jsonConfig.limitIds||jsonConfig.limitIds&&jsonConfig.limitIds.indexOf(this.context.id)>=0){this._config=jsonConfig}this.config=this._config}catch(e){if(this.sessionStorageAvailable){sessionStorage.setItem("cnLogSvc","")}this.config=this._config}}else{this.config=this._config}},setConfig:function(config){this.config=config;if(this.sessionStorageAvailable){sessionStorage.setItem("cnLogSvc",JSON.stringify(this.config))}},resetConfig:function(){this.config=this._config;this.resetRemoteConfig()},setRemoteHandler:function(onLogRemoteMessage){this._onLogRemoteMessage=onLogRemoteMessage},resetRemoteConfig:function(){this.config.to=null;this._onLogRemoteMessage=null;if(this.sessionStorageAvailable){sessionStorage.setItem("cnLogSvc",JSON.stringify(this.config))}},getTimeStamp:function(){var now=new Date();return now.toISOString()},setLevel:function(level){this.config.level=level},log:function(level,src,options,json){if(this.config.level>0||level==1||json){var isError=false;var genMessage="";var isEnabled=this.config.level>=level?true:false;if(!isEnabled&&this.config.src){var srcLevel=this.config.src[src];if(srcLevel>=level){isEnabled=true}}if(isEnabled||((level==1||json)&&this.extSvcConfigured==true)){if(options!=null){if(typeof options=="string"){genMessage=genMessage+options}else{if(options.name&&options.name.indexOf("Error")>=0){genMessage=genMessage+options.toString();isError=true}else{try{genMessage=genMessage+JSON.stringify(options)}catch(e){for(var key in options){genMessage=genMessage+key+": "+options[key]+"; "}}}}}}if((level==1||json)&&this.extSvcConfigured==true){if(json){if(json.params){if(!json.params.source){json.params.source=src}if(!json.params.level){json.params.level=level}}else{json.params={source:src,level:level}}}else{json={params:{source:src,level:level}}}json.params.message=genMessage;if(isError==true){json.params.isError=true;this.logToExtService(json,options)}else{this.logToExtService(json)}}if(isEnabled){var msg=this.getTimeStamp()+" "+level+" ["+src+"] "+genMessage;if(this.context.id){msg=this.context.id+": "+msg}if(isError||level==1){console.error(msg)}else{console.log(msg)}if(this.onLogMessage){this.onLogMessage(msg,this.config)}if(this._onLogRemoteMessage){this._onLogRemoteMessage(msg,this.config)}}}},logEvent:function(json){var self=this;var logLocally=true;this._counter.eventLogIndex+=1;json.instance_id=this.context.initTS;json.sort_order=this._counter.eventLogIndex;if(!json.source){json.source=this.context.source}if(!json.version){json.version=this.context.version}if(!json.src_rel){json.src_rel=this.context.src_rel}json.recording=typeof(LogRocket)!=="undefined"?LogRocket.sessionURL:null;this.log(15,"cnLogSvc.logEvent",json);if(this.config.logEvent&&this.config.logEvent.url&&this.config.logEvent.token){try{var api_token=this.config.logEvent.token;$.ajax({url:this.config.logEvent.url,type:"POST",beforeSend:function(xhr){xhr.setRequestHeader("x-api-key",api_token)},contentType:"application/json",data:JSON.stringify(json),error:function(xhr,error){self.log(1,"cnLogSvc.logEvent (1)",{url:self.config.logEvent.url,readyState:xhr.readyState,responseText:xhr.responseText,status:xhr.status,statusText:xhr.statusText},json);$.ajax({url:self.config.logEvent.url,type:"POST",beforeSend:function(xhr){xhr.setRequestHeader("x-api-key",api_token)},contentType:"application/json",data:JSON.stringify(json),error:function(xhr,error){self.log(1,"cnLogSvc.logEvent (2)",{url:self.config.logEvent.url,readyState:xhr.readyState,responseText:xhr.responseText,status:xhr.status,statusText:xhr.statusText},json)}})}});logLocally=this.config.logEvent.dup_local?true:false}catch(e){this.log(1,"cnLogSvc.logEvent (api)",e)}}if(logLocally){var beaconFailed=true;if(beaconFailed){try{$.ajax({url:"/dealers/log_event",type:"POST",headers:{"X-CSRF-Token":CN.csrfToken()},data:json,error:function(xhr,error){self.log(1,"cnLogSvc.logEvent (1)",{url:"/dealers/log_event",readyState:xhr.readyState,responseText:xhr.responseText,status:xhr.status,statusText:xhr.statusText},json);$.ajax({url:"/dealers/log_event",type:"POST",headers:{"X-CSRF-Token":CN.csrfToken()},data:json,error:function(xhr,error){self.log(1,"cnLogSvc.logEvent (2)",{url:"/dealers/log_event",readyState:xhr.readyState,responseText:xhr.responseText,status:xhr.status,statusText:xhr.statusText},json)}})}})}catch(e){this.log(1,"cnLogSvc.logEvent (log_event)",e)}}}},logTrace:function(type,action,options){if(this.config.logTrace&&this.config.logTrace.url){try{var json=options?options:{};this._counter.traceLogIndex+=1;json.instance_id=this.context.initTS;json.sort_order=this._counter.traceLogIndex;if(!json.source){json.source=this.context.source}if(!json.version){json.version=this.context.version}if(!json.src_rel){json.src_rel=this.context.src_rel}json.trace_type=type;json.trace_action=action;json.visit_id=this.context.visitId;json.user_id=this.context.userId;json.dealer_id=this.context.dealerId;json.chat_session_id=this.context.chatSessionId;json.title=document.title;json.url=window.location.href;json.url_base=json.url.split("?")[0];if(CN){json.status=JSON.stringify(CN.getStatus())}if(type=="logSvc"&&action=="init"){json.string_01=document.referrer;json.string_02=json.string_01.split("?")[0]}json.recording=typeof(LogRocket)!=="undefined"?LogRocket.sessionURL:null;this.logTraceJson(json)}catch(e){this.log(1,"cnLogSvc.logTrace",e)}}},logTraceJson:function(json){if(this.config.logTrace&&this.config.logTrace.url){var self=this;var logLocally=false;this.log(15,"cnLogSvc.logTraceJson",json);if(this.config.logTrace.token){try{var api_token=this.config.logTrace.token;$.ajax({url:this.config.logTrace.url,type:"POST",beforeSend:function(xhr){xhr.setRequestHeader("x-api-key",api_token)},contentType:"application/json",data:JSON.stringify(json),error:function(xhr,error){self.log(1,"cnLogSvc.logTraceJson (1)",{url:self.config.logTrace.url,readyState:xhr.readyState,responseText:xhr.responseText,status:xhr.status,statusText:xhr.statusText},json);$.ajax({url:self.config.logTrace.url,type:"POST",beforeSend:function(xhr){xhr.setRequestHeader("x-api-key",api_token)},contentType:"application/json",data:JSON.stringify(json),error:function(xhr,error){self.log(1,"cnLogSvc.logTraceJson (2)",{url:self.config.logTrace.url,readyState:xhr.readyState,responseText:xhr.responseText,status:xhr.status,statusText:xhr.statusText},json)}})}});logLocally=this.config.logTrace.dup_local?true:false}catch(e){this.log(1,"cnLogSvc.logTraceJson (api)",e)}}if(logLocally){try{$.ajax({url:"/dealers/log_trace",type:"POST",headers:{"X-CSRF-Token":CN.csrfToken()},data:json,error:function(xhr,error){self.log(1,"cnLogSvc.logTraceJson (1)",{url:"/dealers/log_trace",readyState:xhr.readyState,responseText:xhr.responseText,status:xhr.status,statusText:xhr.statusText},json);$.ajax({url:"/dealers/log_trace",type:"POST",headers:{"X-CSRF-Token":CN.csrfToken()},data:json,error:function(xhr,error){self.log(1,"cnLogSvc.logTraceJson (2)",{url:"/dealers/log_trace",readyState:xhr.readyState,responseText:xhr.responseText,status:xhr.status,statusText:xhr.statusText},json)}})}})}catch(e){this.log(1,"cnLogSvc.logTraceJson (log_trace)",e)}}}},onLogTraceInterval:function(){this.logTraceIntervalCounter+=1;this.logTrace("logSvc","interval",{int_01:this.logTraceIntervalCounter})},logToExtService:function(json,error){if(this.rollbar&&this.config.noRollbar!=1){try{if(json.params.isError||json.params.level==1||json.extSvc){var logged=false;if(json.extSvc){logged=true;if(json.extSvc.track){this.rollbar.critical(json.params.message,json.extSvc.track)}else{if(json.extSvc.warn){this.rollbar.warning(json.params.message,json.extSvc.warn)}else{if(json.extSvc.info){this.rollbar.info(json.params.message,json.extSvc.info)}else{if(json.extSvc.debug){this.rollbar.debug(json.params.message,json.extSvc.debug)}else{if(json.extSvc.log){this.rollbar.debug(json.params.message,json.extSvc.log)}else{logged=false}}}}}}if(error){this.rollbar.error(json.params.message,error)}else{if(!logged){this.rollbar.error(json.params.message)}}}else{if(this.config.rollbarLevel){if(json.params.level<=this.config.rollbarLevel){switch(json.params.level){case 2:this.rollbar.warning(json.params.message,json);break;case 3:this.rollbar.info(json.params.message,json);break;case 4:this.rollbar.debug(json.params.message,json);break;default:this.rollbar.debug(json.params.message,json)}}}}}catch(e){}}},addExtSvcUserData:function(user){if(typeof(user)!=="undefined"||this.context.visitId){try{var username="";if(typeof(user)!=="undefined"){username=user.name=="guest"?"guest ("+user.id+")":user.name}else{username="Visit ("+this.context.visitId+")";user={id:this.context.visitId,name:"Visit",email:""}}if(typeof(Rollbar)!=="undefined"){Rollbar.configure({payload:{person:{id:user.id,username:username,email:user.email},session:{user:user.name,userId:user.id}}})}if(typeof(LogRocket)!=="undefined"){if(!this.context.name){this.context.name=username}if(!this.context.email){this.context.email=user.email}LogRocket.identify(user.id,this.context);if(typeof(Rollbar)!=="undefined"){Rollbar.configure({transform:function(obj){obj.sessionURL=LogRocket.sessionURL}})}}}catch(e){}}},addExtSvcTag:function(event){if(typeof(LogRocket)!=="undefined"){LogRocket.track(event)}},addExtSvcMetadata:function(key,value){if(typeof(value)!=="undefined"){if(key=="vstid"){this.context.visitId=value;if(typeof(LogRocket)!=="undefined"){LogRocket.identify({visitId:value})}}if(typeof(Rollbar)!=="undefined"){var payload={payload:{session:{}}};payload.payload["session"][key]=value;Rollbar.configure(payload)}}}};var cnLogSvc=new CNLogSvc();window.onbeforeunload=function(){cnLogSvc.logTrace("logSvc","unload")};
/*! URI.js v1.18.1 http://medialize.github.io/URI.js/ */
(function(n,v){"object"===typeof exports?module.exports=v(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"===typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],v):n.URI=v(n.punycode,n.IPv6,n.SecondLevelDomains,n)})(this,function(n,v,t,h){function d(a,b){var c=1<=arguments.length,g=2<=arguments.length;if(!(this instanceof d)){return c?g?new d(a,b):new d(a):new d}if(void 0===a){if(c){throw new TypeError("undefined is not a valid argument for URI")}a="undefined"!==typeof location?location.href+"":""}this.href(a);return void 0!==b?this.absoluteTo(b):this}function q(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function k(a){return"Array"===u(a)}function C(a,b){var c={},d,f;if("RegExp"===u(b)){c=null}else{if(k(b)){for(d=0,f=b.length;d<f;d++){c[b[d]]=!0}}else{c[b]=!0}}d=0;for(f=a.length;d<f;d++){if(c&&void 0!==c[a[d]]||!c&&b.test(a[d])){a.splice(d,1),f--,d--}}return a}function y(a,b){var c,d;if(k(b)){c=0;for(d=b.length;c<d;c++){if(!y(a,b[c])){return !1}}return !0}var f=u(b);c=0;for(d=a.length;c<d;c++){if("RegExp"===f){if("string"===typeof a[c]&&a[c].match(b)){return !0}}else{if(a[c]===b){return !0}}}return !1}function D(a,b){if(!k(a)||!k(b)||a.length!==b.length){return !1}a.sort();b.sort();for(var c=0,d=a.length;c<d;c++){if(a[c]!==b[c]){return !1}}return !0}function z(a){return a.replace(/^\/+|\/+$/g,"")}function F(a){return escape(a)}function A(a){return encodeURIComponent(a).replace(/[!'()*]/g,F).replace(/\*/g,"%2A")}function w(a){return function(b,c){if(void 0===b){return this._parts[a]||""}this._parts[a]=b||null;this.build(!c);return this}}function E(a,b){return function(c,d){if(void 0===c){return this._parts[a]||""}null!==c&&(c+="",c.charAt(0)===b&&(c=c.substring(1)));this._parts[a]=c;this.build(!d);return this}}var G=h&&h.URI;d.version="1.18.1";var e=d.prototype,p=Object.prototype.hasOwnProperty;d._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:d.duplicateQueryParameters,escapeQuerySpace:d.escapeQuerySpace}};d.duplicateQueryParameters=!1;d.escapeQuerySpace=!0;d.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;d.idn_expression=/[^a-z0-9\.-]/i;d.punycode_expression=/(xn--)/i;d.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;d.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;d.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig;d.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/};d.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};d.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;d.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"};d.getDomAttribute=function(a){if(a&&a.nodeName){var b=a.nodeName.toLowerCase();return"input"===b&&"image"!==a.type?void 0:d.domAttributes[b]}};d.encode=A;d.decode=decodeURIComponent;d.iso8859=function(){d.encode=escape;d.decode=unescape};d.unicode=function(){d.encode=A;d.decode=decodeURIComponent};d.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}};d.encodeQuery=function(a,b){var c=d.encode(a+"");void 0===b&&(b=d.escapeQuerySpace);return b?c.replace(/%20/g,"+"):c};d.decodeQuery=function(a,b){a+="";void 0===b&&(b=d.escapeQuerySpace);try{return d.decode(b?a.replace(/\+/g,"%20"):a)}catch(c){return a}};var r={encode:"encode",decode:"decode"},x,B=function(a,b){return function(c){try{return d[b](c+"").replace(d.characters[a][b].expression,function(c){return d.characters[a][b].map[c]})}catch(g){return c}}};for(x in r){d[x+"PathSegment"]=B("pathname",r[x]),d[x+"UrnPathSegment"]=B("urnpath",r[x])}r=function(a,b,c){return function(g){var f;f=c?function(a){return d[b](d[c](a))}:d[b];g=(g+"").split(a);for(var e=0,l=g.length;e<l;e++){g[e]=f(g[e])}return g.join(a)}};d.decodePath=r("/","decodePathSegment");d.decodeUrnPath=r(":","decodeUrnPathSegment");d.recodePath=r("/","encodePathSegment","decode");d.recodeUrnPath=r(":","encodeUrnPathSegment","decode");d.encodeReserved=B("reserved","encode");d.parse=function(a,b){var c;b||(b={});c=a.indexOf("#");-1<c&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c));c=a.indexOf("?");-1<c&&(b.query=a.substring(c+1)||null,a=a.substring(0,c));"//"===a.substring(0,2)?(b.protocol=null,a=a.substring(2),a=d.parseAuthority(a,b)):(c=a.indexOf(":"),-1<c&&(b.protocol=a.substring(0,c)||null,b.protocol&&!b.protocol.match(d.protocol_expression)?b.protocol=void 0:"//"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=d.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0)));b.path=a;return b};d.parseHost=function(a,b){a=a.replace(/\\/g,"/");var c=a.indexOf("/"),d;-1===c&&(c=a.length);if("["===a.charAt(0)){d=a.indexOf("]"),b.hostname=a.substring(1,d)||null,b.port=a.substring(d+2,c)||null,"/"===b.port&&(b.port=null)}else{var f=a.indexOf(":");d=a.indexOf("/");f=a.indexOf(":",f+1);-1!==f&&(-1===d||f<d)?(b.hostname=a.substring(0,c)||null,b.port=null):(d=a.substring(0,c).split(":"),b.hostname=d[0]||null,b.port=d[1]||null)}b.hostname&&"/"!==a.substring(c).charAt(0)&&(c++,a="/"+a);return a.substring(c)||"/"};d.parseAuthority=function(a,b){a=d.parseUserinfo(a,b);return d.parseHost(a,b)};d.parseUserinfo=function(a,b){var c=a.indexOf("/"),g=a.lastIndexOf("@",-1<c?c:a.length-1);-1<g&&(-1===c||g<c)?(c=a.substring(0,g).split(":"),b.username=c[0]?d.decode(c[0]):null,c.shift(),b.password=c[0]?d.decode(c.join(":")):null,a=a.substring(g+1)):(b.username=null,b.password=null);return a};d.parseQuery=function(a,b){if(!a){return{}}a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!a){return{}}for(var c={},g=a.split("&"),f=g.length,e,l,m=0;m<f;m++){if(e=g[m].split("="),l=d.decodeQuery(e.shift(),b),e=e.length?d.decodeQuery(e.join("="),b):null,p.call(c,l)){if("string"===typeof c[l]||null===c[l]){c[l]=[c[l]]}c[l].push(e)}else{c[l]=e}}return c};d.build=function(a){var b="";a.protocol&&(b+=a.protocol+":");a.urn||!b&&!a.hostname||(b+="//");b+=d.buildAuthority(a)||"";"string"===typeof a.path&&("/"!==a.path.charAt(0)&&"string"===typeof a.hostname&&(b+="/"),b+=a.path);"string"===typeof a.query&&a.query&&(b+="?"+a.query);"string"===typeof a.fragment&&a.fragment&&(b+="#"+a.fragment);return b};d.buildHost=function(a){var b="";if(a.hostname){b=d.ip6_expression.test(a.hostname)?b+("["+a.hostname+"]"):b+a.hostname}else{return""}a.port&&(b+=":"+a.port);return b};d.buildAuthority=function(a){return d.buildUserinfo(a)+d.buildHost(a)};d.buildUserinfo=function(a){var b="";a.username&&(b+=d.encode(a.username));a.password&&(b+=":"+d.encode(a.password));b&&(b+="@");return b};d.buildQuery=function(a,b,c){var g="",f,e,l,m;for(e in a){if(p.call(a,e)&&e){if(k(a[e])){for(f={},l=0,m=a[e].length;l<m;l++){void 0!==a[e][l]&&void 0===f[a[e][l]+""]&&(g+="&"+d.buildQueryParameter(e,a[e][l],c),!0!==b&&(f[a[e][l]+""]=!0))}}else{void 0!==a[e]&&(g+="&"+d.buildQueryParameter(e,a[e],c))}}}return g.substring(1)};d.buildQueryParameter=function(a,b,c){return d.encodeQuery(a,c)+(null!==b?"="+d.encodeQuery(b,c):"")};d.addQuery=function(a,b,c){if("object"===typeof b){for(var g in b){p.call(b,g)&&d.addQuery(a,g,b[g])}}else{if("string"===typeof b){void 0===a[b]?a[b]=c:("string"===typeof a[b]&&(a[b]=[a[b]]),k(c)||(c=[c]),a[b]=(a[b]||[]).concat(c))}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}};d.removeQuery=function(a,b,c){var g;if(k(b)){for(c=0,g=b.length;c<g;c++){a[b[c]]=void 0}}else{if("RegExp"===u(b)){for(g in a){b.test(g)&&(a[g]=void 0)}}else{if("object"===typeof b){for(g in b){p.call(b,g)&&d.removeQuery(a,g,b[g])}}else{if("string"===typeof b){void 0!==c?"RegExp"===u(c)?!k(a[b])&&c.test(a[b])?a[b]=void 0:a[b]=C(a[b],c):a[b]!==String(c)||k(c)&&1!==c.length?k(a[b])&&(a[b]=C(a[b],c)):a[b]=void 0:a[b]=void 0}else{throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")}}}}};d.hasQuery=function(a,b,c,g){switch(u(b)){case"String":break;case"RegExp":for(var f in a){if(p.call(a,f)&&b.test(f)&&(void 0===c||d.hasQuery(a,f,c))){return !0}}return !1;case"Object":for(var e in b){if(p.call(b,e)&&!d.hasQuery(a,e,b[e])){return !1}}return !0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(c)){case"Undefined":return b in a;case"Boolean":return a=!(k(a[b])?!a[b].length:!a[b]),c===a;case"Function":return !!c(a[b],b,a);case"Array":return k(a[b])?(g?y:D)(a[b],c):!1;case"RegExp":return k(a[b])?g?y(a[b],c):!1:!(!a[b]||!a[b].match(c));case"Number":c=String(c);case"String":return k(a[b])?g?y(a[b],c):!1:a[b]===c;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}};d.joinPaths=function(){for(var a=[],b=[],c=0,g=0;g<arguments.length;g++){var f=new d(arguments[g]);a.push(f);for(var f=f.segment(),e=0;e<f.length;e++){"string"===typeof f[e]&&b.push(f[e]),f[e]&&c++}}if(!b.length||!c){return new d("")}b=(new d("")).segment(b);""!==a[0].path()&&"/"!==a[0].path().slice(0,1)||b.path("/"+b.path());return b.normalize()};d.commonPath=function(a,b){var c=Math.min(a.length,b.length),d;for(d=0;d<c;d++){if(a.charAt(d)!==b.charAt(d)){d--;break}}if(1>d){return a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":""}if("/"!==a.charAt(d)||"/"!==b.charAt(d)){d=a.substring(0,d).lastIndexOf("/")}return a.substring(0,d+1)};d.withinString=function(a,b,c){c||(c={});var g=c.start||d.findUri.start,e=c.end||d.findUri.end,H=c.trim||d.findUri.trim,l=/[a-z0-9-]=["']?$/i;for(g.lastIndex=0;;){var m=g.exec(a);if(!m){break}m=m.index;if(c.ignoreHtml){var k=a.slice(Math.max(m-3,0),m);if(k&&l.test(k)){continue}}var k=m+a.slice(m).search(e),h=a.slice(m,k).replace(H,"");c.ignore&&c.ignore.test(h)||(k=m+h.length,h=b(h,m,k,a),a=a.slice(0,m)+h+a.slice(k),g.lastIndex=m+h.length)}g.lastIndex=0;return a};d.ensureValidHostname=function(a){if(a.match(d.invalid_hostname_characters)){if(!n){throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available')}if(n.toASCII(a).match(d.invalid_hostname_characters)){throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]')}}};d.noConflict=function(a){if(a){return a={URI:this.noConflict()},h.URITemplate&&"function"===typeof h.URITemplate.noConflict&&(a.URITemplate=h.URITemplate.noConflict()),h.IPv6&&"function"===typeof h.IPv6.noConflict&&(a.IPv6=h.IPv6.noConflict()),h.SecondLevelDomains&&"function"===typeof h.SecondLevelDomains.noConflict&&(a.SecondLevelDomains=h.SecondLevelDomains.noConflict()),a}h.URI===this&&(h.URI=G);return this};e.build=function(a){if(!0===a){this._deferred_build=!0}else{if(void 0===a||this._deferred_build){this._string=d.build(this._parts),this._deferred_build=!1}}return this};e.clone=function(){return new d(this)};e.valueOf=e.toString=function(){return this.build(!1)._string};e.protocol=w("protocol");e.username=w("username");e.password=w("password");e.hostname=w("hostname");e.port=w("port");e.query=E("query","?");e.fragment=E("fragment","#");e.search=function(a,b){var c=this.query(a,b);return"string"===typeof c&&c.length?"?"+c:c};e.hash=function(a,b){var c=this.fragment(a,b);return"string"===typeof c&&c.length?"#"+c:c};e.pathname=function(a,b){if(void 0===a||!0===a){var c=this._parts.path||(this._parts.hostname?"/":"");return a?(this._parts.urn?d.decodeUrnPath:d.decodePath)(c):c}this._parts.path=this._parts.urn?a?d.recodeUrnPath(a):"":a?d.recodePath(a):"/";this.build(!b);return this};e.path=e.pathname;e.href=function(a,b){var c;if(void 0===a){return this.toString()}this._string="";this._parts=d._parts();var g=a instanceof d,e="object"===typeof a&&(a.hostname||a.path||a.pathname);a.nodeName&&(e=d.getDomAttribute(a),a=a[e]||"",e=!1);!g&&e&&void 0!==a.pathname&&(a=a.toString());if("string"===typeof a||a instanceof String){this._parts=d.parse(String(a),this._parts)}else{if(g||e){for(c in g=g?a._parts:a,g){p.call(this._parts,c)&&(this._parts[c]=g[c])}}else{throw new TypeError("invalid input")}}this.build(!b);return this};e.is=function(a){var b=!1,c=!1,g=!1,e=!1,k=!1,l=!1,m=!1,h=!this._parts.urn;this._parts.hostname&&(h=!1,c=d.ip4_expression.test(this._parts.hostname),g=d.ip6_expression.test(this._parts.hostname),b=c||g,k=(e=!b)&&t&&t.has(this._parts.hostname),l=e&&d.idn_expression.test(this._parts.hostname),m=e&&d.punycode_expression.test(this._parts.hostname));switch(a.toLowerCase()){case"relative":return h;case"absolute":return !h;case"domain":case"name":return e;case"sld":return k;case"ip":return b;case"ip4":case"ipv4":case"inet4":return c;case"ip6":case"ipv6":case"inet6":return g;case"idn":return l;case"url":return !this._parts.urn;case"urn":return !!this._parts.urn;case"punycode":return m}return null};var I=e.protocol,J=e.port,K=e.hostname;e.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\/\/)?$/,""),!a.match(d.protocol_expression))){throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]")}return I.call(this,a,b)};e.scheme=e.protocol;e.port=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/)))){throw new TypeError('Port "'+a+'" contains characters other than [0-9]')}return J.call(this,a,b)};e.hostname=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0!==a){var c={};if("/"!==d.parseHost(a,c)){throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]')}a=c.hostname}return K.call(this,a,b)};e.origin=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0===a){var c=this.protocol();return this.authority()?(c?c+"://":"")+this.authority():""}c=d(a);this.protocol(c.protocol()).authority(c.authority()).build(!b);return this};e.host=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0===a){return this._parts.hostname?d.buildHost(this._parts):""}if("/"!==d.parseHost(a,this._parts)){throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]')}this.build(!b);return this};e.authority=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0===a){return this._parts.hostname?d.buildAuthority(this._parts):""}if("/"!==d.parseAuthority(a,this._parts)){throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]')}this.build(!b);return this};e.userinfo=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0===a){var c=d.buildUserinfo(this._parts);return c?c.substring(0,c.length-1):c}"@"!==a[a.length-1]&&(a+="@");d.parseUserinfo(a,this._parts);this.build(!b);return this};e.resource=function(a,b){var c;if(void 0===a){return this.path()+this.search()+this.hash()}c=d.parse(a);this._parts.path=c.path;this._parts.query=c.query;this._parts.fragment=c.fragment;this.build(!b);return this};e.subdomain=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0===a){if(!this._parts.hostname||this.is("IP")){return""}var c=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,c)||""}c=this._parts.hostname.length-this.domain().length;c=this._parts.hostname.substring(0,c);c=new RegExp("^"+q(c));a&&"."!==a.charAt(a.length-1)&&(a+=".");a&&d.ensureValidHostname(a);this._parts.hostname=this._parts.hostname.replace(c,a);this.build(!b);return this};e.domain=function(a,b){if(this._parts.urn){return void 0===a?"":this}"boolean"===typeof a&&(b=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is("IP")){return""}var c=this._parts.hostname.match(/\./g);if(c&&2>c.length){return this._parts.hostname}c=this._parts.hostname.length-this.tld(b).length-1;c=this._parts.hostname.lastIndexOf(".",c-1)+1;return this._parts.hostname.substring(c)||""}if(!a){throw new TypeError("cannot set domain empty")}d.ensureValidHostname(a);!this._parts.hostname||this.is("IP")?this._parts.hostname=a:(c=new RegExp(q(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a));this.build(!b);return this};e.tld=function(a,b){if(this._parts.urn){return void 0===a?"":this}"boolean"===typeof a&&(b=a,a=void 0);if(void 0===a){if(!this._parts.hostname||this.is("IP")){return""}var c=this._parts.hostname.lastIndexOf("."),c=this._parts.hostname.substring(c+1);return !0!==b&&t&&t.list[c.toLowerCase()]?t.get(this._parts.hostname)||c:c}if(a){if(a.match(/[^a-zA-Z0-9-]/)){if(t&&t.is(a)){c=new RegExp(q(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(c,a)}else{throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]')}}else{if(!this._parts.hostname||this.is("IP")){throw new ReferenceError("cannot set TLD on non-domain host")}c=new RegExp(q(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(c,a)}}else{throw new TypeError("cannot set TLD empty")}this.build(!b);return this};e.directory=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0===a||!0===a){if(!this._parts.path&&!this._parts.hostname){return""}if("/"===this._parts.path){return"/"}var c=this._parts.path.length-this.filename().length-1,c=this._parts.path.substring(0,c)||(this._parts.hostname?"/":"");return a?d.decodePath(c):c}c=this._parts.path.length-this.filename().length;c=this._parts.path.substring(0,c);c=new RegExp("^"+q(c));this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a));a&&"/"!==a.charAt(a.length-1)&&(a+="/");a=d.recodePath(a);this._parts.path=this._parts.path.replace(c,a);this.build(!b);return this};e.filename=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path){return""}var c=this._parts.path.lastIndexOf("/"),c=this._parts.path.substring(c+1);return a?d.decodePathSegment(c):c}c=!1;"/"===a.charAt(0)&&(a=a.substring(1));a.match(/\.?\//)&&(c=!0);var g=new RegExp(q(this.filename())+"$");a=d.recodePath(a);this._parts.path=this._parts.path.replace(g,a);c?this.normalizePath(b):this.build(!b);return this};e.suffix=function(a,b){if(this._parts.urn){return void 0===a?"":this}if(void 0===a||!0===a){if(!this._parts.path||"/"===this._parts.path){return""}var c=this.filename(),g=c.lastIndexOf(".");if(-1===g){return""}c=c.substring(g+1);c=/^[a-z0-9%]+$/i.test(c)?c:"";return a?d.decodePathSegment(c):c}"."===a.charAt(0)&&(a=a.substring(1));if(c=this.suffix()){g=a?new RegExp(q(c)+"$"):new RegExp(q("."+c)+"$")}else{if(!a){return this}this._parts.path+="."+d.recodePath(a)}g&&(a=d.recodePath(a),this._parts.path=this._parts.path.replace(g,a));this.build(!b);return this};e.segment=function(a,b,c){var d=this._parts.urn?":":"/",e=this.path(),h="/"===e.substring(0,1),e=e.split(d);void 0!==a&&"number"!==typeof a&&(c=b,b=a,a=void 0);if(void 0!==a&&"number"!==typeof a){throw Error('Bad segment "'+a+'", must be 0-based integer')}h&&e.shift();0>a&&(a=Math.max(e.length+a,0));if(void 0===b){return void 0===a?e:e[a]}if(null===a||void 0===e[a]){if(k(b)){e=[];a=0;for(var l=b.length;a<l;a++){if(b[a].length||e.length&&e[e.length-1].length){e.length&&!e[e.length-1].length&&e.pop(),e.push(z(b[a]))}}}else{if(b||"string"===typeof b){b=z(b),""===e[e.length-1]?e[e.length-1]=b:e.push(b)}}}else{b?e[a]=z(b):e.splice(a,1)}h&&e.unshift("");return this.path(e.join(d),c)};e.segmentCoded=function(a,b,c){var e,f;"number"!==typeof a&&(c=b,b=a,a=void 0);if(void 0===b){a=this.segment(a,b,c);if(k(a)){for(e=0,f=a.length;e<f;e++){a[e]=d.decode(a[e])}}else{a=void 0!==a?d.decode(a):void 0}return a}if(k(b)){for(e=0,f=b.length;e<f;e++){b[e]=d.encode(b[e])}}else{b="string"===typeof b||b instanceof String?d.encode(b):b}return this.segment(a,b,c)};var L=e.query;e.query=function(a,b){if(!0===a){return d.parseQuery(this._parts.query,this._parts.escapeQuerySpace)}if("function"===typeof a){var c=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace),e=a.call(this,c);this._parts.query=d.buildQuery(e||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!b);return this}return void 0!==a&&"string"!==typeof a?(this._parts.query=d.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):L.call(this,a,b)};e.setQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"===typeof a||a instanceof String){e[a]=void 0!==b?b:null}else{if("object"===typeof a){for(var f in a){p.call(a,f)&&(e[f]=a[f])}}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof a&&(c=b);this.build(!c);return this};e.addQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);d.addQuery(e,a,void 0===b?null:b);this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof a&&(c=b);this.build(!c);return this};e.removeQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);d.removeQuery(e,a,b);this._parts.query=d.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);"string"!==typeof a&&(c=b);this.build(!c);return this};e.hasQuery=function(a,b,c){var e=d.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return d.hasQuery(e,a,b,c)};e.setSearch=e.setQuery;e.addSearch=e.addQuery;e.removeSearch=e.removeQuery;e.hasSearch=e.hasQuery;e.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()};e.normalizeProtocol=function(a){"string"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a));return this};e.normalizeHostname=function(a){this._parts.hostname&&(this.is("IDN")&&n?this._parts.hostname=n.toASCII(this._parts.hostname):this.is("IPv6")&&v&&(this._parts.hostname=v.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!a));return this};e.normalizePort=function(a){"string"===typeof this._parts.protocol&&this._parts.port===d.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a));return this};e.normalizePath=function(a){var b=this._parts.path;if(!b){return this}if(this._parts.urn){return this._parts.path=d.recodeUrnPath(this._parts.path),this.build(!a),this}if("/"===this._parts.path){return this}var b=d.recodePath(b),c,e="",f,k;"/"!==b.charAt(0)&&(c=!0,b="/"+b);if("/.."===b.slice(-3)||"/."===b.slice(-2)){b+="/"}b=b.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");c&&(e=b.substring(1).match(/^(\.\.\/)+/)||"")&&(e=e[0]);for(;;){f=b.search(/\/\.\.(\/|$)/);if(-1===f){break}else{if(0===f){b=b.substring(3);continue}}k=b.substring(0,f).lastIndexOf("/");-1===k&&(k=f);b=b.substring(0,k)+b.substring(f+3)}c&&this.is("relative")&&(b=e+b.substring(1));this._parts.path=b;this.build(!a);return this};e.normalizePathname=e.normalizePath;e.normalizeQuery=function(a){"string"===typeof this._parts.query&&(this._parts.query.length?this.query(d.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a));return this};e.normalizeFragment=function(a){this._parts.fragment||(this._parts.fragment=null,this.build(!a));return this};e.normalizeSearch=e.normalizeQuery;e.normalizeHash=e.normalizeFragment;e.iso8859=function(){var a=d.encode,b=d.decode;d.encode=escape;d.decode=decodeURIComponent;try{this.normalize()}finally{d.encode=a,d.decode=b}return this};e.unicode=function(){var a=d.encode,b=d.decode;d.encode=A;d.decode=unescape;try{this.normalize()}finally{d.encode=a,d.decode=b}return this};e.readable=function(){var a=this.clone();a.username("").password("").normalize();var b="";a._parts.protocol&&(b+=a._parts.protocol+"://");a._parts.hostname&&(a.is("punycode")&&n?(b+=n.toUnicode(a._parts.hostname),a._parts.port&&(b+=":"+a._parts.port)):b+=a.host());a._parts.hostname&&a._parts.path&&"/"!==a._parts.path.charAt(0)&&(b+="/");b+=a.path(!0);if(a._parts.query){for(var c="",e=0,f=a._parts.query.split("&"),k=f.length;e<k;e++){var l=(f[e]||"").split("="),c=c+("&"+d.decodeQuery(l[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"));void 0!==l[1]&&(c+="="+d.decodeQuery(l[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}b+="?"+c.substring(1)}return b+=d.decodeQuery(a.hash(),!0)};e.absoluteTo=function(a){var b=this.clone(),c=["protocol","username","password","hostname","port"],e,f;if(this._parts.urn){throw Error("URNs do not have any generally defined hierarchical components")}a instanceof d||(a=new d(a));b._parts.protocol||(b._parts.protocol=a._parts.protocol);if(this._parts.hostname){return b}for(e=0;f=c[e];e++){b._parts[f]=a._parts[f]}b._parts.path?".."===b._parts.path.substring(-2)&&(b._parts.path+="/"):(b._parts.path=a._parts.path,b._parts.query||(b._parts.query=a._parts.query));"/"!==b.path().charAt(0)&&(c=(c=a.directory())?c:0===a.path().indexOf("/")?"/":"",b._parts.path=(c?c+"/":"")+b._parts.path,b.normalizePath());b.build();return b};e.relativeTo=function(a){var b=this.clone().normalize(),c,e,f;if(b._parts.urn){throw Error("URNs do not have any generally defined hierarchical components")}a=(new d(a)).normalize();c=b._parts;e=a._parts;f=b.path();a=a.path();if("/"!==f.charAt(0)){throw Error("URI is already relative")}if("/"!==a.charAt(0)){throw Error("Cannot calculate a URI relative to another relative URI")}c.protocol===e.protocol&&(c.protocol=null);if(c.username===e.username&&c.password===e.password&&null===c.protocol&&null===c.username&&null===c.password&&c.hostname===e.hostname&&c.port===e.port){c.hostname=null,c.port=null}else{return b.build()}if(f===a){return c.path="",b.build()}f=d.commonPath(f,a);if(!f){return b.build()}e=e.path.substring(f.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");c.path=e+c.path.substring(f.length)||"./";return b.build()};e.equals=function(a){var b=this.clone(),c=new d(a),e;a={};var f,h;b.normalize();c.normalize();if(b.toString()===c.toString()){return !0}f=b.query();e=c.query();b.query("");c.query("");if(b.toString()!==c.toString()||f.length!==e.length){return !1}b=d.parseQuery(f,this._parts.escapeQuerySpace);e=d.parseQuery(e,this._parts.escapeQuerySpace);for(h in b){if(p.call(b,h)){if(!k(b[h])){if(b[h]!==e[h]){return !1}}else{if(!D(b[h],e[h])){return !1}}a[h]=!0}}for(h in e){if(p.call(e,h)&&!a[h]){return !1}}return !0};e.duplicateQueryParameters=function(a){this._parts.duplicateQueryParameters=!!a;return this};e.escapeQuerySpace=function(a){this._parts.escapeQuerySpace=!!a;return this};return d});
/*!
 * CarNow v1.0
 * http://carnow.com/
 * Copyright 2015 CarNow, Inc.
 */
;var CN={ONLINE_STATUS:{ONLINE:1,OFFLINE:0,AWAY:2,BUSY:3},MESSAGE:{TYPE_SILENT:-1,TYPE_USER_LEFT:0,TYPE_DEFAULT:1,TYPE_DEALER_JOINED:2,TYPE_EVENT:3,TYPE_USER_JOINED:4,TYPE_APPOINTMENT:5,TYPE_NOTE_TEXT:6,TYPE_NOTE_PC:7,TYPE_USER_STATUS_CHANGED:8,TYPE_MERGE_CUSTOMER:9,TYPE_RED_ALERT:10,TYPE_MSG_DELIVERED:11,TYPE_CUST_STATUS:12,TYPE_AGENT_LEFT:13,TYPE_SMS_OPT:50,TYPE_FORM_INPUT:59,TYPE_TRADE_FORM:60,TYPE_CREDIT_FORM:61,TYPE_CREDIT_DECISION:63,TYPE_QUESTION:70,TYPE_QUESTION_ANSWER:71,TYPE_VIDEO_CHAT_REQUEST:120,TYPE_VIDEO_CHAT_AVAILABLE:121,TYPE_VIDEO_CHAT_CONNECTED:122,TYPE_VIDEO_CHAT_ENDED:123,TYPE_EXPORT_UPDATE:201,TYPE_UI_STEP:300,TYPE_POKE:500,TYPE_SYS_POKE:501,CAT_MESSAGE:1,CAT_DEALER_JOINED:3,CAT_DEALER_ACCEPTED:7,CAT_MSG_DELIVERED:17,CAT_MODEL_UPDATE:19,CATEGORY_SMS_OPT:50,EVENT_DEFAULT:0,EVENT_ENTERED:1,EVENT_EXITED:2,EVENT_PROVIDED_CONTACT:3,EVENT_VIEWED_LISTING:4,EVENT_VIEWED_MODEL:5,EVENT_VIEWED_VIDEO:6,EVENT_VIEWED_LINK:7,EVENT_VIEWED_COMPARISON:8,EVENT_RATED:9,EVENT_TRANSFER:10,EVENT_URL_VISIT:11,EVENT_REJOINED:12,EVENT_NOT_AVAIL_SHOWN:13,EVENT_CUST_XMPP_CONNECT:14,EVENT_CUST_AWAY:15,EVENT_CUST_EXITED:16,EVENT_CUST_BACK:17,EVENT_SESSION_CLOSED:19,EVENT_UPDATE:20,EVENT_CAR_DETAILS:21,EVENT_LEAD_ELIGBLE:22,EVENT_SILENT_JOINED:23,EVENT_CUST_UNSUB:24,EVENT_CUST_RESUB:25,EVENT_CUST_SMS_SUB:26,EVENT_VALIDATION:52,EVENT_BN_TRIGGER:700,EVENT_BN_OFFER:704,EVENT_BN_OFFER_DEALER_ACCEPT:710,EVENT_BN_OFFER_CUST_ACCEPT:711,EVENT_APP_NOTIFICATION:8999},TRANSFER:{STATUS_PENDING:0,STATUS_ACCEPTED:1,STATUS_DECLINED:-1,STATUS_TIMEOUT:-2},OWNER:{GROUP:1,ORG:2,ME:3,PARTNER:4,POKE:20,RECENTLY_USED:50,FREQUENTLY_USED:51,VIDEO_BRAND_CHANNEL:1,BRAND:500,SEARCH:100},ATTACHMENT:{TYPE_CAR:1,TYPE_COMPARISON:2,TYPE_VIDEO:3,TYPE_REVIEW:4,TYPE_INVENTORY:5,TYPE_OFFER:6,TYPE_FILE:7,TYPE_CAR_PART:8,TYPE_RV_TRIM:16,TYPE_RV:17,TYPE_MOTORCYCLE:32,TYPE_UTV:33,TYPE_ATV:34,TYPE_WARRANTY_CAR:64,TYPE_WARRANTY:65,TYPE_PROTECTION:66,TYPE_PERSONNEL:100,TYPE_HOURS:101,TYPE_FEATURE:102,TYPE_PAYMENT:200,TYPE_NOTES:901,TYPE_RICH_OBJECT:999,TYPE_INFO:3333,TYPE_BUYNOW:2500,TYPE_SHORTCUTS:4444},AUTOMOTIVE_PAYMENT_ATTACHMENT:{TYPE_DRIVER_LICENSE:1,TYPE_AUTO_INSURANCE:2,TYPE_INTERIOR_PHOTO:{TYPE_INTERIOR_PHOTO_1:61,TYPE_INTERIOR_PHOTO_2:62,TYPE_INTERIOR_PHOTO_3:63,TYPE_INTERIOR_PHOTO_4:64,TYPE_INTERIOR_PHOTO_5:65},TYPE_EXTERIOR_PHOTO:{TYPE_EXTERIOR_PHOTO_1:71,TYPE_EXTERIOR_PHOTO_2:72,TYPE_EXTERIOR_PHOTO_3:73,TYPE_EXTERIOR_PHOTO_4:74,TYPE_EXTERIOR_PHOTO_5:75},TYPE_POTENTIAL_DAMAGES_PHOTO:{TYPE_POTENTIAL_DAMAGES_PHOTO_1:81,TYPE_POTENTIAL_DAMAGES_PHOTO_2:82,TYPE_POTENTIAL_DAMAGES_PHOTO_3:83,TYPE_POTENTIAL_DAMAGES_PHOTO_4:84,TYPE_POTENTIAL_DAMAGES_PHOTO_5:85}},WIDGET:{NONE:0,DATE:1,TIME:2,DATE_TIME:3,NAME:4,EMAIL:5,PHONE:6},WIDGETS:[0,1,2,3,4,5,6],SYS_LOGS:{MODULE:{USER_SESSION:1,CHAT_SESSION:2,XMPP:3},EVENT:{USER_SEND_SESSION_LOG:1100,XMPP_GENERAL_LOG:3100,MSG_CATEGORY:4000,NEW_REQUEST:5001,NOTIFICATION:5002}},SD_TAG_ENABLED_MAKES:["sd_subaru","sd_toyota","sd_mbusa","sd_lexus","sd_porsche","sd_maserati","sd_infiniti","sd_vw","sd_kia","sd_mazda","sd_jlr"],DEALER_ROLES:{DEFAULT:1,ADMIN:2,MANAGER:3},EMPTY_IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjgAAADcCAQAAADXNhPAAAACIklEQVR42u3UIQEAAAzDsM+/6UsYG0okFDQHMBIJAMMBDAfAcADDATAcwHAAwwEwHMBwAAwHMBzAcAAMBzAcAMMBDAcwHADDAQwHwHAAwwEMB8BwAMMBMBzAcADDATAcwHAADAcwHADDAQwHMBwAwwEMB8BwAMMBDAfAcADDATAcwHAAwwEwHMBwAAwHMBzAcAAMBzAcAMMBDAcwHADDAQwHwHAAwwEwHMBwAMMBMBzAcAAMBzAcwHAADAcwHADDAQwHMBwAwwEMB8BwAMMBDAfAcADDATAcwHAAwwEwHMBwAAwHMBzAcCQADAcwHADDAQwHwHAAwwEMB8BwAMMBMBzAcADDATAcwHAADAcwHMBwAAwHMBwAwwEMBzAcAMMBDAfAcADDAQwHwHAAwwEwHMBwAAwHMBzAcAAMBzAcAMMBDAcwHADDAQwHwHAAwwEMB8BwAMMBMBzAcADDATAcwHAADAcwHMBwAAwHMBwAwwEMB8BwAMMBDAfAcADDATAcwHAAwwEwHMBwAAwHMBzAcAAMBzAcAMMBDAcwHADDAQwHwHAAwwEMB8BwAMMBMBzAcADDkQAwHMBwAAwHMBwAwwEMBzAcAMMBDAfAcADDAQwHwHAAwwEwHMBwAMMBMBzAcAAMBzAcwHAADAcwHADDAQwHMBwAwwEMB8BwAMMBMBzAcADDATAcwHAADAcwHMBwAAwHMBwAwwEMBzAcAMMBDAegeayZAN3dLgwnAAAAAElFTkSuQmCC",reloadMdpUrl:"",reloadCompareUrl:"",reloadComparisonList:0,mobile:-1,sessionTimeout:0,sessionTimeoutTimer:null,sessionStorageAvailable:false,growlTimer:null,flashTimers:{},serverTimeDiff:0,muted:false,browserNotificationEnabled:null,pageReloading:false,settings:null,theParentWindow:null,theParentOrigin:null,localParams:{},audioAutoPlayEnabled:false,storageParams:{},pendingEvents:[],thirdPartyCookieEnabled:true,pendingCSRFReload:false,init:function(settings){try{sessionStorage.setItem("cnCore.ping",1);this.sessionStorageAvailable=true}catch(e){}this.settings=settings;if(settings.log_svc_settings){cnLogSvc.init(settings.log_svc_settings)}cnLogSvc.addExtSvcUserData(settings.user);cnLogSvc.addExtSvcMetadata("admin",settings.admin);cnLogSvc.addExtSvcMetadata("dealer",settings.org);cnLogSvc.addExtSvcMetadata("partner",settings.partner);cnLogSvc.addExtSvcMetadata("csrf-token",this.getMeta("csrf-token"));if(settings.chatSessionUqId){cnLogSvc.addExtSvcMetadata("sessionUqId",settings.chatSessionUqId.replace('"',"").replace('"',""))}if(settings.options&&settings.options.iFrameMode){cnLogSvc.addExtSvcMetadata("iFrame",settings.options.iFrameMode)}var mp3="data:audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq";var ogg="data:audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA=";try{var audio=new Audio();var src=audio.canPlayType("audio/ogg")?ogg:mp3;audio.autoplay=true;audio.volume=0;$(audio).on("play",function(){CN.audioAutoPlayEnabled=true});audio.src=src}catch(e){}},getSettings:function(){return this.settings||window.cnSettings},postInterMessage:function(data,passMessageObject){if(!CN.interSocket){try{CN.interSocket=new easyXDM.Socket({onMessage:function(message,origin){var json=JSON.parse(message);CN.broadcastMessage({cnEvent:"cnEvent.pluginEvent",event:json.event||json})}})}catch(e){}}if(CN.interSocket&&data){if(data.printOnly){console.log(data)}else{if(passMessageObject){CN.interSocket.postMessage(data)}else{CN.interSocket.postMessage(JSON.stringify(data))}}return true}else{return false}},postClassToContainer:function(className,remove){if(remove){CN.postInterMessage({type:"add_container_class",class_name:className+"-remove"});setTimeout(function(){CN.postInterMessage({type:"remove_container_class",class_name:className+"-remove"});CN.postInterMessage({type:"remove_container_class",class_name:className})},1000)}else{CN.postInterMessage({type:"add_container_class",class_name:className+"-add"});setTimeout(function(){CN.postInterMessage({type:"remove_container_class",class_name:className+"-add"});CN.postInterMessage({type:"add_container_class",class_name:className})},1000)}},postWindowMessage:function(data){if(CN.theParentWindow&&CN.theParentWindow.postMessage){CN.theParentWindow.postMessage(data,CN.theParentOrigin)}},setSetting:function(name,value){this.settings[name]=value},getBrowserHeight:function(){var height=window.top.innerHeight;if(height==null){if(this.settings.mobile&&this.settings.options.iFrameMode){if(parent&&parent.CN){height=parent.CN.getBrowserHeight()}}if(height==null){height=parent.document.body.clientHeight}if(height==null){height=document.body.clientHeight}}height-=44;return height},setupSessionTimeout:function(timeout){if(timeout&&timeout>0){if(this.sessionTimeoutTimer!=null){clearTimeout(this.sessionTimeoutTimer)}this.sessionTimeout=timeout;this.sessionTimeoutTimer=setTimeout(function(){},(timeout*60*1000))}},setUserStatus:function(status){$.ajax({url:"/users/update_online_status",type:"POST",headers:{"X-CSRF-Token":CN.csrfToken()},data:{status:status},success:function(data){}})},csrfToken:function(){return $("meta[name='csrf-token']").attr("content")},currentTime:function(){var dt=new Date();dt.setSeconds(dt.getSeconds()-CN.serverTimeDiff);return dt},exec_get:function(url,ajax){if(ajax){$.ajax({url:url})}else{$("body").append('<div style="position:fixed;top:-100px;left:-100px;width:0;height:0"><iframe frameborder="no" width="0" height="0" scrolling="no" src="'+url+'"></iframe></div>')}},ctlr:function(scope){return angular.element($(scope)).scope()},ctrlInjector:function(scope){return angular.element($(scope)).injector()},getApplicationModel:function(scope){return this.ctrlInjector(scope).get("applicationModel")},getCNEnv:function(scope){return this.ctrlInjector(scope).get("cnEnv")},injector:function(){if($("#cn_injector")[0]){return angular.element($("#cn_injector")).scope()}else{return angular.element($("[ng-controller]")[0]).scope()}},broadcastMessage:function(messageData){if(typeof angular!="undefined"){var ing=CN.injector();if(ing!=undefined&&ing!=null&&ing.broadcastMessage){ing.broadcastMessage(messageData)}else{CN.pendingEvents.push(messageData)}}},getStatus:function(){var statusLog={};var injectorScope=CN.injector();try{if(typeof cnChatX!="undefined"&&cnChatX){statusLog=cnChatX.getStatus()}if(injectorScope&&typeof injectorScope.getStatus==="function"){statusLog.app=injectorScope.getStatus();statusLog.app.timestamp=(new Date(Date.now())).toLocaleString()}}catch(e){}return statusLog},postSysLog:function(params){try{$.ajax({url:"/users/sys_log",type:"POST",headers:{"X-CSRF-Token":this.csrfToken()},data:params})}catch(e){}},formToObject:function(elem){var o={};var a=elem.serializeArray();$.each(a,function(){if(o[this.name]!==undefined){if(!o[this.name].push){o[this.name]=[o[this.name]]}o[this.name].push(this.value||"")}else{o[this.name]=this.value||""}});return o},updateSessionLanguage:function(language,refreshSession){var chatSessionId=$("#chat_session_id").val();var refresh=(refreshSession!=null&&refreshSession);$.ajax({url:"/chat/"+chatSessionId+"/session_language",type:"POST",headers:{"X-CSRF-Token":$("meta[name='csrf-token']").attr("content")},data:{language:language,refresh:refresh},success:function(data){if(refresh){if(typeof(turnOffWindowCloseEvent)=="function"){turnOffWindowCloseEvent()}location.reload()}}})},refreshPage:function(url){if(url==null||url==""){$.mobile.changePage(window.location.href,{allowSamePageTransition:true,transition:"none",showLoadMsg:false,reloadPage:true})}else{$.mobile.changePage(url,{allowSamePageTransition:true,transition:"none",showLoadMsg:false,reloadPage:true})}},setIsMobile:function(b){this.mobile=b?1:0},isMobile:function(){if(this.mobile==-1){var b=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);this.mobile=b?1:0}return this.mobile==1},isIE9:function(){var myNav=navigator.userAgent.toLowerCase();if(myNav.indexOf("msie")!=-1){var ieVersion=parseInt(myNav.split("msie")[1]);if(ieVersion<10){CarNowPlugin.animationEnabled=false}}},isSeoEnabled:function(){return this.getMeta("cn-ng-seo-enabled")=="true"},getMeta:function(name){var metas=document.getElementsByTagName("meta");var value=null;for(var i=0;i<metas.length;i++){if(metas[i].getAttribute("name")==name){value=metas[i].getAttribute("content");break}}return value},clearSessionCache:function(){if(this.sessionStorageAvailable){sessionStorage.clear()}},logout:function(){if(cnChatX){cnChatX.logout()}},showPageTopErrors:function(messages){for(var i=0;i<messages.length;i++){$("#pg_top_errors").append('<div class="disbl error">'+messages[i]+"</div>")}if(messages.length>0){$("#pg_top_errors").slideDown()}},showGrowlMessage:function(msg){CN.broadcastMessage({cnEvent:"cnEvent.newNotification",bucket:"flash",data:{id:new Date().getTime()+"",message:msg}})},showGrowl:function(){},hideGrowlMessage:function(selector){if($(".growl-messages .grwl-msg").length==1){CN.hideGrowl()}else{$(".growl-messages "+selector).remove()}},hideGrowl:function(messages){},flashElement:function(selector){if($(selector).hasClass("flashing")){$(selector+".flashing").addClass("flash animated").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("flash animated")});if(CN.flashTimers[selector]!=null){clearTimeout(CN.flashTimers[selector])}CN.flashTimers[selector]=setTimeout(function(){CN.flashElement(selector)},4000)}},updateDealerRatings:function(ids){$.ajax({url:"/dealers/user_rating",data:{uid:ids},success:function(data){for(var i=0;i<data.length;i++){var id=".dealer-user-ratings.u"+data[i].uid;var w=$(id).find(".gray").width()*(data[i].rating/5);$(id+" .orange").css("width",w+"px");$(id+" .stars-cnt").text("("+((Math.round(data[i].rating*10)/10))+")")}}})},getUUID:function(){var crypto=window.crypto||window.msCrypto;return([10000000]+-1000+-4000+-8000+-100000000000).replace(/[018]/g,function(c){return(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16)})},deviceHeightOffset:function(){if(navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i)&&window.innerHeight!=document.documentElement.clientHeight){return 20}else{return 0}},confirm:function(options){$("#d_confirm_msg").text(options.message);$("#d_confirm").modal();$("#d_confirm_yes").unbind("click");$("#d_confirm_yes").click(function(){options.onYes(options.node);$("#d_confirm").modal("hide")})},showProcessing:function(){$("#d_processing").fadeIn("fast")},hideProcessing:function(){$("#d_processing").fadeOut("fast")},removeListRow:function(elem){var li=elem.closest("li");li.addClass("deleting");li.find("a").attr("disabled","disabled");var url=elem.attr("data-url");$.ajax({url:url,type:"POST",headers:{"X-CSRF-Token":$("meta[name='csrf-token']").attr("content")},success:function(data){li.fadeOut(500,function(){li.remove()})}})},setPref:function(key,val){$.ajax({url:"/set_prefs",type:"POST",headers:{"X-CSRF-Token":$("meta[name='csrf-token']").attr("content")},data:{key:key,val:val,cli:"web"}})},refreshChatCounts:function(csid){$.ajax({url:"/chat/counts?chat="+csid,success:function(data){if(data.new_chat_message_count>0){$(".badge-chat-message-count").text(data.new_chat_message_count);$(".badge-chat-message-count").fadeIn()}if((data.new_chat_requests_count+data.new_red_alerts_count)>0){$(".badge-chat-requests-count").text(data.new_chat_requests_count+data.new_red_alerts_count);$(".txt-chat-requests-count").text(data.new_chat_requests_txt);$(".badge-chat-requests-count").fadeIn()}if((data.new_chat_message_count+data.new_chat_requests_count+data.new_red_alerts_count)>0){$(".badge-chat-count").text(data.new_chat_message_count+data.new_chat_requests_count+data.new_red_alerts_count);$(".badge-chat-count").fadeIn()}$("#tbm_chat_notifications_dd").html(data.notifications);if(data.new_chat_growl_count>0){if(CN.isMobile()){$(".grwl").each(function(){$(this).find(".growl-messages").html(data.growls)})}else{$(".growl-messages").html(data.growls)}CN.showGrowl()}if(data.chat_count>0){$("#tbm_current_chat").fadeIn()}for(var id in data.session_counts){var cnt=data.session_counts[id];$("#bdg_"+id).text(cnt);$("#bdg_"+id).fadeIn();$("#bdg_"+id).closest("li").addClass("tmsg");$("#bdg_"+id).closest("li").attr("data-elapsed-from","0")}if(data.new_chat_transfers_count>0){$("#tbm_transfer_menu").show();$(".badge-transfer-count").text(data.new_chat_transfers_count);$(".badge-transfer-count").fadeIn();$("#tbm_transfer_dd i").addClass("flashing");CN.flashElement(".transfer-alert i")}else{$("#tbm_transfer_menu").hide()}$("#tbm_transfer_notifications_dd").html(data.transfers);if(data.new_request_flash!=""){$("#new_req_list").html(data.new_request_flash);CN.showRequestFlash()}}})},showRequestFlash:function(){$("#new_req_flash").removeClass("animated");$("#new_req_flash").removeClass("fadeInUpBig");$("#new_req_flash").removeClass("fadeOutDownBig");$("#new_req_flash").addClass("animated fadeInUpBig");$("#new_req_flash").css("display","block")},hideRequestFlash:function(){$("#new_req_flash").removeClass("animated");$("#new_req_flash").removeClass("fadeInUpBig");$("#new_req_flash").removeClass("fadeOutDownBig");$("#new_req_flash").addClass("animated fadeOutDownBig")},getDistance:function(lat1,lon1,lat2,lon2){var radlat1=Math.PI*lat1/180;var radlat2=Math.PI*lat2/180;var theta=lon1-lon2;var radtheta=Math.PI*theta/180;var dist=Math.sin(radlat1)*Math.sin(radlat2)+Math.cos(radlat1)*Math.cos(radlat2)*Math.cos(radtheta);if(dist>1){dist=1}dist=Math.acos(dist);dist=dist*180/Math.PI;dist=dist*60*1.1515;return dist},validEmail:function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)},areValidEmails:function(emails){for(var i=0;i<emails.length;i++){if(!CN.validEmail(emails[i])){return false}}return true},validPhone:function(phone){var re=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;return re.test(phone)},updateUserOnlineStatus:function(elem){var status=$(elem).attr("data-value");$(".m-user-status .icon-16 icon-tick").hide();$(".m-user-status span").removeClass("fnt-b");$(elem).find(".icon-16 icon-tick").show();$(elem).find("span").addClass("fnt-b");Object.keys(CN.ONLINE_STATUS).forEach(function(key){$(".my-online-status").removeClass("s"+CN.ONLINE_STATUS[key])});$(".my-online-status").addClass("s"+status);$.ajax({url:"/users/update_online_status",type:"POST",headers:{"X-CSRF-Token":CN.csrfToken()},data:{status:status},success:function(data){}})},refreshUserStatusCounts:function(csid){},refreshUserStatusList:function(elem,status,term){$.ajax({url:"/users/users_status_list?status="+status+"&term="+term,dataType:"json",success:function(data){$(elem).html(data.html)}})},checkBrowserNotification:function(){if(this.browserNotificationEnabled==null){if(window.Notification&&Notification.requestPermission){if(Notification.permission!=="granted"){Notification.requestPermission()}else{this.browserNotificationEnabled=true}}else{if(typeof(console)!=="undefined"){console.log("Browser notifications not enabled for this application.")}this.browserNotificationEnabled=false}}},postBrowserNotification:function(id,title,message,icon,link){if(this.sessionStorageAvailable&&sessionStorage!=undefined&&sessionStorage.cnBwNotId==id){return}this.checkBrowserNotification();if(!this.browserNotificationEnabled){return}if(!link||link.length<=(CN.getSettings().url.base.length+1)){return}var notification=new Notification(title,{icon:icon,body:message});if(this.sessionStorageAvailable){if(sessionStorage!=undefined){sessionStorage.cnBwNotId=id}}notification.onclick=function(){window.focus();window.location=link};setTimeout(function(){notification.close()},5000)},setupNoBlanks:function(){$(".no-blanks").each(function(){if($(this).attr("data-fld-name")==null){$(this).attr("data-fld-name",$(this).attr("name"));$(this).removeAttr("name")}});$(".no-blanks").unbind("change");$(".no-blanks").on("change",function(){if($(this).val()!=null&&$(this).val()!=""){$(this).attr("name",$(this).attr("data-fld-name"))}else{$(this).removeAttr("name")}})},pushHistory:function(){},blinkTab:function(id,idx,high,finalClass){if(idx>11){if(finalClass!=null){$(id).addClass(finalClass);$(id).css("background-color","")}return}var color=(high?"#FFEAAB":"#FFFFFF");$(id).animate({backgroundColor:color},1000,function(){CN.blinkTab(id,idx+1,!high,finalClass)})},setCaretPosition:function(input,pos){if(input.setSelectionRange){input.focus();input.setSelectionRange(pos,pos)}else{if(input.createTextRange){var range=input.createTextRange();range.collapse(true);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}}},setChatTabColor:function(tab,newCustMsg){if(newCustMsg){tab.removeClass("t30");tab.removeClass("t60");tab.attr("data-elapsed-ts",0);tab.attr("data-elapsed-from",0)}else{var ts=tab.attr("data-elapsed-ts");if(tab.attr("data-elapsed-from")=="1"&&ts!=null&&parseInt(ts)>0){var css="";var diff=(new Date().getTime()/1000)-parseInt(ts);if(diff>=30&&diff<60){css="t30"}else{if(diff>=60&&diff<=86400){css="t60"}else{if(diff>=86400){css="tinfi"}}}tab.removeClass("t30");tab.removeClass("t60");tab.addClass(css);if(css=="t30"){setTimeout(function(){CN.setChatTabColor(tab)},30000)}if(diff<30){setTimeout(function(){CN.setChatTabColor(tab)},diff*1000)}}}},showCoachMarks:function(data,index){if(index<data.length){var tip=data[index];if($(tip.selector).length>0){$(tip.selector).popover({html:true,trigger:"focus",container:"body",viewport:".page-content",placement:tip.position,title:tip.title,template:'<div class="popover coach" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content p10"></div></div>',content:function(e){return'<div class="disbl pb10">'+tip.content+'</div><div class="disbl bdrt pt10 tar"><a class="btn btn-thin btn-gray nf-tip-dismiss" data-id="'+tip.selector+'">Dismiss</a></div>'}}).popover("show");$.ajax({url:"/update_ui_state",type:"POST",headers:{"X-CSRF-Token":$("meta[name='csrf-token']").attr("content")},data:{key:tip.key,val:1}});setTimeout(function(){$(tip.selector).popover("hide");$(tip.selector).popover("destroy");CN.showCoachMarks(data,index+1)},tip.show_seconds*1000);$(".nf-tip-dismiss").unbind("click");$(".nf-tip-dismiss").on("click",function(){$($(this).attr("data-id")).popover("hide");$($(this).attr("data-id")).popover("destroy")})}else{CN.showCoachMarks(data,index+1)}}},formatPhoneNumber:function(ph){if(!ph){return""}var f="("+ph.slice(0,3)+") "+ph.slice(3,6)+"-"+ph.slice(6);return f},getQueryParams:function(){var qs=window.location.search;qs=qs.split("+").join(" ");var params={},tokens,re=/[?&]?([^=]+)=([^&]*)/g;while(tokens=re.exec(qs)){params[decodeURIComponent(tokens[1])]=decodeURIComponent(tokens[2])}return params},updateCustomerStatus:function(id,cid,status,callFunc){$.ajax({url:"/chat/"+id+"/update_user_status"+(cid!=null?"/"+cid:""),type:"POST",headers:{"X-CSRF-Token":$("meta[name='csrf-token']").attr("content")},data:{status:status},success:function(data){if(callFunc!=null){callFunc()}}})},updateVisitorStatus:function(vid,status){$.ajax({url:"/chat/update_visitor_status/"+vid,type:"POST",headers:{"X-CSRF-Token":$("meta[name='csrf-token']").attr("content")},data:{status:status,c:$("meta[name='csrf-token']").attr("content")}})},contextMenuClicked:function(el,category,action){var objectId=$(el).attr("data-object-id");var scope=$(el).attr("data-scope");CN.broadcastMessage({cnEvent:"cnEvent.contextMenuClicked",scopeId:scope,objectId:objectId,category:category,action:action});this.hideAllContextMenus()},hideAllContextMenus:function(){$("[cn-context-menu]").each(function(){$(this).popover("hide")})},renderPopUrl:function(){$(".pop-url").each(function(){var url=$(this).attr("data-url");var placement=$(this).attr("data-placement");var el=$(this);$.ajax({url:url,success:function(data){el.popover({html:true,trigger:"hover",placement:placement,container:"body",template:'<div class="popover info-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content p10"></div></div>',viewport:".page-content",content:function(e){return'<div class="disbl info-content overflow-y">'+data+"</div>"}})}})})},renderPopContent:function(){$(".pop-content").each(function(){var content=$(this).attr("data-content");var placement=$(this).attr("data-placement");$(this).popover({html:true,trigger:"hover",placement:placement,container:"body",template:'<div class="popover info-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content p10"></div></div>',viewport:".page-content",content:function(e){return'<div class="disbl info-content overflow-y">'+content+"</div>"}})})},renderPopHtml:function(){if($(".pop-html").popover){$(".pop-info").unbind("click");$(".pop-info").click(function(){var url=$(this).attr("data-url");var el=$(this);$.ajax({url:url,success:function(data){el.unbind("click").popover({html:true,trigger:"focus",container:"body",template:'<div class="popover info-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content p10"></div></div>',viewport:".page-content",content:function(e){return'<div class="disbl info-content overflow-y">'+data+"</div>"}}).popover("show")}})});$(".pop-html").popover({html:true,trigger:"hover",container:"body"})}},putInLocal:function(name,value){try{this.localParams["cn_"+name]=value;if(name.indexOf("vstid")>=0){cnLogSvc.addExtSvcMetadata("vstid",value)}localStorage.setItem("cn_"+name,value)}catch(e){this.setLocalVar("cn_"+name,value)}},getFromLocal:function(name){try{if(this.localParams["cn_"+name]){return this.localParams["cn_"+name]}else{return localStorage.getItem("cn_"+name)}}catch(e){return this.getLocalVar("cn_"+name)}},removeFromLocal:function(name){try{var key="cn_"+name;delete this.localParams[key];localStorage.removeItem(key)}catch(e){}},setLocalVar:function(name,value){this.storageParams[name]=value},getLocalVar:function(name){return this.storageParams[name]},putInSession:function(name,value){try{sessionStorage.setItem("cn_"+name,value)}catch(e){}},getFromSession:function(name){try{return sessionStorage.getItem("cn_"+name)}catch(e){return null}},getTimeElapsed:function(start){if(start==null){return 0}startAt=parseInt(start);return Math.round(CN.currentTime()/1000)-startAt},getTimeElapsedAbbr:function(start){if(start==null){return""}startAt=parseInt(start);var time=Math.round(CN.currentTime()/1000)-startAt;if(time==null||time<0){time=0}var str=time+"s";var h=0,m=0,s=0;if(time>59&&time<3600){m=parseInt(time/60);s=time-(60*m)}else{if(time>3600){h=parseInt(time/3600);m=parseInt((time-(3600*h))/60);s=time-(3600*h)-(60*m)}else{if(time>60){m=parseInt(time/60);s=time-(60*m)}}}if(m>0||h>0){if(h>24){str=parseInt((h/24))+"d"}else{if(h>0){str=h+"h"}else{str=m+"m"}}}return str},getTimeElapsedText:function(start){if(start==null){return""}startAt=parseInt(start);var time=Math.round(CN.currentTime()/1000)-startAt;if(time==null||time<0){time=0}var str=time+" sec";var h=0,m=0,s=0;if(time>59&&time<3600){m=parseInt(time/60);s=time-(60*m)}else{if(time>3600){h=parseInt(time/3600);m=parseInt((time-(3600*h))/60);s=time-(3600*h)-(60*m)}else{if(time>60){m=parseInt(time/60);s=time-(60*m)}}}if(m>0||h>0){var ss=""+s,mm=""+m;if(s<10){ss="0"+s}if(m<10){mm="0"+m}str=(h>0?h+":":"")+(m>0?mm+":":"")+ss}return str},sortHeader:function(elem){var scopeId=$(elem).attr("data-scope");var index=parseInt($(elem).attr("data-index"));var asc=$(elem).find("i").hasClass("icon-12 icon-arr-down");if(asc){if($(elem).hasClass("sorted")){$(elem).find("i").removeClass("icon-12 icon-arr-down");$(elem).find("i").addClass("icon-12 icon-arr-up");asc=false}}else{$(elem).find("i").removeClass("icon-12 icon-arr-up");$(elem).find("i").addClass("icon-12 icon-arr-down");asc=true}CN.broadcastMessage({cnEvent:"cnEvent.sortHeaderClicked",scopeId:scopeId,colIndex:index,directionAsc:asc})},dataURItoBlob:function(dataURI){var byteString;if(dataURI.split(",")[0].indexOf("base64")>=0){byteString=atob(dataURI.split(",")[1])}else{byteString=unescape(dataURI.split(",")[1])}var mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0];var ia=new Uint8Array(byteString.length);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i)}return new Blob([ia],{type:mimeString})},checkCSRF:function(){if(CN.pendingCSRFReload!=true){$.ajax({url:"/check_csrf",type:"POST",headers:{"X-CSRF-Token":CN.csrfToken()},data:{test:true},success:function(data){},error:function(req){if(req.status==422){CN.pendingCSRFReload=true;window.alert("CSRF Token Error: Reloading page");window.location.reload()}}})}}};$(document).ready(function(){$(".btn-pg-back").click(function(){window.history.go(-1);return false});if($(".dealer-user-ratings").length>0){var elem=$(this);var ids="";$(".dealer-user-ratings").each(function(){if(ids!=""){ids+=","}ids+=$(this).attr("data-uid")});CN.updateDealerRatings(ids)}$(".body-msg .message-box").each(function(){var w=$(this).outerWidth();var h=$(this).outerHeight();$(this).css("margin-left",(-w/2)+"px");$(this).css("margin-top",(-h/2)+"px")});$(".ajax-url").click(function(){var url=$(this).attr("href");var msg=$(this).attr("data-msg");$(".pane-loading.full-page .msg").text(msg);$(".pane-loading.full-page").fadeIn(500,function(){$.ajax({url:url,success:function(data){$(".pane-loading.full-page").fadeOut(500);CN.showGrowlMessage(data.message)},error:function(){$(".pane-loading.full-page").fadeOut(500)}})});return false});try{if(!CN.isMobile()){CN.renderPopUrl();CN.renderPopContent()}}catch(e){}try{CN.setupNoBlanks();if((typeof(History)!=="undefined")&&(typeof(History.Adapter)!=="undefined")){History.Adapter.bind(window,"statechange",function(){var State=History.getState()})}}catch(e){}$(".modal-close").click(function(){$(this).closest(".modal").modal("hide");return false});$("body").on("click",function(e){$("[cn-context-menu]").each(function(){if(!$(this).is(e.target)&&$(this).has(e.target).length===0&&$(".popover").has(e.target).length===0){$(this).popover("hide")}})})});$(document).bind("ready ajaxComplete",function(){$("#tbm_account_dd").closest(".dropdown").on("show.bs.dropdown",function(){CN.refreshUserStatusCounts(null)});$(".simple-list-remove").unbind("click");$(".simple-list-remove").bind("click",function(){CN.removeListRow($(this));return false});$(".para-more").click(function(){$(this).hide();$(this).parent().find(".para-rest").show();$(this).parent().find(".para-less").show();return false});$(".para-less").click(function(){$(this).hide();$(this).parent().find(".para-rest").hide();$(this).parent().find(".para-more").show();return false});$(".simple-list-del-confirm").click(function(){var elem=$(this);var msg=elem.attr("data-msg");CN.confirm({node:elem,message:msg,onYes:function(elem){CN.removeListRow(elem)}})});$(".input-wrapper .clear-x").unbind("click");$(".input-wrapper .clear-x").click(function(){if($(this).hasClass("cn-clear-x")){return true}$(this).closest(".input-wrapper").find("input").val("");$(this).closest(".input-wrapper").find("input").trigger("change");if($("#f_filter").length>0){$("#f_filters").submit()}else{if($(this).closest("form").length>0){$(this).closest("form").submit()}else{$(this).closest(".input-wrapper").find("input").trigger("change")}}});$(".d-info").unbind("click");$(".d-info").click(function(){var url=$(this).attr("data-url");var w=$(this).attr("data-width");$("#d_info .modal-dialog").css("width",w);$("#d_info .modal-title").text($(this).attr("data-info-title"));$("#d_info .spinner").show();$("#d_info .info-contents").html("");$("#d_info").modal();$.ajax({url:url,success:function(data){$("#d_info .spinner").hide();$("#d_info .info-contents").html(data)}})});try{if(!CN.isMobile()){CN.renderPopUrl();CN.renderPopContent()}}catch(e){}$(".pop-info").on("shown.bs.popover",function(){var wh=$(window).height();var pt=$(".info-popover").position().top;var ph=$(".info-popover").outerHeight();if(pt<0&&(pt+ph<wh)){$(".info-popover").css("top","10px");var at=$(".info-popover .arrow").position().top;$(".info-popover .arrow").css("top",((ph/2)+pt-11)+"px")}if((pt+ph>wh)&&pt>0){var diff=(pt+ph-wh+10);$(".info-popover").css("top",(pt-diff)+"px");var at=$(".info-popover .arrow").position().top;$(".info-popover .arrow").css("top",((ph/2)+diff-1)+"px")}})});if(window.cnSettings){CN.init(window.cnSettings)}if(window.addEventListener){window.addEventListener("message",function(event){if(event.data=="MM:3PCunsupported"){CN.thirdPartyCookieEnabled=false;console.log("***** 3rd Party Cookies DISABLED *****")}if(event.origin.toLowerCase().indexOf("tradepending")){try{var data=JSON.parse(event.data);if(data.height){CN.broadcastMessage({cnEvent:"cnEvent.onTPReportLoadHeight",height:data.height})}}catch(e){}}CN.theParentWindow=event.source;CN.theParentOrigin=event.origin;if(event.data=="parent"){CN.broadcastMessage({cnEvent:"cnEvent.parentWindow",parentWindow:event.source,parentOrigin:event.origin})}if(event.data=="PaymentCompleted"){CN.broadcastMessage({cnEvent:"cnEvent.sppSuccess",parentWindow:event.source,parentOrigin:event.origin})}if(event.data=="spp_budco_callback"){CN.broadcastMessage({cnEvent:"cnEvent.budcoSuccess",parentWindow:event.source,parentOrigin:event.origin})}});window.addEventListener("focus",function(event){CN.broadcastMessage({cnEvent:"cnEvent.windowInFocus"});CN.checkCSRF()});window.addEventListener("blur",function(event){CN.broadcastMessage({cnEvent:"cnEvent.windowOutFocus"})})}else{if(window.attachEvent){window.attachEvent("onmessage",function(event){if(event.data=="MM:3PCunsupported"){CN.thirdPartyCookieEnabled=false;console.log("***** 3rd Party Cookies DISABLED *****")}if(event.origin.toLowerCase().indexOf("tradepending")){try{var data=JSON.parse(event.data);if(data.height){CN.broadcastMessage({cnEvent:"cnEvent.onTPReportLoadHeight",height:data.height})}}catch(e){}}CN.theParentWindow=event.source;CN.theParentOrigin=event.origin;if(event.data=="parent"){CN.broadcastMessage({cnEvent:"cnEvent.parentWindow",parentWindow:event.source,parentOrigin:event.origin})}});window.attachEvent("onfocus",function(event){CN.broadcastMessage({cnEvent:"cnEvent.windowInFocus"});CN.checkCSRF()});window.attachEvent("onblur",function(event){CN.broadcastMessage({cnEvent:"cnEvent.windowOutFocus"})})}}Date.prototype.stdTimezoneOffset=function(){var jan=new Date(this.getFullYear(),0,1);var jul=new Date(this.getFullYear(),6,1);return Math.max(jan.getTimezoneOffset(),jul.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};Date.getDaysInMonth=function(year,month){return[31,28,31,30,31,30,31,31,30,31,30,31][month]};Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())};Number.prototype.lpad=function(width,z){z=z||"0";n=this+"";return n.length>=width?n:new Array(width-n.length+1).join(z)+n};Date.prototype.toDateString=function(separator){if(separator){return(this.getMonth()+1).lpad(2,"0")+separator+this.getDate().lpad(2,"0")+separator+this.getFullYear()}else{return(this.getMonth()+1).lpad(2,"0")+"/"+this.getDate().lpad(2,"0")+"/"+this.getFullYear()}};Date.prototype.toTimeString=function(){return moment(this.getTime()).format("hh:mm A")};Date.prototype.toTime24String=function(){return moment(this.getTime()).format("HH:mm")};String.prototype.toDateMmDdYyyy=function(){var dt=new Date(Date.parse(this));return(dt.getMonth()+1).lpad(2,"0")+"/"+dt.getDate().lpad(2,"0")+"/"+dt.getFullYear()};String.prototype.format=function(){var args=arguments;return this.replace(/\{(\d+)\}/g,function(){return args[arguments[1]]})};String.prototype.formatDate=function(format){return moment(Date.parse(this)).format(format)};if(!String.prototype.startsWith){String.prototype.startsWith=function(search,pos){return this.substr(!pos||pos<0?0:+pos,search.length)===search}}Number.prototype.formatMoney=function(c,d,t){var n=this,c=isNaN(c=Math.abs(c))?2:c,d=d==undefined?".":d,t=t==undefined?",":t,s=n<0?"-":"",i=parseInt(n=Math.abs(+n||0).toFixed(c))+"",j=(j=i.length)>3?j%3:0;return s+(j?i.substr(0,j)+t:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+t)+(c?d+Math.abs(n-i).toFixed(c).slice(2):"")};if(!String.prototype.padStart){String.prototype.padStart=function padStart(targetLength,padString){targetLength=targetLength>>0;padString=String((typeof padString!=="undefined"?padString:" "));if(this.length>targetLength){return String(this)}else{targetLength=targetLength-this.length;if(targetLength>padString.length){padString+=padString.repeat(targetLength/padString.length)}return padString.slice(0,targetLength)+String(this)}}}if("serviceWorker" in navigator){window.addEventListener("load",function(){navigator.serviceWorker.register("/cn-svc-worker.js").then(function(registration){navigator.serviceWorker.addEventListener("message",function(event){CN.broadcastMessage({cnEvent:"cnEvent.serviceWorkerEvent",data:event.data})})},function(err){})})}function CNXmpp(boshUrls,wsUrl,options){var self=this;var ua=navigator.userAgent;this.pollingInterval=null;this.lastXmppActivity=null;this.maxLastActivityAge=15000;this.checkConnectionInterval=15000;this.checkConnectionHandle=null;this._connCheckLog={lastAttemptAt:null,lastSkipAt:null,attemptCount:0,skipCount:0};try{if(ua.indexOf("Windows NT")>=0&&(ua.indexOf("MSIE 9")>=0)){if(ua.indexOf("MSIE 9")>=0&&options&&options.polling){this.pollingInterval=options.polling?7500:null}}}catch(e){cnLogSvc.log(3,"CNXmpp_()","Javascript error detecting user agent - "+e.description)}this.sessionStorageAvailable=false;try{sessionStorage.setItem("cnXMPP.ping",1);this.sessionStorageAvailable=true}catch(e){}if(options==null){options={}}if(options.events==null){options.events={}}this.id=options.id||"cn";this.getAuthUrl=options.getAuthUrl||"/users/jabber_info";this.bareJid=null;this.pubsubJid=null;this.sessionKeys={bareJid:this.id+"_bareJid",password:this.id+"_pswd",jid:this.id+"_jid",sid:this.id+"_sid",rid:this.id+"_rid"};this.connection=null;this.isConnecting=false;this.autoReconnect=true;this.isReconnecting=false;this.events=options.events;this._boshUrls=this.randomizeBoshUrls(boshUrls);this._wsUrl=wsUrl;this._attemptedToRegister=0;this._lastReceivedMsg=null;this._lastSentMsg=null;this._reconnectDelayTimeout=null;this._queueRemoteLogMessages=[];this._queueSend=[];this._queuePublish=[];this._limits={reconnect:{max:12,count:0,delay:30000},attach:{max:1,count:0},connFail:{useAltProtocol:true,max:3,count:0},boshUrl:{index:0}};if(cnLogSvc){if(cnLogSvc.context.xmpp==null){cnLogSvc.context.xmpp={}}cnLogSvc.context.xmpp.prefixId=this.id;cnLogSvc.setContextId(this.id);if(cnLogSvc.config.to!=null&&cnLogSvc.config.limitIds&&cnLogSvc.config.limitIds.indexOf(this.id)>=0){cnLogSvc.setRemoteHandler(this.onLogMessageToRemote.bind(this));cnLogSvc.log(3,"CNXmpp_()",">>> Re-establishing remote logging")}}this.initializeConnection();if(options&&options.checkConnectionInterval){this.checkConnectionInterval=options.checkConnectionInterval}if(options.checkConnection==true){this.startConnCheck()}}CNXmpp.prototype={initializeConnection:function(useWS){var ua=navigator.userAgent;var self=this;var url=self._wsUrl!=null&&self._wsUrl.trim().length>0?self._wsUrl:self._boshUrls[this._limits.boshUrl.index];cnLogSvc.log(3,"CNXmpp_setConnection","Initializing connection to: "+url);try{if(self.sessionStorageAvailable){if(sessionStorage.getItem("cnUseWS")=="1"||useWS===true){if(self._wsUrl!=null&&self._wsUrl.trim().length>0&&self._wsUrl!=url){url=self._wsUrl;cnLogSvc.log(3,"CNXmpp_()","Connection destination overriden to: "+url)}}else{if((sessionStorage.getItem("cnUseBosh")=="1"||useWS===false)&&this._limits.boshUrl.index<self._boshUrls.length){if(self._boshUrls[this._limits.boshUrl.index]!=null&&self._boshUrls[this._limits.boshUrl.index].trim().length>0&&self._boshUrls[this._limits.boshUrl.index]!=url){url=self._boshUrls[this._limits.boshUrl.index];cnLogSvc.log(3,"CNXmpp_()","Connection destination overriden to: "+url)}}}}}catch(e){}if(ua.indexOf("Windows NT")>=0&&(ua.indexOf("MSIE 9")>=0)){if(this._limits.boshUrl.index<self._boshUrls.length&&self._boshUrls[this._limits.boshUrl.index]!=url){url=self._boshUrls[this._limits.boshUrl.index];cnLogSvc.log(3,"CNXmpp_()","Due to IE browser, connection destination overriden to: "+url)}}self._isWS=url.indexOf("ws:")===0||url.indexOf("wss:")===0?true:false;self.connection=new Strophe.Connection(url);self.connection.rawInput=function(data){self._lastReceivedMsg=Date.now();if(cnLogSvc.config.level>=9){cnLogSvc.log(9,"CNXmpp_rawMsgRcvd",data)}}.bind(self);if(cnLogSvc.config.level>=9){self.connection.rawOutput=function(data){cnLogSvc.log(9,"CNXmpp_rawMsgSent",data)}.bind(self)}self.connection.xmlOutput=function(data){this._lastSentMsg=Date.now();if(self.sessionStorageAvailable){sessionStorage.setItem(self.sessionKeys.rid,$(data).attr("rid"))}}.bind(self);self.connection.onBoshReadyStateChange=function(requestStatus){if(requestStatus===0){if(this.isConnecting&&this._isWS===false){cnLogSvc.log(2,"CNXmpp_onBoshReadyStateChange","Bosh connection failed.");this._limits.connFail.count+=1;this.isConnecting=false;this.reconnect()}}}.bind(self);if(cnLogSvc.config.strophe){Strophe.log=function(level,msg){console.log("Strophe ("+level+"): "+msg)}}},resetConnection:function(){cnLogSvc.log(2,"CNXmpp_resetConnection","Resetting connection by disconnecting current connection and reinitializing connection.");var self=this;self.disconnect();if(self.connection){self.connection.reset()}self.initializeConnection(true)},randomizeBoshUrls:function(boshUrls){var sourceUrls=boshUrls.split("|");var currentIndex=sourceUrls.length,temporaryValue,randomIndex;while(0!==currentIndex){randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;temporaryValue=sourceUrls[currentIndex];sourceUrls[currentIndex]=sourceUrls[randomIndex];sourceUrls[randomIndex]=temporaryValue}return sourceUrls},getStatus:function(){return{connection:{bareJid:this.bareJid,jid:this.connection.jid,isConnected:this.isConnected(),isConnecting:this.isConnecting,isReconnecting:this.isReconnecting},messages:{lastReceivedAt:this._lastReceivedMsg==null?"":(new Date(this._lastReceivedMsg)).toLocaleString(),lastSentAt:this._lastSentMsg==null?"":(new Date(this._lastSentMsg)).toLocaleString()},connectionCheck:{handle:this.checkConnectionHandle==null?false:true,config:{maxLastActivityAge:this.maxLastActivityAge,interval:this.checkConnectionInterval},log:{lastAttemptAt:this._connCheckLog.lastAttemptAt==null?"":(new Date(this._connCheckLog.lastAttemptAt)).toLocaleString(),lastSkipAt:this._connCheckLog.lastSkipAt==null?"":(new Date(this._connCheckLog.lastSkipAt)).toLocaleString(),attemptCount:this._connCheckLog.attemptCount,skipCount:this._connCheckLog.skipCount},lastXmppActivity:this.lastXmppActivity==null?"":(new Date(this.lastXmppActivity)).toLocaleString()}}},getSessionIds:function(){var jid=null;var sid=null;var rid=null;if(this.sessionStorageAvailable){jid=sessionStorage.getItem(this.sessionKeys.jid);sid=sessionStorage.getItem(this.sessionKeys.sid);rid=sessionStorage.getItem(this.sessionKeys.rid);if(jid==null||jid==""||sid==null||sid==""||rid==null||rid==""){return null}else{return{jid:jid,sid:sid,rid:rid}}}else{return null}},initSessionIds:function(jid,sid,rid){cnLogSvc.log(3,"CNXmpp_initSessionIds",{msg:"Initializing session ids if not set.",jid:jid,sid:sid,rid:rid});var sessionIds=this.getSessionIds();if(sessionIds==null){this.setSessionIds(jid,sid,rid)}},setSessionIds:function(jid,sid,rid){if(this.sessionStorageAvailable){cnLogSvc.log(3,"CNXmpp_setSessionIds",{msg:"Caching session ids.",jid:jid,sid:sid,rid:rid});sessionStorage.setItem(this.sessionKeys.jid,jid);sessionStorage.setItem(this.sessionKeys.sid,sid);sessionStorage.setItem(this.sessionKeys.rid,rid)}},clearSessionIds:function(){if(this.sessionStorageAvailable){cnLogSvc.log(3,"CNXmpp_clearSessionIds","Clearing session ids.");sessionStorage.setItem(this.sessionKeys.jid,"");sessionStorage.setItem(this.sessionKeys.sid,"");sessionStorage.setItem(this.sessionKeys.rid,"")}},isConnected:function(){return this.connection.connected},connect:function(bareJid,password,isReconnecting){var self=this;if(this.pollingInterval!==null){this._saveConnectionStatus(4,"CNXmpp_connect","XMPP connection polling set.",{xmpp:{jid:bareJid}})}else{if(this.isConnecting===true){cnLogSvc.log(3,"CNXmpp_connect","Skipped connection attempt as a connection is already in progress.")}else{if(this.isConnected()===true){cnLogSvc.log(3,"CNXmpp_connect","Skipped connection attempt as the connection is already active.")}else{if(isReconnecting){cnLogSvc.log(5,"CNXmpp_connect","Connection failed count: "+this._limits.connFail.count+".  Looking for max: "+this._limits.connFail.max);if(this._limits.connFail.useAltProtocol&&this._limits.connFail.count>=this._limits.connFail.max){if(this._isWS){cnLogSvc.log(3,"CNXmpp_connect","Trying Bosh after connection failed count: "+this._limits.connFail.count+".");self.initializeConnection(false);this._limits.boshUrl.index+=1;if(this._limits.boshUrl.index>=this._boshUrls.length){cnLogSvc.log(5,"CNXmpp_connect","Resetting Bosh index to 0 after reaching max of "+this._boshUrls.length);this._limits.boshUrl.index=0}}else{cnLogSvc.log(3,"CNXmpp_connect","Trying websockets after connection failed count: "+this._limits.connFail.count+".");self.initializeConnection(true)}cnLogSvc.log(5,"CNXmpp_connect","Resetting connection failed count to 0 after reaching max of "+this._limits.connFail.max);this._limits.connFail.count=0}}this.resetReconnectDelay();this.isConnecting=true;var sessionIds=this.getSessionIds();cnLogSvc.log(3,"CNXmpp_connect",{bareJid:bareJid,sessionIds:sessionIds,isReconnecting:isReconnecting});this.autoReconnect=true;if(this.sessionStorageAvailable){if(bareJid==null){bareJid=sessionStorage.getItem(this.sessionKeys.bareJid);password=sessionStorage.getItem(this.sessionKeys.password)}else{sessionStorage.setItem(this.sessionKeys.bareJid,bareJid);sessionStorage.setItem(this.sessionKeys.password,password)}}else{if(bareJid){window.regBareJid=bareJid;window.regBarePswd=password}}if(sessionIds!=null){var clearValues=false;if(bareJid==null){cnLogSvc.log(3,"CNXmpp_connect",{msg:"No reference bareJid available to validate session jid.",jid:sessionIds.jid});clearValues=true}else{if(sessionIds.jid.indexOf(bareJid)<0){cnLogSvc.log(3,"CNXmpp_connect",{msg:"Session jid does not match the reference bare Jid.",bareJid:bareJid,jid:sessionIds.jid});clearValues=true}else{if(this._limits.attach.count>=this._limits.attach.max){cnLogSvc.log(1,"CNXmpp_connect",{msg:"Maximum attach attempts of reached.",bareJid:bareJid,limit:this._limits.attach.max});clearValues=true}}}if(clearValues===true){this.clearSessionIds();sessionIds=null}}var logSrvJSON={xmpp:{sessionIds:sessionIds,isReconnecting:isReconnecting,isWS:this._isWS,prefixId:this.id}};if(this.connection.addHandlers.length==0){this.connection.addHandler(this.onMessage.bind(this),null,"message",null,null,null);this.connection.addHandler(this.onIQ.bind(this),null,"iq",null,null,null);this.connection.addHandler(this.onPresence.bind(this),null,"presence",null,null,null)}if(sessionIds==null||this._isWS===true){if(bareJid!=null&&password!=null){this._connect(bareJid,password,"Connecting to session with passed in jabber id.",logSrvJSON)}else{if(window.regBareJid!=null&&window.regBarePswd!=null){this._connect(window.regBareJid,window.regBarePswd,"Connecting to session with window jabber vars.",logSrvJSON)}else{var authHeaders={};if(CN.getFromLocal("vstid")!=null){authHeaders["CN-Vst-ID"]=CN.getFromLocal("vstid")}$.ajax({url:this.getAuthUrl,headers:authHeaders,success:function(data){if(data.sid==null||data.rid==null||self._isWS===true){if(self.sessionStorageAvailable){sessionStorage.setItem(self.sessionKeys.bareJid,data.jid);sessionStorage.setItem(self.sessionKeys.password,data.pass)}self._connect(data.jid,data.pass,"Connecting to session with ajax supplied jabber id.",logSrvJSON)}else{if(data.jid&&self.sessionStorageAvailable){sessionStorage.setItem(self.sessionKeys.bareJid,data.jid)}self._attach(data.jid,data.sid,data.rid,"Attaching to session with ajax supplied jid.",logSrvJSON)}},error:function(jqXHR,textStatus,errorThrown){cnLogSvc.log(1,"CNXmpp_connect",{error:errorThrown,msg:textStatus+" : '"+self.getAuthUrl+"' - "+errorThrown,headers:authHeaders})}})}}}else{this._attach(sessionIds.jid,sessionIds.sid,sessionIds.rid,"Attach to session jid.",logSrvJSON)}}}}},_connect:function(jid,password,message,logSrvJSON){try{this.bareJid=jid;cnLogSvc.addExtSvcMetadata("jid",this.bareJid);this.pubsubJid="pubsub."+this.bareJid.split("@")[1];logSrvJSON.xmpp.jid=jid;cnLogSvc.context.xmpp.bareJid=this.bareJid;this._saveConnectionStatus(4,"CNXmpp__connect",message,logSrvJSON);cnLogSvc.log(3,"CNXmpp__connect",{jid:jid});this.connection.connect(jid,password,this.onConnect.bind(this))}catch(e){cnLogSvc.log(1,"CNXmpp__connect",e)}},_attach:function(jid,sid,rid,message,logSrvJSON){try{this.bareJid=jid.split("/")[0];cnLogSvc.addExtSvcMetadata("jid",this.bareJid);this.pubsubJid="pubsub."+this.bareJid.split("@")[1];logSrvJSON.xmpp.jid=jid;cnLogSvc.context.xmpp.bareJid=this.bareJid;this._saveConnectionStatus(4,"CNXmpp__attach",message,logSrvJSON);cnLogSvc.log(3,"CNXmpp__attach",{jid:jid});this.connection.attach(jid,sid,parseInt(rid,10)+1,this.onConnect.bind(this))}catch(e){cnLogSvc.log(1,"CNXmpp__attach",e)}},reconnect:function(skipMaxCheck){if(skipMaxCheck==null){skipMaxCheck=false}if(this.isReconnecting){cnLogSvc.log(2,"CNXmpp_reconnect","Already reconnecting.  Skip attempt.")}else{if(this.isConnecting){cnLogSvc.log(2,"CNXmpp_reconnect","Already connecting.  Skip attempt.")}else{if(skipMaxCheck===false&&this._limits.reconnect.count>=this._limits.reconnect.max){if(this._reconnectDelayTimeout){cnLogSvc.log(2,"CNXmpp_reconnect","Reached maximum reconnect attempts.  There is already a reconnect request queued.")}else{cnLogSvc.log(2,"CNXmpp_reconnect","Reached maximum reconnect attempts.  Delaying reconnect call by "+this._limits.reconnect.delay+"ms.");this._reconnectDelayTimeout=setTimeout(this.reconnectDelayTimeout.bind(this),this._limits.reconnect.delay)}}else{this.isReconnecting=true;this._limits.reconnect.count+=1;cnLogSvc.log(3,"CNXmpp_reconnect","Reconnecting attempt "+this._limits.reconnect.count);this.clearSessionIds();this.connection.reset();this.connect(null,null,this.isReconnecting)}}}},reconnectDelayTimeout:function(){this._reconnectDelayTimeout=null;if(this.isConnected()==false){this.isConnecting=false;cnLogSvc.log(2,"CNXmpp_reconnectDelayTimeout","Reconnect delay expired.  Attempting to reconnect after "+this._limits.reconnect.delay+" ms delay.");this.reconnect(true)}},resetReconnectDelay:function(){if(this._reconnectDelayTimeout){clearTimeout(this._reconnectDelayTimeout);this._reconnectDelayTimeout=null;cnLogSvc.log(5,"CNXmpp_resetReconnectDelay","Reconnect delay reset.")}},disconnect:function(){cnLogSvc.log(3,"CNXmpp_disconnect");this.clearSessionIds();cnLogSvc.resetConfig();this.autoReconnect=false;this.connection.flush();this.connection.disconnect("disconnect");this.isConnecting=false},enableCarbonCopy:function(){try{var id=this.connection.getUniqueId("enable");var iqOptions={type:"set",from:this.connection.jid,id:id,xmlns:Strophe.NS.CLIENT};cnLogSvc.log(4,"CNXmpp_enableCarbonCopy",iqOptions);var iq=$iq(iqOptions).c("enable",{xmlns:"urn:xmpp:carbons:2"});this.connection.sendIQ(iq)}catch(e){cnLogSvc.log(1,"CNXmpp_enableCarbonCopy",e)}},getServerInfo:function(domain,node){cnLogSvc.log(4,"CNXmpp_getServerInfo",{domain:domain,node:node});try{var iqOptions={type:"get",to:domain};var queryOptions={xmlns:Strophe.NS.DISCO_ITEMS};if(node!=null){queryOptions.node=node}var iq=$iq(iqOptions).c("query",queryOptions);this.connection.sendIQ(iq)}catch(e){cnLogSvc.log(1,"CNXmpp_getServerInfo",e)}},sendConnectionCheck:function(sessionId,node){if(node==null){cnLogSvc.log(4,"CNXmpp_sendConnectionCheck","Send connection check to self.",{to:this.bareJid});var msg=$msg({to:this.bareJid,from:this.bareJid,type:"connectionCheck",subtype:""}).c("body").t(JSON.stringify("[CNXmpp_CONNX]"));this.connection.send(msg.tree())}else{cnLogSvc.log(4,"CNXmpp_sendConnectionCheck",'Send connection check to pubsub "'+node+'"',{sessionId:sessionId,node:node});this.publish({node:node,body:{sessionId:sessionId,body:"[CNXmpp_CONNX]"}})}},sendPing:function(options){if(options==null){options={}}if(options.sessionId&&options.node){cnLogSvc.log(4,"CNXmpp_sendPing","Send ping.",{sessionId:options.sessionId,node:options.node});this.publish({node:optons.node,body:{sessionId:options.sessionId,body:"[CNXmpp_PING]"}})}else{if(options.jid){cnLogSvc.log(4,"CNXmpp_sendPing","Send ping.",{to:options.jid});var msg=$msg({to:options.jid,from:this.bareJid,type:"ping",subtype:""}).c("body").t(JSON.stringify("[CNXmpp_PING]"));this.connection.send(msg.tree())}else{cnLogSvc.log(2,"CNXmpp_sendPing","Unable to send ping.  Invalid options passed in.",options)}}},sendPong:function(options){if(options==null){options={}}if(options.node){cnLogSvc.log(4,"CNXmpp_sendPong","Send pong.",{node:options.node});this.publish(options)}else{if(options.requestorJid){cnLogSvc.log(4,"CNXmpp_sendPong","Send pong.",{to:options.requestorJid});var msg=$msg({to:options.requestorJid,from:this.bareJid,type:"pong",subtype:""}).c("body").t(JSON.stringify("[CNXmpp_PONG]"));this.connection.send(msg.tree())}else{cnLogSvc.log(2,"CNXmpp_sendPong","Unable to send pong.  Invalid options passed in.",options)}}},startConnCheck:function(){if(this.checkConnectionHandle==null){this.checkConnectionHandle=setInterval(this.onCheckConnection.bind(this),this.checkConnectionInterval);cnLogSvc.log(3,"CNXmpp_startConnCheck","Started connection checking timer.",{details:{interval:this.checkConnectionInterval}})}},stopConnCheck:function(){if(this.checkConnectionHandle){clearInterval(this.checkConnectionHandle);this.checkConnectionHandle=null;cnLogSvc.log(3,"CNXmpp_stopConnCheck","Stopped connection checking timer.",{details:{interval:this.checkConnectionInterval}})}},onCheckConnection:function(){if(this.isConnected()===true){var checkConnection=true;if(this.lastXmppActivity!=null){var delta=Date.now()-this.lastXmppActivity;if(delta<=this.maxLastActivityAge){cnLogSvc.log(4,"CNXmpp_onCheckConnection","Skip check of connection. "+delta+" ms since last xmpp incoming activity.",{details:{lastXmppActivity:this.lastXmppActivity,delta:delta,maxAge:this.maxLastActivityAge}});checkConnection=false;this._connCheckLog.lastSkipAt=Date.now();this._connCheckLog.skipCount+=1}}if(checkConnection){this._connCheckLog.lastAttemptAt=Date.now();this._connCheckLog.attemptCount+=1;if(this.events.onCheckConnection){this.events.onCheckConnection(this.lastXmppActivity)}else{this.sendConnectionCheck()}}}else{cnLogSvc.log(2,"CNXmpp_onCheckConnection","Skip check of connection because it is NOT connected.")}},onConnect:function(status){var self=this;var logSrvJSON={xmpp:{jid:this.connection.jid,status:status}};try{this.isReconnecting=false;this.resetReconnectDelay();if(status==Strophe.Status.CONNECTED||status==Strophe.Status.ATTACHED){this.isConnecting=false;if(status==Strophe.Status.CONNECTED){this._saveConnectionStatus(3,"CNXmpp_onConnect","CONNECTED",logSrvJSON);this._limits.attach.count=0}else{this._saveConnectionStatus(3,"CNXmpp_onConnect","ATTACHED",logSrvJSON);this._limits.attach.count++}this._limits.reconnect.count=0;this._limits.connFail.count=0;if(this.sessionStorageAvailable){sessionStorage.setItem(this.sessionKeys.jid,this.connection.jid);sessionStorage.setItem(this.sessionKeys.sid,this.connection._proto.sid)}cnLogSvc.context.xmpp.bareJid=this.bareJid;this.connection.send($pres());this._processQueuedMessages();if(this.events.onConnected){this.events.onConnected(this.connection.jid)}}else{if(status==Strophe.Status.DISCONNECTED){this._saveConnectionStatus(2,"CNXmpp_onConnect","DISCONNECTED",logSrvJSON);this.connected=false;this.isConnecting=false;if(this.events.onDisconnected){this.events.onDisconnected()}if(this.autoReconnect){this.reconnect()}}else{if(status==Strophe.Status.ERROR||status==Strophe.Status.CONNFAIL){if(status==Strophe.Status.ERROR){this._saveConnectionStatus(1,"CNXmpp_onConnect","ERROR",logSrvJSON)}else{this._saveConnectionStatus(2,"CNXmpp_onConnect","CONNFAIL");this._limits.connFail.count+=1}this.isConnecting=false}else{if(status==Strophe.Status.AUTHFAIL){this._saveConnectionStatus(2,"CNXmpp_onConnect","AUTHFAIL",logSrvJSON);this.isConnecting=false;if(this._attemptedToRegister===0){var regJid=window.regBareJid;var regPswd=window.regBarePswd;if(this.sessionStorageAvailable){regJid=sessionStorage.getItem(this.sessionKeys.bareJid);regPswd=sessionStorage.getItem(this.sessionKeys.password)}cnLogSvc.log(4,"CNXmpp_onConnect","Auto register User: "+regJid);this.register(regJid,regPswd,regJid);this._attemptedToRegister+=1;if(this.autoReconnect){this.reconnect()}}}else{switch(status){case 1:cnLogSvc.log(4,"CNXmpp_onConnect","CONNECTING");break;case 3:cnLogSvc.log(4,"CNXmpp_onConnect","AUTHENTICATING");break;case 7:cnLogSvc.log(4,"CNXmpp_onConnect","DISCONNECTING");break;case 9:cnLogSvc.log(4,"CNXmpp_onConnect","REDIRECT");break;default:this._saveConnectionStatus(4,"CNXmpp_onConnect",{status:status},logSrvJSON);break}}}}}}catch(e){cnLogSvc.log(1,"CNXmpp_onConnect",e)}},register:function(username,password,email){try{var id=this.connection.getUniqueId("register");var domain=this.domain?this.domain:(this.bareJid?this.bareJid.split("@")[1]:username.split("@")[1]);var iqOptions={type:"set",id:id};var iq=$iq(iqOptions).c("query",{xmlns:"jabber:iq:register"}).c("username").t(username).up().c("password").t(password).up().c("email").t(email);cnLogSvc.log(4,"CNXmpp_register",iq.toString().replace(password,""));this.connection.sendIQ(iq)}catch(e){cnLogSvc.log(1,"CNXmpp_register",e.toString())}},getRegistrationInfo:function(){try{var id=this.connection.getUniqueId("regInfo");var domain=this.connection.bareJid.split("@")[1];var iqOptions={type:"get",id:id,to:domain};var iq=$iq(iqOptions).c("query",{xmlns:"jabber:iq:register"});cnLogSvc.log(4,"CNXmpp_getRegistrationInfo",iq);this.connection.sendIQ(iq)}catch(e){cnLogSvc.log(1,"CNXmpp_getRegistrationInfo",e.toString())}},createPubSubNode:function(node){try{var nodeConfig={"pubsub#notify_retract":"0","pubsub#persist_items":"0","pubsub#send_last_published_item":"never","pubsub#presence_based_delivery":"0","pubsub#notification_type":"normal","pubsub#access_model":"open","pubsub#publish_model":"open"};this.connection.pubsub.createNode(node,nodeConfig,this.onPubSubNodeCreated.bind(this))}catch(e){cnLogSvc.log(1,"CNXmpp_createPubSubNode",e.toString())}},onPubSubNodeCreated:function(msg){try{var type=msg.getAttribute("type");var id=msg.getAttribute("id");if(type=="error"){var data=msg.getElementsByTagName("error");var error={type:"ERROR"};var err=this._processError(data);if(err.code!="409"){err.id=id;error.details=err;error.innerHTML=data.innerHTML;cnLogSvc.log(2,"CNXmpp_onPubSubNodeCreated",error)}}else{if(this.events.onPubSubNodeCreated){this.events.onPubSubNodeCreated(msg)}else{cnLogSvc.log(5,"CNXmpp_onPubSubNodeCreated",{msg:msg.outerHTML})}}}catch(e){cnLogSvc.log(1,"CNXmpp_onPubSubNodeCreated",e.toString())}finally{return false}},subscribe:function(nodes){try{for(var node in nodes){this.connection.pubsub.subscribe(node,[],null,this.onSuccessCB.bind(this),this.onErrorCB.bind(this),true)}}catch(e){cnLogSvc.log(1,"CNXmpp_subscribe",e.toString())}},getSubscriptions:function(){try{var id=this.connection.getUniqueId("subscriptions");var domain=this.bareJid.split("@")[1];var iqOptions={type:"get",id:id,from:this.bareJid,to:"pubsub."+domain};var iq=$iq(iqOptions).c("pubsub",{xmlns:"http://jabber.org/protocol/pubsub"}).c("subscriptions");cnLogSvc.log(4,"CNXmpp_getSubscriptions",iq.toString());this.connection.sendIQ(iq)}catch(e){cnLogSvc.log(1,"CNXmpp_getSubscriptions",e.toString())}},getSubscribers:function(sessionId,node){cnLogSvc.log(4,"CNXmpp_getSubscribers",{sessionId:sessionId,node:node});try{var id=this.connection.getUniqueId("subscribers: "+sessionId);var domain=this.bareJid.split("@")[1];var iqOptions={type:"get",id:id,to:this.pubsubJid};var iq=$iq(iqOptions).c("pubsub",{xmlns:"http://jabber.org/protocol/pubsub"}).c("subscriptions",{node:node});cnLogSvc.log(4,"CNXmpp_getSubscribers",iq.toString());this.connection.sendIQ(iq)}catch(e){cnLogSvc.log(1,"CNXmpp_getSubscribers",e)}},parseMessage:function(msg){var preParse="";try{var from=msg.getAttribute("from").split("/")[0];var body=msg.getElementsByTagName("body");if(from.indexOf("pubsub")===0&&body.length>0){var items=msg.getElementsByTagName("items");var node=items[0].getAttribute("node");var type="chat";var preParse=$(body[0]).text();var json=JSON.parse(preParse);from=json.from;if(json.body&&json.body.indexOf("[CNXmpp_")==0){if(json.body.indexOf("[CNXmpp_PING]")==0){type="ping"}else{if(json.body.indexOf("[CNXmpp_PONG]")==0){type="pong"}else{if(json.body.indexOf("[CNXmpp_CONNX]")==0){type="connectionCheck"}}}}return{type:type,node:node,from:from,fromSession:from,event:json}}else{var type=msg.getAttribute("type");var subtype=msg.getAttribute("subtype");var json={};if(type=="chat"&&body.length>0){var rawJson=Strophe.getText(body[0]);var preParse=$("<div/>").html(rawJson).text();json=JSON.parse(preParse);type=subtype||"chat"}else{if((type=="sendLog"||type=="sendTrace"||type=="reload")&&body.length>0){var rawJson=Strophe.getText(body[0]);var preParse=$("<div/>").html(rawJson).text();json=JSON.parse(preParse)}else{if(type=="connectionCheck"){json={}}else{if(type=="error"){var data=msg.getElementsByTagName("error");json=this._processError(data)}else{cnLogSvc.log(2,"CNXmpp_parseMessage",{type:type,msg:msg.outerHTML})}}}}return{type:type,from:from,fromSession:msg.getAttribute("from"),event:json}}}catch(e){cnLogSvc.log(1,"CNXmpp_parseMessage",e,{params:{from:from,msg:msg.outerHTML,preParse:preParse}})}return null},onMessage:function(msg){var data=this.parseMessage(msg);if(data==null){cnLogSvc.log(5,"CNXmpp_onMessage","Nothing parsed.");return true}else{this.lastXmppActivity=Date.now();if(data.type=="connectionCheck"){if(data.node){cnLogSvc.log(5,"CNXmpp_onMessage","Received connection check from "+data.from+" to pubsub "+data.node+".")}else{if(data.from&&data.from.indexOf(this.bareJid)>=0){cnLogSvc.log(5,"CNXmpp_onMessage","Received own connection check.")}else{cnLogSvc.log(5,"CNXmpp_onMessage","Received connection check from "+data.from+".")}}return true}else{if(data.type=="sendLog"){if(data.event.limitIds&&data.event.limitIds.indexOf(this.id)>=0){cnLogSvc.log(3,"CNXmpp_onMessage","Support Log Requested by "+data.from,{extSvc:{info:CN.getStatus()}})}return true}else{if(data.type=="sendTrace"){if(data.event.limitIds&&data.event.limitIds.indexOf(this.id)>=0){if(window.cnTrace){cnLogSvc.log(3,"CNXmpp_onMessage",JSON.stringify(window.cnTrace))}else{cnLogSvc.log(3,"CNXmpp_onMessage","cnTrace Requested by "+data.from+" however it is NOT available.")}}return true}else{if(data.type=="reload"){if(data.event.limitIds&&data.event.limitIds.indexOf(this.id)>=0){cnLogSvc.log(3,"CNXmpp_onMessage","Browser Reload Requested by "+data.from,{extSvc:{info:CN.getStatus()}});document.location.reload(true)}return true}else{if(data.type=="ping"||data.type=="pong"){if(this.id=="cx"){if(data.type=="ping"){if(data.from==this.connection.jid){cnLogSvc.log(2,"CNXmpp_onMessage",data.event.body+" SessionId: "+data.event.sessionId+"; Node: "+data.node+"; Requestor: "+data.from)}if(this.events.onPingReceived){this.events.onPingReceived(data)}else{cnLogSvc.logToExtService({message:data.event.body+"Node: "+data.node,params:{sessionId:data.event.sessionId,node:data.node,requestor:data.from,receivedBy:this.connection.jid},context:{component:"cn-xmpp",action:"ping"}})}if(data.from!=this.connection.jid){this.sendPong({node:data.node,requestorJid:data.from,body:{sessionId:data.event.sessionId,body:"[CNXmpp_PONG]",node:data.node,userAgent:navigator.userAgent,requestorJid:data.from}})}}else{if(data.event.requestorJid==this.connection.jid){cnLogSvc.log(2,"CNXmpp_onMessage",data.event.body+"; SessionId: "+data.event.sessionId+"; Requestor: "+data.event.requestorJid+"; Sent By: "+data.from+"; UA: "+data.event.userAgent)}if(this.events.onPongReceived){this.events.onPongReceived(data)}else{cnLogSvc.logToExtService({message:data.event.body,params:{sessionId:data.event.sessionId,node:data.node,requestor:data.event.requestorJid,receivedBy:this.connection.jid,sentBy:data.from,sentByUA:data.event.userAgent},context:{component:"cn-xmpp",action:"pong"}})}}}return true}else{if(data.from&&data.from.indexOf(this.bareJid)>=0&&!(data.event&&(data.event.type==1000||data.event.type==1001))){if(data.event.id){cnLogSvc.log(5,"CNXmpp_onMessage","Own message id: "+data.event.id);if(this.events.onOwnMessageReceived){this.events.onOwnMessageReceived(data.event)}}else{cnLogSvc.log(5,"CNXmpp_onMessage","Own system message.  Type: "+data.event.type+"; Cat: "+data.event.category)}return true}}}}}}}cnLogSvc.log(5,"CNXmpp_onMessage",{msg:"===>>",type:data.type});try{if(data.type=="chat"){if(data.event.event_trigger){if(this.events.onEventTrigger){this.events.onEventTrigger(data.from,data.event)}}else{if(data.event.trace_event){if(this.events.onTraceEvent){this.events.onTraceEvent(data.from,data.event)}}else{if(this.events.onChatMessage){this.events.onChatMessage(data.from,data.event)}}}}else{if(data.type=="error"){cnLogSvc.log(1,"CNXmpp_onMessage",data.event)}else{if(data.type=="config"){if(data.event.limitIds&&data.event.limitIds.indexOf(this.id)>=0){if(data.event.level>0&&data.event.to!=null){cnLogSvc.setRemoteHandler(this.onLogMessageToRemote.bind(this));cnLogSvc.log(3,"CNXmpp_onMessage",{msg:"Remote logging set.",config:data.event})}else{cnLogSvc.log(3,"CNXmpp_onMessage",{msg:"Resetting custom / remote logging.",config:data.event});cnLogSvc.resetRemoteConfig()}cnLogSvc.setConfig(data.event)}}else{if(data.type=="log"){if(this.events.onLogRemoteMessage){this.events.onLogRemoteMessage(data)}}else{cnLogSvc.log(3,"CNXmpp_onMessage",msg.outerHTML);cnLogSvc.log(3,"CNXmpp_onMessage",data.event)}}}}}catch(e){cnLogSvc.log(1,"CNXmpp_onMessage",e)}finally{return true}},onIQ:function(msg){try{var id=msg.getAttribute("id");var to=msg.getAttribute("to");var from=msg.getAttribute("from");var type=msg.getAttribute("type");var pubsub=msg.getElementsByTagName("pubsub");if(type=="result"){if(pubsub.length>0){if(this.events.onGotSubscribers){this.events.onGotSubscribers(msg)}else{var subscriptions=msg.getElementsByTagName("subscriptions");var subscription=msg.getElementsByTagName("subscription");if(subscription.length>0&&cnLogSvc.config.level>=4){for(var i=0;i<subscription.length;i++){var jid=subscription[i].getAttribute("jid");var status=subscription[i].getAttribute("subscription");var node=subscription[i].getAttribute("node");cnLogSvc.log(4,"CNXmpp_onIQ",{item:i,subscription:status,node:node,jid:jid})}}else{cnLogSvc.log(5,"CNXmpp_onIQ",{msg:msg.outerHTML})}}}else{cnLogSvc.log(5,"CNXmpp_onIQ",{msg:msg.outerHTML})}}else{if(type=="error"){var data=msg.getElementsByTagName("error");var error={type:"ERROR"};var err=this._processError(data);err.id=id;if(pubsub.length>0){if(this.events.onErrorGettingSubscribers){this.events.onErrorGettingSubscribers(err,msg)}else{error.details=err;error.innerHTML=data.innerHTML;cnLogSvc.log(2,"CNXmpp_onIQ",error)}}}else{cnLogSvc.log(5,"CNXmpp_onIQ",{msg:msg.outerHTML})}}}catch(e){cnLogSvc.log(1,"CNXmpp_onIQ",e)}finally{return true}},onPresence:function(msg){try{var to=msg.getAttribute("to");var from=msg.getAttribute("from");var type=msg.getAttribute("type");var xmlns=msg.getAttribute("xmlns");var data=msg.getElementsByTagName("body");if(type=="subscribe"){cnLogSvc.log(3,"CNXmpp_onPresence",{type:type,outer:msg.outerHTML})}else{if(type=="unavailable"&&xmlns==Strophe.NS.CLIENT){if(from.indexOf(this.bareJid)>=0&&from!=this.connection.jid){cnLogSvc.log(3,"CNXmpp_onPresence","OFFLINE from different location: "+from)}else{cnLogSvc.log(3,"CNXmpp_onPresence","OFFLINE: "+from)}if(cnLogSvc.config.to){if(from.indexOf(cnLogSvc.config.to)>=0){cnLogSvc.log(3,"CNXmpp_onPresence","Listener OFFLINE.  Reset cnLogSvc.  Stop sending remote log messages.");cnLogSvc.resetRemoteConfig()}}}else{if(type==null&&xmlns==Strophe.NS.CLIENT){if(from.indexOf(this.bareJid)>=0&&from!=this.connection.jid){cnLogSvc.log(3,"CNXmpp_onPresence","ONLINE in different location: "+from)}else{cnLogSvc.log(3,"CNXmpp_onPresence","ONLINE: "+from)}}else{cnLogSvc.log(5,"CNXmpp_onPresence",{msg:msg.outerHTML})}}}}catch(e){cnLogSvc.log(1,"CNXmpp_onPresence",e)}finally{return true}},onPublished:function(msg){if(msg.id&&msg.id.indexOf("mid:")>=0&&this.events.onMessagePublished){cnLogSvc.log(5,"CNXmpp_onPublished","mid = "+msg.id);this.events.onMessagePublished(msg)}else{cnLogSvc.log(5,"CNXmpp_onPublished",{msg:msg.outerHTML})}return false},onSuccessCB:function(msg){cnLogSvc.log(5,"CNXmpp_onSuccessCB",{msg:msg.outerHTML});return false},onErrorCB:function(msg){cnLogSvc.log(1,"CNXmpp_onErrorCB",{msg:msg.outerHTML});return false},onLogMessageToRemote:function(msg,config){try{if(this.connection&&this.connection._proto&&this.connection._proto.socket&&config.to){if(this.isConnected()){var log=null;var header={to:config.to,type:"chat",subtype:"log"};if(config.queue){this._queueRemoteLogMessages.push(msg);if(this._queueRemoteLogMessages.length>=config.queue){log=$msg(header).c("body").t(JSON.stringify({xmppId:this.id,initTS:cnLogSvc.context.initTS,message:this._queueRemoteLogMessages}))}}else{if(this._queueRemoteLogMessages.length==0){log=$msg(header).c("body").t(JSON.stringify({xmppId:this.id,initTS:cnLogSvc.context.initTS,message:msg}))}else{this._queueRemoteLogMessages.push(msg);log=$msg(header).c("body").t(JSON.stringify({xmppId:this.id,initTS:cnLogSvc.context.initTS,message:this._queueRemoteLogMessages}))}}if(log){this.connection.send(log.tree());this._queueRemoteLogMessages.length=0}}else{this._queueRemoteLogMessages.push(msg)}}}catch(e){cnLogSvc.resetRemoteConfig();cnLogSvc.log(1,"CNXmpp_onLogMessageToRemote",e)}},sendChat:function(data){try{if(this.isConnected()){if(data.from==null){data.from=Strophe.getNodeFromJid(this.connection.jid)}var msg=$msg({to:data.to,from:data.from,type:"chat",subtype:"chat"}).c("body").t(JSON.stringify(data.body));cnLogSvc.log(5,"CNXmpp_sendChat","Send chat message.");this.connection.send(msg.tree());if(this.events.onSendMessage){this.events.onSendMessage(data.body,false)}}else{cnLogSvc.log(5,"CNXmpp_sendChat","Queue chat message.");this._queueSend.push(data);if(this.events.onSendMessage){this.events.onSendMessage(data.body,true)}}}catch(e){cnLogSvc.log(1,"CNXmpp_sendChat",e)}},sendConfig:function(data){try{if(data.from==null){data.from=Strophe.getNodeFromJid(this.connection.jid)}var msg=$msg({to:data.to,from:data.from,type:"chat",subtype:"config"}).c("body").t(JSON.stringify(data.body));this.connection.send(msg.tree())}catch(e){cnLogSvc.log(1,"CNXmpp_sendConfig",e)}},publish:function(data){var cmd=data.body.body;var isCommand=cmd&&cmd.indexOf("[CNXmpp_")==0?true:false;var skipCommands="[CNXmpp_PING],[CNXmpp_PONG],[CNXmpp_CONNX]";if(isCommand&&skipCommands.indexOf(cmd)==-1){if(cmd.indexOf("[CNXmpp_LS")==0){var config=cmd.split("]");var level=0;if(config.length>1&&!isNaN(config[1])){level=config[1]}if(config[0]=="[CNXmpp_LSS"){cnLogSvc.setConfig({level:level})}else{cnLogSvc.setLevel(level)}}else{if(cmd=="[CNXmpp_RECONNECT]"){this.reconnect()}else{if(cmd=="[CNXmpp_DISCONNECT]"){this.disconnect()}else{if(cmd=="[CNXmpp_CONNX_OFF]"){this.stopConnCheck()}else{if(cmd=="[CNXmpp_CONNX_ON]"){this.startConnCheck()}}}}}}else{try{if(this.isConnected()){data.body.from=this.connection.jid;var mid=data.body.id?":mid:"+data.body.id:"";var id=this.connection.getUniqueId("publish"+mid);var iq=$iq({type:"set",to:this.pubsubJid,id:id}).c("pubsub",{xmlns:"http://jabber.org/protocol/pubsub"}).c("publish",{node:data.node,jid:this.connection.jid}).c("item").c("entry",{xmlns:"http://www.w3.org/2005/Atom"}).c("body").t(JSON.stringify(data.body)).up().c("updated").t(new Date().toISOString()).up();cnLogSvc.log(5,"CNXmpp_publish","Publish id "+id);this.connection.sendIQ(iq,this.onPublished.bind(this));if(!isCommand&&this.events.onPublishMessage){this.events.onPublishMessage(data.body,false)}}else{if(data.body.id){cnLogSvc.log(5,"CNXmpp_publish","Queue message id: "+data.body.id)}else{cnLogSvc.log(5,"CNXmpp_publish","Queue message.")}this._queuePublish.push(data);if(!isCommand&&this.events.onPublishMessage){this.events.onPublishMessage(data.body,true)}}}catch(e){cnLogSvc.log(1,"CNXmpp_publish",e)}}},_processQueuedMessages:function(){try{if(this._queueSend.length>0){cnLogSvc.log(3,"CNXmpp__processQueuedMessages","Processing "+this._queueSend.length+" queued send requests.");for(var i=0;i<this._queueSend.length;i++){this.sendChat(this._queueSend[i])}this._queueSend.length=0}if(this._queuePublish.length>0){cnLogSvc.log(3,"CNXmpp__processQueuedMessages","Processing "+this._queuePublish.length+" queued publish requests.");for(var i=0;i<this._queuePublish.length;i++){this.publish(this._queuePublish[i])}this._queuePublish.length=0}}catch(e){cnLogSvc.log(1,"CNXmpp__processQueuedMessages",e)}},_processError:function(data){var details={};details.code=data[0].getAttribute("code");details.type=data[0].getAttribute("type");for(var i=0;i<data[0].childNodes.length;i++){details["reason"+i]=data[0].childNodes[i].tagName}return details},_saveConnectionStatus:function(level,src,options,json){if(this.id=="cx"){try{if(json&&json.xmpp&&json.xmpp.jid&&json.xmpp.bareJid==null){json.xmpp.bareJid=json.xmpp.jid.split("/")[0]}}catch(e){cnLogSvc.log(1,"CNXmpp__saveConnectionStatus",e)}if(this.events.onLogConnectionStatus){this.events.onLogConnectionStatus(level,src,options,json)}else{cnLogSvc.log(level,src,options,json)}}else{cnLogSvc.log(level,src,options)}}};function CNChatX(boshUrl,wsUrl,appServer,xmppPolling,vid){var getAuthUrl="/users/jabber_info?v="+(vid==null?"":vid);this.jid=null;this.pubSubNode=null;this.chatSessionId=null;this.isCustomer=true;this.multiSessions=false;this.appServer=appServer;this.popupState=1;this.pluginWindow=null;this.pluginOrigin=null;this.agentJoined=false;this.ts=new Date().getTime();this._xmpp=new CNXmpp(boshUrl,wsUrl,{id:"lv",events:this,polling:xmppPolling})}CNChatX.prototype={isConnected:function(){return this._xmpp!=null&&this._xmpp.isConnected()},connect:function(bareJid,password){this._xmpp.connect(bareJid,password)},logout:function(){this._xmpp.disconnect()},disconnect:function(){},initSessionIds:function(jid,sid,rid){this._xmpp.initSessionIds(jid,sid,rid)},setSessionIds:function(jid,sid,rid){this._xmpp.setSessionIds(jid,sid,rid)},clearSessionIds:function(){this._xmpp.clearSessionIds()},playNewRequestSound:function(){},playNewMessageSound:function(){try{if(this.popupState!=1&&!CN.muted&&CN.audioAutoPlayEnabled){document.getElementById("chat_sound_new_message").play()}}catch(e){}},onConnected:function(jid){cnLogSvc.log(5,"CNChatX_onConnected","Connected");this.jid=jid},onChatMessage:function(from,json){cnLogSvc.log(5,"CNChatX_onChatMessage",{from:from,json:json});var self=this;if(self.multiSessions){self.chatSessionId=json.csid}if(json.type==1){CN.postInterMessage({type:"new_chat_message",message:json})}if(json.csid!=self.chatSessionId&&json.uvid!=self.visitorId){return true}try{var meClass=(!this.isCustomer&&json.dealer?"me":"");if(json.type==1000||json.type==1001){try{_sendCustomAnalyticEvent(json)}catch(e){}try{if(json.event_name){var eventName=json.event_name;if(self.trackingWindowMessages&&self.trackingWindowMessages[eventName]){for(var i=0;i<self.trackingWindowMessages[eventName].length;i++){CN.postInterMessage({type:"post_top_win_message",message:self.trackingWindowMessages[eventName][i]})}}}else{if(json.eventData){CN.postInterMessage({type:"post_top_win_message",message:json.eventData})}else{if(json.event==16){CN.postInterMessage({type:"data_layer",event_data:json.event_data})}}}}catch(e){}return true}return true}catch(e){cnLogSvc.log(1,"CNChatX_onChatMessage",e)}}};var cnVideoChat=null;function CNVideoChat(chatSessionId,scope){this.scope=scope;this.containerId=(scope||"")+"video_chat";this.participantDivId=(scope||"")+"video_chat_particicpant";this.participantMeDivId=(scope||"")+"video_chat_me";this.chatSessionId=chatSessionId;cnVideoChat=this;document.addEventListener("fullscreenchange",function(){if(!document.fullscreenElement){cnVideoChat.fullscreen=false;CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshUIEvent"});cnVideoChat.logEvent({event:"fullscreen",status:0})}});document.addEventListener("resize",function(){setTimeout(function(){cnVideoChat.calcVideoDimensions()},2000)});this.isFullscreenAvailable=false;if(document.documentElement.requestFullscreen){this.isFullscreenAvailable=true}else{if(document.documentElement.mozRequestFullScreen){this.isFullscreenAvailable=true}else{if(document.documentElement.webkitRequestFullscreen){this.isFullscreenAvailable=true}else{if(document.documentElement.msRequestFullscreen){this.isFullscreenAvailable=true}}}}this.videoDevices=[];this.facingMode="user";cnVideoChat.cameraFlipAvailable=navigator.mediaDevices.getSupportedConstraints()["facingMode"]===true;if(navigator.mediaDevices){navigator.mediaDevices.enumerateDevices().then(function(mediaDevices){for(var i=0;i<mediaDevices.length;i++){if(mediaDevices[i].kind=="videoinput"){cnVideoChat.videoDevices.push(mediaDevices[i])}}cnVideoChat.cameraFlipAvailable=cnVideoChat.videoDevices.length>1;cnVideoChat.cameraFlipAvailable=cnVideoChat.cameraFlipAvailable||navigator.mediaDevices.getSupportedConstraints()["facingMode"]===true})}}CNVideoChat.prototype={join:function(){const Video=Twilio.Video;this.videoOn=true;this.audioOn=true;$.ajax({url:"/chat/"+this.chatSessionId+"/get_video_chat_access_token",type:"GET",headers:{"X-CSRF-Token":CN.csrfToken()},success:function(data){var accessToken=data.access_token;if(accessToken){Video.connect(accessToken,{name:"User",audio:true,video:true,_useTwilioConnection:true}).then(function(room){console.log("Connected to Room",room);cnVideoChat.room=room;room.localParticipant.tracks.forEach(function(publication){cnVideoChat.trackSubscribed(document.getElementById(cnVideoChat.participantMeDivId),publication.track);if(publication.track&&publication.track.kind=="video"){cnVideoChat.currentVideoDevice=publication.track.mediaStreamTrack.label}});room.participants.forEach(cnVideoChat.participantConnected);room.on("participantConnected",function(participant){cnVideoChat.participantConnected(participant);cnVideoChat.isParticipantConnected=true;CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshEvent"})});room.on("participantDisconnected",cnVideoChat.participantDisconnected);room.once("disconnected",function(error){room.participants.forEach(cnVideoChat.participantDisconnected)})},function(e){console.log(e);var message="";if(e.message=="Permission denied"){message="Please enable the video and microphone in your browser settings, then refresh this page and rejoin the video chat."}else{if(e.message=="Could not start video source"){message="Please enable your camera and microphone in your computer settings, then refresh this page and rejoin the video chat."}}CN.broadcastMessage({cnEvent:"cnEvent.videoChatPermissionError",message:message})})}}})},participantConnected:function(participant){cnVideoChat.isParticipantConnected=true;CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshEvent"});participant.on("trackSubscribed",function(track){cnVideoChat.trackSubscribed(document.getElementById(cnVideoChat.participantDivId),track)});participant.on("trackUnsubscribed",cnVideoChat.trackUnsubscribed);participant.tracks.forEach(function(publication){cnVideoChat.trackSubscribed(document.getElementById(cnVideoChat.participantDivId),publication.track)})},participantDisconnected:function(participant){},trackSubscribed:function(div,track){if(track){if(track.kind=="video"&&div.querySelector("video")){div.querySelector("video").remove()}div.appendChild(track.attach());this.calcVideoDimensions()}},trackUnsubscribed:function(track){},disconnect:function(){if(this.room){this.room.disconnect();this.room=null;this.logEvent({event:"end"});CN.broadcastMessage({cnEvent:"cnEvent.videoChatDisconnect"})}},toggleVideo:function(){if(this.videoOn){this.room.localParticipant.videoTracks.forEach(function(publication){cnVideoChat.videoOn=false;publication.track.detach().forEach(function(element){element.remove()});publication.track.stop();publication.unpublish();cnVideoChat.logEvent({event:"video",status:0});CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshEvent"})})}else{const Video=Twilio.Video;Video.createLocalVideoTrack().then(function(localVideoTrack){return cnVideoChat.room.localParticipant.publishTrack(localVideoTrack)}).then(function(publication){cnVideoChat.videoOn=true;cnVideoChat.trackSubscribed(document.getElementById(cnVideoChat.participantMeDivId),publication.track);cnVideoChat.logEvent({event:"video",status:1});CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshEvent"})})}},toggleAudio:function(){if(this.audioOn){this.room.localParticipant.audioTracks.forEach(function(publication){cnVideoChat.audioOn=false;publication.track.disable();cnVideoChat.logEvent({event:"audio",status:0});CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshEvent"})})}else{this.room.localParticipant.audioTracks.forEach(function(publication){cnVideoChat.audioOn=true;publication.track.enable();cnVideoChat.logEvent({event:"audio",status:1});CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshEvent"})})}},toggleFullscreen:function(){this.fullscreen=!this.fullscreen;CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshEvent"});var elem=document.documentElement;if(this.fullscreen){if(elem.requestFullscreen){elem.requestFullscreen()}else{if(elem.mozRequestFullScreen){elem.mozRequestFullScreen()}else{if(elem.webkitRequestFullscreen){elem.webkitRequestFullscreen()}else{if(elem.msRequestFullscreen){elem.msRequestFullscreen()}}}}}else{if(document.exitFullscreen){document.exitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}}}}}cnVideoChat.logEvent({event:"fullscreen",status:this.fullscreen?1:0});setTimeout(function(){cnVideoChat.calcVideoDimensions()},500)},toggleParticipant:function(){this.mainView=this.mainView=="me"?null:"me";this.calcVideoDimensions();CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshEvent"})},flipCamera:function(){const Video=Twilio.Video;var videoDevice=null;if(cnVideoChat.videoDevices.length>1){for(var i=0;i<cnVideoChat.videoDevices.length;i++){if(cnVideoChat.currentVideoDevice!=cnVideoChat.videoDevices.label){videoDevice=cnVideoChat.videoDevices[i]}}}var deviceConfig={video:true};if(videoDevice){deviceConfig.deviceId={exact:videoDevice.label}}else{if(cnVideoChat.facingMode=="user"){cnVideoChat.facingMode="environment"}else{cnVideoChat.facingMode="user"}deviceConfig={facingMode:cnVideoChat.facingMode}}var localParticipant=this.room.localParticipant;Video.createLocalVideoTrack(deviceConfig).then(function(localVideoTrack){var tracks=[];localParticipant.videoTracks.forEach(function(publication){tracks.push(publication.track)});localParticipant.unpublishTracks(tracks);for(var i=0;i<tracks.length;i++){tracks[i].detach().forEach(function(element){element.remove()})}localParticipant.publishTrack(localVideoTrack);var previewContainer=document.getElementById(cnVideoChat.participantMeDivId);previewContainer.appendChild(localVideoTrack.attach())})},calcVideoDimensions:function(reCalc){try{var myVid=document.querySelector("#"+this.participantMeDivId+" video");if(myVid){var w=myVid.videoWidth;var h=myVid.videoHeight;if(w==0||h==0){setTimeout(function(){cnVideoChat.calcVideoDimensions()},1000);return}var vw=0.3*document.getElementById(this.containerId).offsetWidth;var vh=(vw*(h/w));var ch=document.getElementById(this.containerId).offsetHeight;if(vh>(0.3*ch)){vh=(0.3*ch);vw=(vh*(w/h))}this.myVideoWidth=vw+"px";this.myVideoHeight=vh+"px";this.myVideoDimensions="width:"+this.myVideoWidth+";height:"+this.myVideoHeight+";"}else{if(!reCalc){setTimeout(function(){cnVideoChat.calcVideoDimensions(true)},1000)}}CN.broadcastMessage({cnEvent:"cnEvent.videoChatRefreshUIEvent"})}catch(e){}},logEvent:function(eventData){$.ajax({url:"/chat/"+this.chatSessionId+"/video_chat_event",type:"POST",headers:{"X-CSRF-Token":CN.csrfToken()},data:eventData,success:function(data){}})}};